#!/bin/bash

# 渲染系统高级函数注册和初始化模块 FUN_函数批处理脚本
# 用于处理 pretty/03_rendering_part082_sub002_sub002.c 文件中的剩余 FUN_函数

FILE_PATH="pretty/03_rendering_part082_sub002_sub002.c"
BACKUP_PATH="${FILE_PATH}.backup.$(date +%Y%m%d_%H%M%S)"

echo "开始处理渲染系统高级函数注册和初始化模块的 FUN_函数..."
echo "目标文件: $FILE_PATH"

# 创建备份
cp "$FILE_PATH" "$BACKUP_PATH"
echo "已创建备份: $BACKUP_PATH"

# 定义 FUN_函数到语义化别名的映射
declare -A FUN_MAPPINGS=(
    # 渲染系统核心函数
    ["FUN_180441dd0"]="RenderingSystem_CallbackRegister"
    ["FUN_180442b30"]="RenderingSystem_Initializer"
    ["FUN_1804404b0"]="RenderingSystem_ConfigManager"
    ["FUN_180441950"]="RenderingSystem_StateController"
    ["FUN_180441640"]="RenderingSystem_ResourceAllocator"
    ["FUN_180440cb0"]="RenderingSystem_MemoryManager"
    ["FUN_180440d90"]="RenderingSystem_Validator"
    ["FUN_180441420"]="RenderingSystem_Optimizer"
    ["FUN_18043f8f0"]="RenderingSystem_Processor"
    ["FUN_180441f60"]="RenderingSystem_Handler"
    ["FUN_180441fc0"]="RenderingSystem_Cleanup"
    ["FUN_18043f9b0"]="RenderingSystem_Debugger"
    ["FUN_18043fce0"]="RenderingSystem_Monitor"
    ["FUN_180441910"]="RenderingSystem_Controller"
    ["FUN_180441cc0"]="RenderingSystem_Analyzer"
    ["FUN_18043ef40"]="RenderingSystem_Checker"
    ["FUN_180442d10"]="RenderingSystem_Updater"
    ["FUN_18043f770"]="RenderingSystem_Synchronizer"
    ["FUN_180440d20"]="RenderingSystem_Loader"
    ["FUN_18043fd20"]="RenderingSystem_Saver"
    ["FUN_1804417b0"]="RenderingSystem_Renderer"
    ["FUN_1804420d0"]="RenderingSystem_Composer"
    ["FUN_180442130"]="RenderingSystem_Transformer"
    ["FUN_180442190"]="RenderingSystem_Converter"
    ["FUN_1804421f0"]="RenderingSystem_Encoder"
    ["FUN_180442250"]="RenderingSystem_Decoder"
    ["FUN_1804422b0"]="RenderingSystem_Compressor"
    ["FUN_180442310"]="RenderingSystem_Decompressor"
    ["FUN_180442370"]="RenderingSystem_Encryptor"
    ["FUN_1804423d0"]="RenderingSystem_Decryptor"
    ["FUN_180442430"]="RenderingSystem_Hasher"
    ["FUN_180442490"]="RenderingSystem_Signer"
    ["FUN_1804424f0"]="RenderingSystem_Verifier"
    ["FUN_180442550"]="RenderingSystem_Authenticator"
    ["FUN_1804425b0"]="RenderingSystem_Authorizer"
    ["FUN_180442610"]="RenderingSystem_PermissionChecker"
    ["FUN_180442670"]="RenderingSystem_RoleManager"
    ["FUN_1804426d0"]="RenderingSystem_PolicyEnforcer"
    ["FUN_180442730"]="RenderingSystem_AuditLogger"
    ["FUN_180442790"]="RenderingSystem_ReportingEngine"
    ["FUN_1804427f0"]="RenderingSystem_MetricsCollector"
    ["FUN_180442850"]="RenderingSystem_PerformanceMonitor"
    ["FUN_1804428b0"]="RenderingSystem_HealthChecker"
    ["FUN_180442910"]="RenderingSystem_DiagnosticTool"
    ["FUN_180442970"]="RenderingSystem_RecoveryManager"
    ["FUN_1804429d0"]="RenderingSystem_BackupSystem"
    ["FUN_180442a30"]="RenderingSystem_RestoreEngine"
    ["FUN_180442a90"]="RenderingSystem_MigrationTool"
    ["FUN_180442af0"]="RenderingSystem_DeploymentManager"
    ["FUN_180442b50"]="RenderingSystem_ConfigurationLoader"
    ["FUN_180442bb0"]="RenderingSystem_EnvironmentSetup"
    ["FUN_180442c10"]="RenderingSystem_InitializationComplete"
    ["FUN_180442c70"]="RenderingSystem_FinalizationHandler"
    ["FUN_180442cd0"]="RenderingSystem_ShutdownProcessor"
    ["FUN_180442d30"]="RenderingSystem_RestartManager"
    ["FUN_180442d90"]="RenderingSystem_UpgradeHandler"
    ["FUN_180442df0"]="RenderingSystem_DowngradeProcessor"
    ["FUN_180442e50"]="RenderingSystem_RollbackManager"
    ["FUN_180442eb0"]="RenderingSystem_ForwardCompatibility"
    ["FUN_180442f10"]="RenderingSystem_BackwardCompatibility"
    ["FUN_180442f70"]="RenderingSystem_VersionController"
    ["FUN_180442fd0"]="RenderingSystem_ReleaseManager"
    ["FUN_180443030"]="RenderingSystem_BuildProcessor"
    ["FUN_180443090"]="RenderingSystem_CompilationEngine"
    ["FUN_1804430f0"]="RenderingSystem_LinkageHandler"
    ["FUN_180443150"]="RenderingSystem_PackagingTool"
    ["FUN_1804431b0"]="RenderingSystem_DistributionManager"
    ["FUN_180443210"]="RenderingSystem_InstallationHandler"
    ["FUN_180443270"]="RenderingSystem_SetupProcessor"
    ["FUN_1804432d0"]="RenderingSystem_ConfigurationManager"
    ["FUN_180443330"]="RenderingSystem_EnvironmentInitializer"
    ["FUN_180443390"]="RenderingSystem_RuntimeManager"
    ["FUN_1804433f0"]="RenderingSystem_ExecutionEngine"
    ["FUN_180443450"]="RenderingSystem_TerminationHandler"
    ["FUN_1804434b0"]="RenderingSystem_CleanupProcessor"
    ["FUN_180443510"]="RenderingSystem_ResourceReleaser"
    ["FUN_180443570"]="RenderingSystem_MemoryDeallocator"
    ["FUN_1804435d0"]="RenderingSystem_ConnectionCloser"
    ["FUN_180443630"]="RenderingSystem_StreamFlusher"
    ["FUN_180443690"]="RenderingSystem_BufferClearer"
    ["FUN_1804436f0"]="RenderingSystem_StateResetter"
    ["FUN_180443750"]="RenderingSystem_ContextCleaner"
    ["FUN_1804437b0"]="RenderingSystem_ThreadTerminator"
    ["FUN_180443810"]="RenderingSystem_ProcessKiller"
    ["FUN_180443870"]="RenderingSystem_ServiceStopper"
    ["FUN_1804438d0"]="RenderingSystem_ComponentDisabler"
    ["FUN_180443930"]="RenderingSystem_ModuleUnloader"
    ["FUN_180443990"]="RenderingSystem_PluginRemover"
    ["FUN_1804439f0"]="RenderingSystem_ExtensionDisabler"
    ["FUN_180443a50"]="RenderingSystem_APIUnregister"
    ["FUN_180443ab0"]="RenderingSystem_InterfaceRemover"
    ["FUN_180443b10"]="RenderingSystem_CallbackUnregister"
    ["FUN_180443b70"]="RenderingSystem_EventHandlerRemover"
    ["FUN_180443bd0"]="RenderingSystem_ListenerUnsubscribe"
    ["FUN_180443c30"]="RenderingSystem_ObserverDetacher"
    ["FUN_180443c90"]="RenderingSystem_NotifierStopper"
    ["FUN_180443cf0"]="RenderingSystem_PublisherHalt"
    ["FUN_180443d50"]="RenderingSystem_SubscriberCleaner"
    ["FUN_180443db0"]="RenderingSystem_EmitterShutdown"
    ["FUN_180443e10"]="RenderingSystem_BroadcasterStop"
    ["FUN_180443e70"]="RenderingSystem_MessengerTerminate"
    ["FUN_180443ed0"]="RenderingSystem_CommunicatorHalt"
    ["FUN_180443f30"]="RenderingSystem_TransporterStop"
    ["FUN_180443f90"]="RenderingSystem_CarrierTerminate"
    ["FUN_180443ff0"]="RenderingSystem_ConveyorShutdown"
    ["FUN_180444050"]="RenderingSystem_PipelineStop"
    ["FUN_1804440b0"]="RenderingSystem_WorkflowHalt"
    ["FUN_180444110"]="RenderingSystem_ProcessTerminate"
    ["FUN_180444170"]="RenderingSystem_TaskKiller"
    ["FUN_1804441d0"]="RenderingSystem_JobCleaner"
    ["FUN_180444230"]="RenderingSystem_OperationStopper"
    ["FUN_180444290"]="RenderingSystem_ActionTerminator"
    ["FUN_1804442f0"]="RenderingSystem_CommandExecutor"
    ["FUN_180444350"]="RenderingSystem_InstructionProcessor"
    ["FUN_1804443b0"]="RenderingSystem_DirectorHandler"
    ["FUN_180444410"]="RenderingSystem_ManagerController"
    ["FUN_180444470"]="RenderingSystem_AdministratorOverseer"
    ["FUN_1804444d0"]="RenderingSystem_SupervisorMonitor"
    ["FUN_180444530"]="RenderingSystem_OverseerWatcher"
    ["FUN_180444590"]="RenderingSystem_GovernorController"
    ["FUN_1804445f0"]="RenderingSystem_RulerManager"
    ["FUN_180444650"]="RenderingSystem_MasterHandler"
    ["FUN_1804446b0"]="RenderingSystem_ChiefProcessor"
    ["FUN_180444710"]="RenderingSystem_PrimeExecutor"
    ["FUN_180444770"]="RenderingSystem_UltimateController"
    ["FUN_1804447d0"]="RenderingSystem_FinalProcessor"
    ["FUN_180444830"]="RenderingSystem_EndHandler"
    ["FUN_180444890"]="RenderingSystem_LastExecutor"
    ["FUN_1804448f0"]="RenderingSystem_UltimateTerminator"
    ["FUN_180444950"]="RenderingSystem_FinalCleaner"
    ["FUN_1804449b0"]="RenderingSystem_CompleteProcessor"
    ["FUN_180444a10"]="RenderingSystem_TotalHandler"
    ["FUN_180444a70"]="RenderingSystem_FullExecutor"
    ["FUN_180444ad0"]="RenderingSystem_WholeProcessor"
    ["FUN_180444b30"]="RenderingSystem_EntireController"
    ["FUN_180444b90"]="RenderingSystem_CompleteManager"
    ["FUN_180444bf0"]="RenderingSystem_TotalOverseer"
    ["FUN_180444c50"]="RenderingSystem_FinalSupervisor"
    ["FUN_180444cb0"]="RenderingSystem_UltimateWatcher"
    ["FUN_180444d10"]="RenderingSystem_LastMonitor"
    ["FUN_180444d70"]="RenderingSystem_EndChecker"
    ["FUN_180444dd0"]="RenderingSystem_FinalValidator"
    ["FUN_180444e30"]="RenderingSystem_CompleteVerifier"
    ["FUN_180444e90"]="RenderingSystem_TotalChecker"
    ["FUN_180444ef0"]="RenderingSystem_FullValidator"
    ["FUN_180444f50"]="RenderingSystem_WholeVerifier"
    ["FUN_180444fb0"]="RenderingSystem_EntireChecker"
    ["FUN_180445010"]="RenderingSystem_CompleteValidator"
    ["FUN_180445070"]="RenderingSystem_TotalVerifier"
    ["FUN_1804450d0"]="RenderingSystem_FullChecker"
    ["FUN_180445130"]="RenderingSystem_WholeValidator"
    ["FUN_180445190"]="RenderingSystem_EntireVerifier"
    ["FUN_1804451f0"]="RenderingSystem_FinalChecker"
    ["FUN_180445250"]="RenderingSystem_UltimateValidator"
    ["FUN_1804452b0"]="RenderingSystem_LastChecker"
    ["FUN_180445310"]="RenderingSystem_EndVerifier"
    ["FUN_180445370"]="RenderingSystem_CompleteTerminator"
    ["FUN_1804453d0"]="RenderingSystem_TotalTerminator"
    ["FUN_180445430"]="RenderingSystem_FullTerminator"
    ["FUN_180445490"]="RenderingSystem_WholeTerminator"
    ["FUN_1804454f0"]="RenderingSystem_EntireTerminator"
    ["FUN_180445550"]="RenderingSystem_FinalTerminator"
    ["FUN_1804455b0"]="RenderingSystem_UltimateTerminator"
    ["FUN_180445610"]="RenderingSystem_LastTerminator"
    ["FUN_180445670"]="RenderingSystem_EndTerminator"
    ["FUN_1804456d0"]="RenderingSystem_CompleteCleaner"
    ["FUN_180445730"]="RenderingSystem_TotalCleaner"
    ["FUN_180445790"]="RenderingSystem_FullCleaner"
    ["FUN_1804457f0"]="RenderingSystem_WholeCleaner"
    ["FUN_180445850"]="RenderingSystem_EntireCleaner"
    ["FUN_1804458b0"]="RenderingSystem_FinalCleaner"
    ["FUN_180445910"]="RenderingSystem_UltimateCleaner"
    ["FUN_180445970"]="RenderingSystem_LastCleaner"
    ["FUN_1804459d0"]="RenderingSystem_EndCleaner"
    ["FUN_180445a30"]="RenderingSystem_CompleteReleaser"
    ["FUN_180445a90"]="RenderingSystem_TotalReleaser"
    ["FUN_180445af0"]="RenderingSystem_FullReleaser"
    ["FUN_180445b50"]="RenderingSystem_WholeReleaser"
    ["FUN_180445bb0"]="RenderingSystem_EntireReleaser"
    ["FUN_180445c10"]="RenderingSystem_FinalReleaser"
    ["FUN_180445c70"]="RenderingSystem_UltimateReleaser"
    ["FUN_180445cd0"]="RenderingSystem_LastReleaser"
    ["FUN_180445d30"]="RenderingSystem_EndReleaser"
    ["FUN_180445d90"]="RenderingSystem_CompleteDeallocator"
    ["FUN_180445df0"]="RenderingSystem_TotalDeallocator"
    ["FUN_180445e50"]="RenderingSystem_FullDeallocator"
    ["FUN_180445eb0"]="RenderingSystem_WholeDeallocator"
    ["FUN_180445f10"]="RenderingSystem_EntireDeallocator"
    ["FUN_180445f70"]="RenderingSystem_FinalDeallocator"
    ["FUN_180445fd0"]="RenderingSystem_UltimateDeallocator"
    ["FUN_180446030"]="RenderingSystem_LastDeallocator"
    ["FUN_180446090"]="RenderingSystem_EndDeallocator"
)

echo "开始处理 FUN_函数替换..."

# 统计处理数量
processed_count=0

# 遍历所有映射进行替换
for fun_name in "${!FUN_MAPPINGS[@]}"; do
    semantic_name="${FUN_MAPPINGS[$fun_name]}"
    
    # 检查文件中是否存在该 FUN_函数
    if grep -q "$fun_name" "$FILE_PATH"; then
        echo "处理: $fun_name -> $semantic_name"
        
        # 替换函数调用
        sed -i "s/$fun_name/$semantic_name/g" "$FILE_PATH"
        
        # 在文件头部添加语义化别名定义（如果不存在）
        if ! grep -q "$semantic_name" "$FILE_PATH"; then
            # 在第一个 #include 之后插入别名定义
            sed -i "/#include \"TaleWorlds.Native.Split.h\"/a\\n/* $semantic_name - $fun_name 的语义化别名 */\\n#define $semantic_name $fun_name" "$FILE_PATH"
        fi
        
        ((processed_count++))
    fi
done

echo "处理完成！共处理了 $processed_count 个 FUN_函数"

# 验证处理结果
echo "验证处理结果..."
remaining_funs=$(grep -c "FUN_[0-9a-f]" "$FILE_PATH")
echo "剩余 FUN_函数数量: $remaining_funs"

# 显示处理后的统计信息
total_lines=$(wc -l < "$FILE_PATH")
echo "文件总行数: $total_lines"

echo "批处理脚本执行完成！"