#!/bin/bash

# 美化03_rendering.c文件脚本
# 将undefined类型改为合适的类型，将UNK_和FUN_标识符改为PascalCase规范

# 输入文件路径
INPUT_FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c"
# 临时文件路径
TEMP_FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering_temp.c"

echo "开始美化03_rendering.c文件..."

# 创建备份
cp "$INPUT_FILE" "$INPUT_FILE.backup"

# 1. 将undefined*改为void*（用于指针类型）
sed -i 's/undefined\*/void\*/g' "$INPUT_FILE"

# 2. 将undefined改为uint32_t（用于函数返回值和状态码）
sed -i 's/\bundefined\b/uint32_t/g' "$INPUT_FILE"

# 3. 将UNK_变量改为PascalCase规范
sed -i 's/UNK_180445340/BlendModeProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_180445550/MaterialPropertyValidator/g' "$INPUT_FILE"
sed -i 's/UNK_1804455b0/MaterialCacheManager/g' "$INPUT_FILE"
sed -i 's/UNK_1804455c0/TextureDataProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_1804455d0/TextureSamplerConfigurator/g' "$INPUT_FILE"
sed -i 's/UNK_1804455e0/TextureFilterManager/g' "$INPUT_FILE"
sed -i 's/UNK_1804455f0/TextureAddressManager/g' "$INPUT_FILE"
sed -i 's/UNK_180445600/TextureViewCreator/g' "$INPUT_FILE"
sed -i 's/UNK_180445790/TextureMipmapUpdater/g' "$INPUT_FILE"
sed -i 's/UNK_1804457a0/TextureShaderBinder/g' "$INPUT_FILE"
sed -i 's/UNK_180445960/TextureFilterSetter/g' "$INPUT_FILE"
sed -i 's/UNK_180445fa0/TextureAddressSetter/g' "$INPUT_FILE"
sed -i 's/UNK_180445fb0/TextureMipmapGenerator/g' "$INPUT_FILE"
sed -i 's/UNK_180445fc0/TextureCompressor/g' "$INPUT_FILE"
sed -i 's/UNK_180445ff0/TextureDecompressor/g' "$INPUT_FILE"
sed -i 's/UNK_180446000/TextureFormatConverter/g' "$INPUT_FILE"
sed -i 's/UNK_180446070/BufferInstanceAllocator/g' "$INPUT_FILE"
sed -i 's/UNK_1804460b0/FormatCompatibilityChecker/g' "$INPUT_FILE"
sed -i 's/UNK_1804461a0/ResourceReferenceProvider/g' "$INPUT_FILE"
sed -i 's/UNK_180446280/RenderStateManager/g' "$INPUT_FILE"
sed -i 's/UNK_180446290/RenderContextManager/g' "$INPUT_FILE"
sed -i 's/UNK_180446530/RenderPipelineManager/g' "$INPUT_FILE"
sed -i 's/UNK_1804465b0/RenderStateInitializer/g' "$INPUT_FILE"
sed -i 's/UNK_180446600/RenderContextInitializer/g' "$INPUT_FILE"
sed -i 's/UNK_180446900/RenderObjectManager/g' "$INPUT_FILE"
sed -i 's/UNK_180446940/RenderContextArrayManager/g' "$INPUT_FILE"
sed -i 's/UNK_180446950/RenderContextInitializer/g' "$INPUT_FILE"
sed -i 's/UNK_1804469d0/RenderDataProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_1804469e0/RenderContextProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_180446a20/RenderParameterUpdater/g' "$INPUT_FILE"
sed -i 's/UNK_180446e60/RenderTargetCreator/g' "$INPUT_FILE"
sed -i 's/UNK_180446f90/CameraParameterSetter/g' "$INPUT_FILE"
sed -i 's/UNK_180447010/ViewportParameterSetter/g' "$INPUT_FILE"
sed -i 's/UNK_180447020/ClippingPlaneSetter/g' "$INPUT_FILE"
sed -i 's/UNK_1804470c0/ProjectionMatrixCalculator/g' "$INPUT_FILE"
sed -i 's/UNK_180447110/ViewMatrixCalculator/g' "$INPUT_FILE"
sed -i 's/UNK_1804473a0/TransformMatrixUpdater/g' "$INPUT_FILE"
sed -i 's/UNK_1804475b0/RenderContextInitializer/g' "$INPUT_FILE"
sed -i 's/UNK_180447c80/IndexDrawProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_180447c90/InstanceDrawProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_180447d20/InstanceDataManager/g' "$INPUT_FILE"
sed -i 's/UNK_180447d30/InstanceBufferManager/g' "$INPUT_FILE"
sed -i 's/UNK_180447dc0/TransformMatrixProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_1804482a0/ResourceBinder/g' "$INPUT_FILE"
sed -i 's/UNK_1804482b0/ShaderParameterSetter/g' "$INPUT_FILE"
sed -i 's/UNK_1804482e0/StateDataProcessor/g' "$INPUT_FILE"
sed -i 's/UNK_180448370/ParameterDataUpdater/g' "$INPUT_FILE"
sed -i 's/UNK_180448400/RenderStateValidator/g' "$INPUT_FILE"

# 4. 将FUN_函数改为PascalCase规范
sed -i 's/FUN_180440f30/ValidateRenderState/g' "$INPUT_FILE"
sed -i 's/FUN_180441070/ProcessRenderQueue/g' "$INPUT_FILE"
sed -i 's/FUN_1804410a0/ExecuteRenderCommand/g' "$INPUT_FILE"
sed -i 's/FUN_180441110/InitializeRenderDevice/g' "$INPUT_FILE"
sed -i 's/FUN_180441180/CreateRenderContext/g' "$INPUT_FILE"
sed -i 's/FUN_180441260/DestroyRenderContext/g' "$INPUT_FILE"
sed -i 's/FUN_180441420/BeginRenderFrame/g' "$INPUT_FILE"
sed -i 's/FUN_1804414d0/EndRenderFrame/g' "$INPUT_FILE"
sed -i 's/FUN_1804415d0/PresentRenderFrame/g' "$INPUT_FILE"
sed -i 's/FUN_180441640/ClearRenderBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_180441730/SetRenderViewport/g' "$INPUT_FILE"
sed -i 's/FUN_1804417b0/SetRenderScissor/g' "$INPUT_FILE"
sed -i 's/FUN_180441830/SetRenderBlendFactor/g' "$INPUT_FILE"
sed -i 's/FUN_180441890/SetRenderDepthBias/g' "$INPUT_FILE"
sed -i 's/FUN_1804418e0/SetRenderStencilRef/g' "$INPUT_FILE"
sed -i 's/FUN_180441910/BindRenderPipeline/g' "$INPUT_FILE"
sed -i 's/FUN_180441950/BindVertexBuffers/g' "$INPUT_FILE"
sed -i 's/FUN_180441a00/BindIndexBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_180441c50/BindConstantBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_180441cc0/BindShaderResource/g' "$INPUT_FILE"
sed -i 's/FUN_180441dd0/BindSamplerState/g' "$INPUT_FILE"
sed -i 's/FUN_180441e10/BindRenderTarget/g' "$INPUT_FILE"
sed -i 's/FUN_180441e50/BindDepthStencil/g' "$INPUT_FILE"
sed -i 's/FUN_180441e90/UpdateSubresource/g' "$INPUT_FILE"
sed -i 's/FUN_180441f60/CopySubresource/g' "$INPUT_FILE"
sed -i 's/FUN_180441fc0/ResolveSubresource/g' "$INPUT_FILE"
sed -i 's/FUN_180442020/GenerateMips/g' "$INPUT_FILE"
sed -i 's/FUN_1804420c0/CreateTexture2D/g' "$INPUT_FILE"
sed -i 's/FUN_180442180/CreateTexture3D/g' "$INPUT_FILE"
sed -i 's/FUN_1804422a0/CreateBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_180442370/CreateShader/g' "$INPUT_FILE"
sed -i 's/FUN_180442450/CreateInputLayout/g' "$INPUT_FILE"
sed -i 's/FUN_1804424d0/CreateRasterizerState/g' "$INPUT_FILE"
sed -i 's/FUN_180442560/CreateBlendState/g' "$INPUT_FILE"
sed -i 's/FUN_180442670/CreateDepthStencilState/g' "$INPUT_FILE"
sed -i 's/FUN_180442720/CreateSamplerState/g' "$INPUT_FILE"
sed -i 's/FUN_180442860/CreateQuery/g' "$INPUT_FILE"
sed -i 's/FUN_180442950/CreatePredicate/g' "$INPUT_FILE"
sed -i 's/FUN_1804429f0/CreateCounter/g' "$INPUT_FILE"
sed -i 's/FUN_180442b30/CreateRenderTargetView/g' "$INPUT_FILE"
sed -i 's/FUN_180442d10/CreateDepthStencilView/g' "$INPUT_FILE"
sed -i 's/FUN_180442e00/CreateShaderResourceView/g' "$INPUT_FILE"
sed -i 's/FUN_180443000/CreateUnorderedAccessView/g' "$INPUT_FILE"
sed -i 's/FUN_180443080/CreateGraphicsPipeline/g' "$INPUT_FILE"
sed -i 's/FUN_1804431c0/CreateComputePipeline/g' "$INPUT_FILE"
sed -i 's/FUN_180443320/MapResource/g' "$INPUT_FILE"
sed -i 's/FUN_180443510/UnmapResource/g' "$INPUT_FILE"
sed -i 's/FUN_180443630/BeginQuery/g' "$INPUT_FILE"
sed -i 's/FUN_180443680/EndQuery/g' "$INPUT_FILE"
sed -i 's/FUN_180443700/GetQueryData/g' "$INPUT_FILE"
sed -i 's/FUN_180443770/SetPredication/g' "$INPUT_FILE"
sed -i 's/FUN_180443820/DrawAuto/g' "$INPUT_FILE"
sed -i 's/FUN_180443930/DrawIndexedInstanced/g' "$INPUT_FILE"
sed -i 's/FUN_180443a40/DrawInstancedIndirect/g' "$INPUT_FILE"
sed -i 's/FUN_180443aa0/DrawIndexedInstancedIndirect/g' "$INPUT_FILE"
sed -i 's/FUN_180443b00/Dispatch/g' "$INPUT_FILE"
sed -i 's/FUN_180443b40/DispatchIndirect/g' "$INPUT_FILE"
sed -i 's/FUN_180443b80/CopyResource/g' "$INPUT_FILE"
sed -i 's/FUN_180443d10/UpdateTileMappings/g' "$INPUT_FILE"
sed -i 's/FUN_180443d70/CopyTileMappings/g' "$INPUT_FILE"
sed -i 's/FUN_180443df0/ResizeTilePool/g' "$INPUT_FILE"
sed -i 's/FUN_180443f80/TiledResourceBarrier/g' "$INPUT_FILE"
sed -i 's/FUN_180443ff0/CheckFeatureSupport/g' "$INPUT_FILE"
sed -i 's/FUN_180444030/GetDeviceRemovedReason/g' "$INPUT_FILE"
sed -i 's/FUN_180444070/GetPrivateData/g' "$INPUT_FILE"
sed -i 's/FUN_180444100/SetPrivateData/g' "$INPUT_FILE"
sed -i 's/FUN_180444200/GetFeatureLevel/g' "$INPUT_FILE"
sed -i 's/FUN_180444280/CreateCommandList/g' "$INPUT_FILE"
sed -i 's/FUN_1804442c0/ExecuteCommandList/g' "$INPUT_FILE"
sed -i 's/FUN_1804442e0/FlushCommandQueue/g' "$INPUT_FILE"
sed -i 's/FUN_180444370/CreateFence/g' "$INPUT_FILE"
sed -i 's/FUN_1804443c0/SignalFence/g' "$INPUT_FILE"
sed -i 's/FUN_180444410/WaitForFence/g' "$INPUT_FILE"
sed -i 's/FUN_1804445b0/CreateSwapChain/g' "$INPUT_FILE"
sed -i 's/FUN_180444600/ResizeBuffers/g' "$INPUT_FILE"
sed -i 's/FUN_180444700/GetBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_1804447c0/GetDesc/g' "$INPUT_FILE"
sed -i 's/FUN_1804448a0/SetFullscreenState/g' "$INPUT_FILE"
sed -i 's/FUN_1804449a0/GetFullscreenState/g' "$INPUT_FILE"
sed -i 's/FUN_180444a20/GetContainingOutput/g' "$INPUT_FILE"
sed -i 's/FUN_180444b70/ResizeTarget/g' "$INPUT_FILE"
sed -i 's/FUN_180444dd0/IsTemporaryMonoSupported/g' "$INPUT_FILE"
sed -i 's/FUN_180444e90/GetFrameStatistics/g' "$INPUT_FILE"
sed -i 's/FUN_180445060/GetLastPresentCount/g' "$INPUT_FILE"
sed -i 's/FUN_180445110/CreateSwapChainForHwnd/g' "$INPUT_FILE"
sed -i 's/FUN_180445180/CreateSwapChainForCoreWindow/g' "$INPUT_FILE"
sed -i 's/FUN_180445390/CreateSwapChainForComposition/g' "$INPUT_FILE"
sed -i 's/FUN_180445480/GetRotation/g' "$INPUT_FILE"
sed -i 's/FUN_180445570/SetRotation/g' "$INPUT_FILE"
sed -i 's/FUN_180445680/GetSourceSize/g' "$INPUT_FILE"
sed -i 's/FUN_1804457b0/GetMaximumFrameLatency/g' "$INPUT_FILE"
sed -i 's/FUN_180445870/SetMaximumFrameLatency/g' "$INPUT_FILE"
sed -i 's/FUN_180445970/GetFrameLatencyWaitableObject/g' "$INPUT_FILE"
sed -i 's/FUN_180445a80/SetMatrixTransform/g' "$INPUT_FILE"
sed -i 's/FUN_180445cd0/GetMatrixTransform/g' "$INPUT_FILE"
sed -i 's/FUN_180445dc0/GetSourceSize/g' "$INPUT_FILE"
sed -i 's/FUN_180445eb0/GetBackgroundColor/g' "$INPUT_FILE"
sed -i 's/FUN_180445fd0/SetBackgroundColor/g' "$INPUT_FILE"
sed -i 's/FUN_180446010/GetRotation/g' "$INPUT_FILE"
sed -i 's/FUN_180446080/SetRotation/g' "$INPUT_FILE"
sed -i 's/FUN_1804460c0/GetHwnd/g' "$INPUT_FILE"
sed -i 's/FUN_1804460f0/IsFullScreen/g' "$INPUT_FILE"
sed -i 's/FUN_180446120/GetCoreWindow/g' "$INPUT_FILE"
sed -i 's/FUN_180446160/GetPresentParameters/g' "$INPUT_FILE"
sed -i 's/FUN_1804461b0/GetCompositionDevice/g' "$INPUT_FILE"
sed -i 's/FUN_1804462a0/GetFrameStatistics/g' "$INPUT_FILE"
sed -i 's/FUN_1804462e0/GetLastPresentCount/g' "$INPUT_FILE"
sed -i 's/FUN_180446320/CreateSwapChainForComposition/g' "$INPUT_FILE"
sed -i 's/FUN_180446370/GetBuffer/g' "$INPUT_FILE"
sed -i 's/FUN_1804463b0/GetDesc/g' "$INPUT_FILE"
sed -i 's/FUN_1804463f0/ResizeBuffers/g' "$INPUT_FILE"
sed -i 's/FUN_180446440/ResizeTarget/g' "$INPUT_FILE"

echo "美化完成！"
echo "原始文件已备份为: $INPUT_FILE.backup"