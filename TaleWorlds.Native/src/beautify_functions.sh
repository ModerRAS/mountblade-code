#!/bin/bash

# 美化脚本 - 替换99_unmatched_functions.c中的函数名

# 定义函数映射
declare -A function_mapping=(
    ["FUN_18005e630"]="InitializeSystemMemoryManager"
    ["FUN_1800adc50"]="CreateSystemContext"
    ["FUN_18005c650"]="ProcessSystemEvent"
    ["FUN_18006b4c0"]="ConfigureSystemParameters"
    ["FUN_18006b440"]="ValidateSystemConfiguration"
    ["FUN_1800ae230"]="ProcessSystemOperationRequest"
    ["FUN_180220810"]="UpdateSystemStatus"
    ["FUN_18062b1e0"]="AllocateSystemMemory"
    ["FUN_18023a2e0"]="InitializeMemoryBlock"
    ["FUN_1802055a0"]="ResetSystemTables"
    ["FUN_180049b30"]="CreateDataBuffer"
    ["FUN_18023a940"]="CalculateBufferSize"
    ["FUN_180626f80"]="RegisterSystemResource"
    ["FUN_1802a1bc0"]="ProcessDataLength"
    ["FUN_1800ad760"]="AllocateMemoryArray"
    ["FUN_1800adfe0"]="InitializeBufferData"
    ["FUN_1800a6184"]="ProcessSystemConfigurationParameters"
    ["FUN_1800a62cd"]="ExecuteResourceCallback"
    ["FUN_1800adba0"]="ClearDataStructureFields"
    ["FUN_1802230e0"]="ProcessXmlElement"
    ["FUN_180624440"]="FormatStringData"
    ["FUN_1806279c0"]="SetStringData"
    ["FUN_18064e990"]="GetStringHandle"
    ["FUN_18062b8b0"]="AllocateStringBuffer"
    ["FUN_180626eb0"]="ProcessBufferData"
    ["FUN_180060680"]="FormatSystemMessage"
    ["FUN_180627600"]="ProcessStringFormat"
    ["FUN_18062dee0"]="ProcessCharacterData"
    ["FUN_180628040"]="ProcessStringComparison"
    ["FUN_180627c50"]="SetStringPointer"
    ["FUN_1800ac700"]="ReleaseXmlResources"
    ["FUN_1800ac530"]="CleanupXmlContext"
    ["FUN_1801c93c0"]="FinalizeXmlProcessing"
    ["FUN_1800ab6f0"]="CleanupResourceCache"
    ["FUN_18029c9d0"]="ProcessXmlData"
    ["FUN_1800acb60"]="HandleSystemRequest"
    ["FUN_1800ad510"]="InitializeSystemDataProcessor"
    ["FUN_1800ad52d"]="ProcessSystemDataUpdate"
    ["FUN_1800ad59f"]="ValidateSystemStatusFlag"
    ["FUN_1800ad6b2"]="InitializeSystemIdleState"
    ["FUN_1800ad6bc"]="ResetSystemRuntimeState"
    ["FUN_1800ad7c0"]="CleanupMemoryBlockArray"
    ["FUN_1800adb30"]="ResetResourceManagerPointers"
    ["FUN_1800ad820"]="ReleaseSystemResourcesAndCleanup"
    ["FUN_18029c460"]="ReleaseResourcePointer"
    ["FUN_1800ad8c0"]="ExpandResourceArrayAndCopyData"
    ["FUN_180047d40"]="ProcessArrayData"
    ["FUN_1800ae01b"]="InitializeSystemStatusByte"
    ["FUN_1800ae16b"]="EmptyOperationFunction"
    ["FUN_1800ae1b0"]="CleanupMemoryDataStructure"
    ["FUN_1800ae2c0"]="ExecuteFileOperationHandler"
    ["FUN_1800ae370"]="ProcessXmlElementData"
    ["FUN_1800ae430"]="ProcessXmlElementConfigurationData"
    ["FUN_1800ae640"]="InitializeXmlContext"
    ["FUN_18005d260"]="ProcessStringData"
    ["FUN_1800aec40"]="ProcessStringBufferData"
    ["FUN_1808fd200"]="FinalizeStringProcessing"
    ["FUN_180628ca0"]="GetStringLength"
    ["FUN_18005c8a0"]="ProcessStringComparison"
    ["FUN_1800af9f0"]="ExecuteSystemCleanupOperation"
    ["FUN_1800b01b0"]="ProcessXmlElementExtendedFormatting"
    ["FUN_180059820"]="ProcessStringFormatting"
    ["FUN_180627ae0"]="SetStringBufferLength"
    ["FUN_180627be0"]="UpdateXmlElementData"
    ["FUN_180081480"]="InitializeContextData"
    ["FUN_18005ce30"]="ProcessContextData"
    ["FUN_18005e370"]="InitializeContextPointer"
    ["FUN_1800b90a0"]="ProcessDefaultCharacter"
    ["FUN_18029b390"]="ProcessExtendedXmlData"
    ["FUN_18029b1d0"]="ProcessBasicXmlData"
    ["FUN_1800b95d0"]="ProcessBufferDataWithParameters"
    ["FUN_1800b9400"]="InitializeDataProcessing"
    ["FUN_1800b88d0"]="ProcessStringBufferData"
    ["FUN_180056f10"]="FinalizeStringProcessing"
    ["FUN_1800b8630"]="ProcessBufferDataRange"
    ["FUN_180080810"]="CopyBufferData"
    ["FUN_180624af0"]="ValidateBufferData"
    ["FUN_1802a83f0"]="ProcessStringBufferDataExtended"
    ["FUN_1802abc50"]="ProcessXmlDataExtended"
    ["FUN_180627020"]="UpdateResourceData"
    ["FUN_1800be9a0"]="ProcessGlobalData"
    ["FUN_18023b050"]="ResetContextData"
    ["FUN_1800b8b20"]="ProcessGlobalDataTable"
    ["FUN_1800b8da0"]="InitializeContextWithParameters"
    ["FUN_1800b4910"]="ProcessXmlElementWithParameters"
    ["FUN_1800b3670"]="ProcessXmlElementWithBuffer"
    ["FUN_1800b3970"]="ProcessXmlStringBufferHandle"
    ["FUN_1802ac0a0"]="ProcessStringBufferDataAdvanced"
    ["FUN_18023e880"]="NetworkConnectionBuilder"
    ["FUN_18023e750"]="NetworkConnectionDisconnector"
    ["FUN_18023e4f0"]="NetworkConnectionValidator"
    ["FUN_18023e620"]="NetworkConnectionRestorer"
    ["FUN_18023e240"]="NetworkConnectionConfigurator"
    ["FUN_18023e3d0"]="NetworkConnectionMonitor"
    ["FUN_1802e51e0"]="NetworkDataTransferManager"
    ["FUN_1800a1326"]="ExecuteStringProcessingWithDispatch"
    ["FUN_1800a367b"]="CleanupAndInitializeResourceHandles"
    ["FUN_1800aace0"]="ReleaseSystemResources"
    ["FUN_1800acb60"]="HandleSystemRequest"
    ["FUN_1800863a0"]="ProcessFloatData"
)

# 处理文件
file_path="/dev/shm/mountblade-code/TaleWorlds.Native/src/99_unmatched_functions.c"

# 创建临时文件
temp_file="${file_path}.tmp"

# 逐行处理文件
while IFS= read -r line; do
    # 替换所有已知的函数调用
    for old_func in "${!function_mapping[@]}"; do
        new_func="${function_mapping[$old_func]}"
        # 使用sed替换函数调用
        line=$(echo "$line" | sed "s/$old_func/$new_func/g")
    done
    echo "$line" >> "$temp_file"
done < "$file_path"

# 替换原文件
mv "$temp_file" "$file_path"

echo "函数名替换完成"