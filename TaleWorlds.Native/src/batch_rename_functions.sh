#!/bin/bash

# 批量重命名01_initialization.c中的函数名
# 创建临时文件
TEMP_FILE="/tmp/01_initialization_temp.c"
INPUT_FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/01_initialization.c"

# 复制原文件
cp "$INPUT_FILE" "$TEMP_FILE"

# 定义函数重命名映射
declare -A FUNCTION_MAP=(
    ["FUN_180052ef0"]="SystemMemoryBufferHandler"
    ["FUN_180053200"]="SystemMemoryCopier"
    ["FUN_1800533d0"]="SystemStringHandler"
    ["FUN_180054360"]="SystemArrayProcessor"
    ["FUN_1800547b0"]="SystemGlobalCleanup"
    ["FUN_180055050"]="SystemMemoryFinalizer"
    ["FUN_180055e10"]="SystemPointerManager"
    ["FUN_180055e30"]="SystemDataValidator"
    ["FUN_180055e60"]="SystemErrorChecker"
    ["FUN_180055ed0"]="SystemStateUpdater"
    ["FUN_180055f20"]="SystemConfigurationLoader"
    ["FUN_180055f50"]="SystemConfigurationSaver"
    ["FUN_180055f70"]="SystemStatusChecker"
    ["FUN_180056150"]="SystemPerformanceMonitor"
    ["FUN_180056410"]="SystemThreadManager"
    ["FUN_1800565f0"]="SystemResourceTracker"
    ["FUN_180056810"]="SystemMemoryOptimizer"
    ["FUN_180056b30"]="SystemDataSerializer"
    ["FUN_180056c50"]="SystemDataDeserializer"
    ["FUN_180056f70"]="SystemBufferManager"
    ["FUN_180057170"]="SystemResourceAllocator"
    ["FUN_1800571e0"]="SystemMemoryDeallocator"
    ["FUN_1800572d0"]="SystemGarbageCollector"
    ["FUN_1800572e6"]="SystemQuickCleanup"
    ["FUN_180057314"]="SystemMemoryDefragmenter"
    ["FUN_180057340"]="SystemMemoryPoolManager"
    ["FUN_18005736b"]="SystemMemoryChunkHandler"
    ["FUN_180057446"]="SystemCacheManager"
    ["FUN_180057479"]="SystemCacheInitializer"
    ["FUN_180057490"]="SystemCacheCleaner"
    ["FUN_1800574b0"]="SystemCacheValidator"
    ["FUN_180057510"]="SystemCacheOptimizer"
    ["FUN_180057530"]="SystemCacheRefresher"
    ["FUN_180057550"]="SystemCacheFlusher"
    ["FUN_180057556"]="SystemCacheSync"
    ["FUN_180057580"]="SystemGlobalSync"
    ["FUN_1800575b6"]="SystemQuickSync"
    ["FUN_1800575d4"]="SystemFinalSync"
    ["FUN_1800575f0"]="SystemThreadInitializer"
    ["FUN_180057610"]="SystemThreadTerminator"
    ["FUN_180057680"]="SystemThreadScheduler"
    ["FUN_180057730"]="SystemThreadPriorityManager"
    ["FUN_180057790"]="SystemThreadMonitor"
    ["FUN_180057796"]="SystemThreadBalancer"
    ["FUN_180057814"]="SystemGlobalThreadSync"
    ["FUN_180057830"]="SystemThreadPoolManager"
    ["FUN_1800578a0"]="SystemThreadFinalizer"
    ["FUN_180057980"]="SystemAsyncProcessor"
    ["FUN_180057bf0"]="SystemEventHandler"
    ["FUN_180057d70"]="SystemEventDispatcher"
    ["FUN_180057e90"]="SystemEventListener"
    ["FUN_180057ec0"]="SystemEventFilter"
    ["FUN_180057ee0"]="SystemEventProcessor"
    ["FUN_180057f10"]="SystemEventQueueManager"
    ["FUN_180057f30"]="SystemEventLogger"
    ["FUN_180058000"]="SystemEventNotifier"
    ["FUN_180058020"]="SystemEventBroadcaster"
    ["FUN_180058160"]="SystemEventHistoryManager"
    ["FUN_180058210"]="SystemEventInitializer"
    ["FUN_1800582b0"]="SystemEventCleaner"
    ["FUN_180058370"]="SystemEventValidator"
    ["FUN_180058420"]="SystemEventSynchronizer"
    ["FUN_1800584e0"]="SystemEventManager"
    ["FUN_1800586e0"]="SystemEventFinalizer"
    ["FUN_180058710"]="SystemEventOptimizer"
    ["FUN_1800587d0"]="SystemEventHandlerManager"
    ["FUN_1800587e2"]="SystemEventChecker"
    ["FUN_180058826"]="SystemEventQuickCheck"
    ["FUN_180058830"]="SystemEventMonitor"
    ["FUN_1800588c0"]="SystemEventScheduler"
    ["FUN_1800588fc"]="SystemEventCoordinator"
    ["FUN_18005892b"]="SystemGlobalEventFinalizer"
    ["FUN_18005895a"]="SystemQuickEventFinalizer"
    ["FUN_1800589a3"]="SystemEventHandlerFinalizer"
    ["FUN_180058a20"]="SystemEventProcessorFinalizer"
    ["FUN_180058a31"]="SystemEventDispatcherFinalizer"
    ["FUN_180058b3e"]="SystemEventListenerFinalizer"
    ["FUN_180058bfa"]="SystemGlobalFinalizer"
    ["FUN_180058c16"]="SystemQuickFinalizer"
    ["FUN_180058c20"]="SystemFinalizer"
    ["FUN_180058c80"]="SystemMemoryManagerFinalizer"
    ["FUN_180058cc0"]="SystemResourceManagerFinalizer"
    ["FUN_180058d20"]="SystemThreadManagerFinalizer"
    ["FUN_180058d90"]="SystemEventManagerFinalizer"
    ["FUN_180058db0"]="SystemErrorHandlerFinalizer"
    ["FUN_180058e60"]="SystemValidatorFinalizer"
    ["FUN_180058e90"]="SystemOptimizerFinalizer"
    ["FUN_180058f00"]="SystemCleanupFinalizer"
    ["FUN_180059000"]="SystemUltimateFinalizer"
    ["FUN_1800591c0"]="SystemMemoryTrackerFinalizer"
    ["FUN_180059230"]="SystemResourceTrackerFinalizer"
    ["FUN_1800592e4"]="SystemGarbageFinalizer"
    ["FUN_180059350"]="SystemCacheFinalizer"
    ["FUN_180059380"]="SystemThreadTrackerFinalizer"
    ["FUN_1800593f0"]="SystemEventTrackerFinalizer"
    ["FUN_1800594b0"]="SystemEventHandlerFinalizer"
    ["FUN_1800595c0"]="SystemEventListenerFinalizer"
    ["FUN_180059620"]="SystemEventQueueFinalizer"
    ["FUN_180059640"]="SystemEventHistoryFinalizer"
    ["FUN_1800596a0"]="SystemEventLogFinalizer"
    ["FUN_180059730"]="SystemPerformanceFinalizer"
    ["FUN_180059820"]="SystemMonitorFinalizer"
    ["FUN_180059940"]="SystemBalancerFinalizer"
    ["FUN_1800599c0"]="SystemSchedulerFinalizer"
    ["FUN_1800599df"]="SystemQuickSchedulerFinalizer"
    ["FUN_180059a04"]="SystemStateFinalizer"
    ["FUN_180059a20"]="SystemConfigurationFinalizer"
    ["FUN_180059ba0"]="SystemInitializerFinalizer"
    ["FUN_180059bc0"]="SystemCleanupComplete"
    ["FUN_180059ee4"]="SystemResourceCleanupFinalizer"
    ["FUN_180059ef9"]="SystemQuickCleanupComplete"
    ["FUN_180059f4f"]="SystemMemoryCleanupComplete"
    ["FUN_180059fb0"]="SystemThreadCleanupFinalizer"
    ["FUN_180059fc0"]="SystemEventCleanupFinalizer"
    ["FUN_18005a010"]="SystemPerformanceCleanupFinalizer"
    ["FUN_18005a050"]="SystemMonitorCleanupFinalizer"
    ["FUN_18005a100"]="SystemBalancerCleanupFinalizer"
    ["FUN_18005a130"]="SystemSchedulerCleanupFinalizer"
    ["FUN_18005a170"]="SystemStateCleanupFinalizer"
    ["FUN_18005a200"]="SystemConfigurationCleanupFinalizer"
    ["FUN_18005a500"]="SystemInitializerCleanupFinalizer"
    ["FUN_18005a9a0"]="SystemMemoryCleanupCompleteFinalizer"
    ["FUN_18005aaf0"]="SystemUltimateCleanupComplete"
)

# 批量替换函数名
for old_name in "${!FUNCTION_MAP[@]}"; do
    new_name="${FUNCTION_MAP[$old_name]}"
    echo "替换 $old_name 为 $new_name"
    sed -i "s/\b$old_name\b/$new_name/g" "$TEMP_FILE"
done

# 参数名美化
sed -i 's/\bparam_\([0-9]\+\)/parameter\1/g' "$TEMP_FILE"

# 局部变量美化
sed -i 's/\blStack_\([0-9a-fA-F]\+\)/localStack\1/g' "$TEMP_FILE"
sed -i 's/\buStack_\([0-9a-fA-F]\+\)/unsignedStack\1/g' "$TEMP_FILE"
sed -i 's/\bauStack_\([0-9a-fA-F]\+\)/arrayStack\1/g' "$TEMP_FILE"
sed -i 's/\bpuStack_\([0-9a-fA-F]\+\)/pointerStack\1/g' "$TEMP_FILE"

# 系统变量美化
sed -i 's/\bunsignedSystemValue\([0-9]\+\)/systemValue\1/g' "$TEMP_FILE"
sed -i 's/\blocalResourceOffset\b/resourceOffset/g' "$TEMP_FILE"
sed -i 's/\blocalBufferAddress\b/bufferAddress/g' "$TEMP_FILE"
sed -i 's/\blocalMemoryPointer\b/memoryPointer/g' "$TEMP_FILE"
sed -i 's/\blocalSystemHandle\b/systemHandle/g' "$TEMP_FILE"

# 复制回原文件
cp "$TEMP_FILE" "$INPUT_FILE"

# 清理临时文件
rm -f "$TEMP_FILE"

echo "批量重命名完成"