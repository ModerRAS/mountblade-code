#!/bin/bash

# 批量美化06_utilities.c文件中的Unwind函数名
# 这个脚本会将Unwind_开头的函数名重命名为更有意义的名称

FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c"

# 创建备份
cp "$FILE" "$FILE.backup"

# 定义函数名映射
declare -A function_mapping=(
    ["Unwind_1809074a0"]="ReleaseResourceFlagBit1"
    ["Unwind_1809074d0"]="ValidateResourceHashAndRelease"
    ["Unwind_1809074e0"]="ReleaseResourceFlagBit2"
    ["Unwind_1809074f0"]="ReleaseResourceFlagBit3"
    ["Unwind_180907500"]="ReleaseResourceFlagBit4"
    ["Unwind_180907530"]="ReleaseResourceFlagBit5"
    ["Unwind_180907540"]="ReleaseResourceFlagBit6"
    ["Unwind_180907550"]="ReleaseResourceFlagBit7"
    ["Unwind_180907560"]="ReleaseResourceFlagBit8"
    ["Unwind_180907570"]="ReleaseResourceFlagBit9"
    ["Unwind_180907580"]="ReleaseResourceFlagBit10"
    ["Unwind_180907590"]="ReleaseResourceFlagBit11"
    ["Unwind_1809075a0"]="ReleaseResourceFlagBit12"
    ["Unwind_1809075b0"]="ReleaseResourceFlagBit13"
    ["Unwind_1809075c0"]="ReleaseResourceFlagBit14"
    ["Unwind_1809075d0"]="ReleaseResourceFlagBit15"
    ["Unwind_1809075e0"]="ReleaseResourceFlagBit16"
    ["Unwind_1809075f0"]="ReleaseResourceFlagBit17"
    ["Unwind_180907610"]="ReleaseResourceFlagBit18"
    ["Unwind_180907620"]="ReleaseResourceFlagBit19"
    ["Unwind_180907630"]="ReleaseResourceFlagBit20"
    ["Unwind_180907640"]="ReleaseResourceFlagBit21"
    ["Unwind_180907670"]="ReleaseResourceFlagBit22"
    ["Unwind_1809076a0"]="ReleaseResourceFlagBit23"
    ["Unwind_1809076b0"]="ReleaseResourceFlagBit24"
    ["Unwind_1809076c0"]="ReleaseResourceFlagBit25"
    ["Unwind_1809076d0"]="ReleaseResourceFlagBit26"
    ["Unwind_1809076e0"]="ReleaseResourceFlagBit27"
    ["Unwind_1809076f0"]="ReleaseResourceFlagBit28"
    ["Unwind_180907700"]="ReleaseResourceFlagBit29"
    ["Unwind_180907710"]="ReleaseResourceFlagBit30"
    ["Unwind_180907720"]="ReleaseResourceFlagBit31"
    ["Unwind_180907740"]="ReleaseResourceFlagBit32"
    ["Unwind_180907750"]="ReleaseResourceFlagBit33"
    ["Unwind_180907780"]="CleanupSystemResources1"
    ["Unwind_180907790"]="CleanupSystemResources2"
    ["Unwind_1809077a0"]="CleanupSystemResources3"
    ["Unwind_1809077b0"]="CleanupSystemResources4"
    ["Unwind_1809077c0"]="CleanupSystemResources5"
    ["Unwind_1809077d0"]="CleanupSystemResources6"
    ["Unwind_180907880"]="ProcessResourceCleanup1"
    ["Unwind_1809078a0"]="ProcessResourceCleanup2"
    ["Unwind_1809078b0"]="ProcessResourceCleanup3"
    ["Unwind_1809078c0"]="ProcessResourceCleanup4"
    ["Unwind_1809078d0"]="ProcessResourceCleanup5"
    ["Unwind_1809078e0"]="ProcessResourceCleanup6"
    ["Unwind_1809078f0"]="ProcessResourceCleanup7"
    ["Unwind_180907900"]="ProcessResourceCleanup8"
    ["Unwind_180907910"]="ProcessResourceCleanup9"
    ["Unwind_180907920"]="ProcessResourceCleanup10"
    ["Unwind_180907930"]="ProcessResourceCleanup11"
    ["Unwind_180907940"]="ProcessResourceCleanup12"
    ["Unwind_180907950"]="ProcessResourceCleanup13"
    ["Unwind_180907960"]="ProcessResourceCleanup14"
    ["Unwind_180907970"]="ProcessResourceCleanup15"
    ["Unwind_180907980"]="ProcessResourceCleanup16"
    ["Unwind_180907990"]="ProcessResourceCleanup17"
    ["Unwind_1809079a0"]="ProcessResourceCleanup18"
    ["Unwind_1809079b0"]="ProcessResourceCleanup19"
    ["Unwind_180907a50"]="ValidateResourceAccess1"
    ["Unwind_180907a60"]="ValidateResourceAccess2"
    ["Unwind_180907a70"]="ValidateResourceAccess3"
    ["Unwind_180907a80"]="ValidateResourceAccess4"
    ["Unwind_180907a90"]="ValidateResourceAccess5"
    ["Unwind_180907c30"]="ReleaseSystemMemory1"
    ["Unwind_180907c60"]="ReleaseSystemMemory2"
    ["Unwind_180907c80"]="ReleaseSystemMemory3"
    ["Unwind_180907c90"]="ReleaseSystemMemory4"
    ["Unwind_180907ca0"]="ReleaseSystemMemory5"
    ["Unwind_180907cb0"]="ReleaseSystemMemory6"
    ["Unwind_180907cc0"]="ReleaseSystemMemory7"
    ["Unwind_180907cd0"]="ReleaseSystemMemory8"
    ["Unwind_180907ce0"]="ReleaseSystemMemory9"
    ["Unwind_180907cf0"]="ReleaseSystemMemory10"
    ["Unwind_180907d00"]="ReleaseSystemMemory11"
    ["Unwind_180907d10"]="ReleaseSystemMemory12"
    ["Unwind_180907d20"]="ReleaseSystemMemory13"
    ["Unwind_180907d30"]="ReleaseSystemMemory14"
    ["Unwind_180907d40"]="ReleaseSystemMemory15"
    ["Unwind_180907d50"]="ReleaseSystemMemory16"
    ["Unwind_180907d80"]="ReleaseSystemMemory17"
    ["Unwind_180907db0"]="ReleaseSystemMemory18"
    ["Unwind_180907dc0"]="ReleaseSystemMemory19"
    ["Unwind_180907dd0"]="ReleaseSystemMemory20"
    ["Unwind_180907e00"]="ReleaseSystemMemory21"
    ["Unwind_180907e30"]="ReleaseSystemMemory22"
    ["Unwind_180907e40"]="ReleaseSystemMemory23"
    ["Unwind_180907e50"]="ReleaseSystemMemory24"
    ["Unwind_180907e60"]="ReleaseSystemMemory25"
    ["Unwind_180907e70"]="ReleaseSystemMemory26"
    ["Unwind_180907e80"]="ReleaseSystemMemory27"
    ["Unwind_180907e90"]="ReleaseSystemMemory28"
    ["Unwind_180907ea0"]="ReleaseSystemMemory29"
    ["Unwind_180907eb0"]="ReleaseSystemMemory30"
    ["Unwind_180907ec0"]="ReleaseSystemMemory31"
    ["Unwind_180907ed0"]="ReleaseSystemMemory32"
    ["Unwind_180907ee0"]="ReleaseSystemMemory33"
    ["Unwind_180907ef0"]="ReleaseSystemMemory34"
    ["Unwind_180907f00"]="ReleaseSystemMemory35"
    ["Unwind_180907f10"]="ReleaseSystemMemory36"
    ["Unwind_180907f20"]="ReleaseSystemMemory37"
    ["Unwind_180907f40"]="ReleaseSystemMemory38"
    ["Unwind_180907f60"]="ReleaseSystemMemory39"
    ["Unwind_180907f70"]="ReleaseSystemMemory40"
    ["Unwind_180907f80"]="ReleaseSystemMemory41"
    ["Unwind_180907fb0"]="ReleaseSystemMemory42"
    ["Unwind_180907fe0"]="ReleaseSystemMemory43"
    ["Unwind_180907ff0"]="ReleaseSystemMemory44"
    ["Unwind_180908000"]="ReleaseSystemMemory45"
    ["Unwind_180908010"]="ReleaseSystemMemory46"
    ["Unwind_180908020"]="ReleaseSystemMemory47"
    ["Unwind_180908030"]="ReleaseSystemMemory48"
    ["Unwind_180908040"]="FinalizeSystemCleanup1"
    ["Unwind_180908050"]="FinalizeSystemCleanup2"
    ["Unwind_180908060"]="FinalizeSystemCleanup3"
    ["Unwind_180908070"]="FinalizeSystemCleanup4"
    ["Unwind_1809080a0"]="FinalizeSystemCleanup5"
    ["Unwind_1809080b0"]="FinalizeSystemCleanup6"
    ["Unwind_1809080c0"]="FinalizeSystemCleanup7"
    ["Unwind_1809080d0"]="FinalizeSystemCleanup8"
    ["Unwind_1809080e0"]="FinalizeSystemCleanup9"
    ["Unwind_1809080f0"]="FinalizeSystemCleanup10"
    ["Unwind_180908100"]="FinalizeSystemCleanup11"
    ["Unwind_180908110"]="FinalizeSystemCleanup12"
    ["Unwind_180908120"]="FinalizeSystemCleanup13"
    ["Unwind_180908130"]="FinalizeSystemCleanup14"
    ["Unwind_180908140"]="FinalizeSystemCleanup15"
    ["Unwind_180908150"]="FinalizeSystemCleanup16"
    ["Unwind_180908160"]="FinalizeSystemCleanup17"
    ["Unwind_180908170"]="FinalizeSystemCleanup18"
    ["Unwind_180908180"]="FinalizeSystemCleanup19"
    ["Unwind_180908190"]="FinalizeSystemCleanup20"
    ["Unwind_180908210"]="FinalizeSystemCleanup21"
    ["Unwind_1809082c0"]="FinalizeSystemCleanup22"
    ["Unwind_1809085d0"]="FinalizeSystemCleanup23"
    ["Unwind_180908600"]="FinalizeSystemCleanup24"
    ["Unwind_180908630"]="FinalizeSystemCleanup25"
    ["Unwind_180908650"]="FinalizeSystemCleanup26"
    ["Unwind_180908660"]="FinalizeSystemCleanup27"
    ["Unwind_180908670"]="FinalizeSystemCleanup28"
    ["Unwind_180908690"]="FinalizeSystemCleanup29"
    ["Unwind_1809086b0"]="FinalizeSystemCleanup30"
    ["Unwind_1809086d0"]="FinalizeSystemCleanup31"
    ["Unwind_180908710"]="FinalizeSystemCleanup32"
    ["Unwind_180908730"]="FinalizeSystemCleanup33"
    ["Unwind_180908750"]="FinalizeSystemCleanup34"
    ["Unwind_180908760"]="FinalizeSystemCleanup35"
    ["Unwind_180908770"]="FinalizeSystemCleanup36"
    ["Unwind_1809087d0"]="FinalizeSystemCleanup37"
    ["Unwind_180908800"]="FinalizeSystemCleanup38"
    ["Unwind_180908810"]="FinalizeSystemCleanup39"
    ["Unwind_180908820"]="FinalizeSystemCleanup40"
    ["Unwind_180908830"]="FinalizeSystemCleanup41"
    ["Unwind_180908840"]="FinalizeSystemCleanup42"
    ["Unwind_180908850"]="FinalizeSystemCleanup43"
    ["Unwind_180908860"]="FinalizeSystemCleanup44"
    ["Unwind_180908870"]="FinalizeSystemCleanup45"
    ["Unwind_180908880"]="FinalizeSystemCleanup46"
    ["Unwind_180908890"]="FinalizeSystemCleanup47"
    ["Unwind_1809088a0"]="FinalizeSystemCleanup48"
    ["Unwind_1809088d0"]="FinalizeSystemCleanup49"
    ["Unwind_180908910"]="FinalizeSystemCleanup50"
    ["Unwind_180908920"]="FinalizeSystemCleanup51"
    ["Unwind_180908950"]="FinalizeSystemCleanup52"
    ["Unwind_180908980"]="FinalizeSystemCleanup53"
    ["Unwind_180908990"]="FinalizeSystemCleanup54"
    ["Unwind_1809089a0"]="FinalizeSystemCleanup55"
    ["Unwind_1809089b0"]="FinalizeSystemCleanup56"
    ["Unwind_1809089e0"]="FinalizeSystemCleanup57"
    ["Unwind_180908a50"]="FinalizeSystemCleanup58"
    ["Unwind_180908a60"]="FinalizeSystemCleanup59"
    ["Unwind_180908a70"]="FinalizeSystemCleanup60"
    ["Unwind_180908a80"]="FinalizeSystemCleanup61"
    ["Unwind_180908a90"]="FinalizeSystemCleanup62"
    ["Unwind_180908aa0"]="FinalizeSystemCleanup63"
    ["Unwind_180908ab0"]="FinalizeSystemCleanup64"
    ["Unwind_180908ac0"]="FinalizeSystemCleanup65"
    ["Unwind_180908ad0"]="FinalizeSystemCleanup66"
    ["Unwind_180908ae0"]="FinalizeSystemCleanup67"
    ["Unwind_180908af0"]="FinalizeSystemCleanup68"
    ["Unwind_180908b00"]="FinalizeSystemCleanup69"
    ["Unwind_180908b10"]="FinalizeSystemCleanup70"
    ["Unwind_180908b20"]="FinalizeSystemCleanup71"
    ["Unwind_180908b30"]="FinalizeSystemCleanup72"
    ["Unwind_180908b40"]="FinalizeSystemCleanup73"
    ["Unwind_180908b50"]="FinalizeSystemCleanup74"
    ["Unwind_180908b60"]="FinalizeSystemCleanup75"
    ["Unwind_180908b70"]="FinalizeSystemCleanup76"
    ["Unwind_180908b80"]="FinalizeSystemCleanup77"
    ["Unwind_180908b90"]="FinalizeSystemCleanup78"
    ["Unwind_180908ba0"]="FinalizeSystemCleanup79"
    ["Unwind_180908bb0"]="FinalizeSystemCleanup80"
    ["Unwind_180908bc0"]="FinalizeSystemCleanup81"
    ["Unwind_180908bd0"]="FinalizeSystemCleanup82"
    ["Unwind_180908be0"]="FinalizeSystemCleanup83"
    ["Unwind_180908bf0"]="FinalizeSystemCleanup84"
    ["Unwind_180908c00"]="FinalizeSystemCleanup85"
    ["Unwind_180908c10"]="FinalizeSystemCleanup86"
    ["Unwind_180908c20"]="FinalizeSystemCleanup87"
    ["Unwind_180908c30"]="FinalizeSystemCleanup88"
    ["Unwind_180908c40"]="FinalizeSystemCleanup89"
    ["Unwind_180908c50"]="FinalizeSystemCleanup90"
    ["Unwind_180908c60"]="FinalizeSystemCleanup91"
    ["Unwind_180908c70"]="FinalizeSystemCleanup92"
    ["Unwind_180908c80"]="FinalizeSystemCleanup93"
    ["Unwind_180908c90"]="FinalizeSystemCleanup94"
    ["Unwind_180908ca0"]="FinalizeSystemCleanup95"
    ["Unwind_180908cd0"]="FinalizeSystemCleanup96"
    ["Unwind_180908d00"]="FinalizeSystemCleanup97"
    ["Unwind_180908d50"]="FinalizeSystemCleanup98"
    ["Unwind_180908d60"]="FinalizeSystemCleanup99"
    ["Unwind_180908d70"]="FinalizeSystemCleanup100"
    ["Unwind_180908d80"]="FinalizeSystemCleanup101"
    ["Unwind_180908db0"]="FinalizeSystemCleanup102"
    ["Unwind_180908dc0"]="FinalizeSystemCleanup103"
    ["Unwind_180908dd0"]="FinalizeSystemCleanup104"
    ["Unwind_180908de0"]="FinalizeSystemCleanup105"
    ["Unwind_180908df0"]="FinalizeSystemCleanup106"
    ["Unwind_180908e00"]="FinalizeSystemCleanup107"
    ["Unwind_180908e10"]="FinalizeSystemCleanup108"
    ["Unwind_180908e40"]="FinalizeSystemCleanup109"
    ["Unwind_180908e50"]="FinalizeSystemCleanup110"
    ["Unwind_180908e60"]="FinalizeSystemCleanup111"
    ["Unwind_180908e70"]="FinalizeSystemCleanup112"
    ["Unwind_180908e80"]="FinalizeSystemCleanup113"
    ["Unwind_180908e90"]="FinalizeSystemCleanup114"
    ["Unwind_180908ea0"]="FinalizeSystemCleanup115"
    ["Unwind_180908eb0"]="FinalizeSystemCleanup116"
)

# 执行替换
for old_name in "${!function_mapping[@]}"; do
    new_name="${function_mapping[$old_name]}"
    echo "替换: $old_name -> $new_name"
    sed -i "s/void $old_name(/void $new_name(/g" "$FILE"
    sed -i "s/$old_name(/$new_name(/g" "$FILE"
done

echo "函数名替换完成"