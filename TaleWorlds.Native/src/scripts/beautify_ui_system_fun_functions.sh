#!/bin/bash

# 美化04_ui_system.c文件中的FUN函数
# 这个脚本会重命名FUN函数为更有意义的名称

cd /dev/shm/mountblade-code/TaleWorlds.Native/src

# 定义FUN函数映射
declare -A function_mappings=(
    ["FUN_18065fdb0"]="CalculateUIAnimationValue"
    ["FUN_180403910"]="ProcessUIResourceData"
    ["FUN_180405240"]="UpdateUIAnimationState"
    ["FUN_18040dbf0"]="RenderUIAnimationFrame"
    ["FUN_180403be0"]="ApplyUITransform"
    ["FUN_18065fa20"]="ProcessUIMatrixOperation"
    ["FUN_18022b240"]="UpdateUISemaphore"
    ["FUN_18040b910"]="RenderUIBlendBuffer"
    ["FUN_1801c13c0"]="CalculateUIFrameTransform"
    ["FUN_180535610"]="GetUIAnimationContext"
    ["FUN_1806631b0"]="UpdateUIShaderParameter"
    ["FUN_1801c10f0"]="CreateUIVertexBuffer"
    ["FUN_1801c0fb0"]="UpdateUITextureCoordinates"
    ["FUN_180285c90"]="ProcessUIVertexData"
    ["FUN_180300b10"]="InitializeUIRenderState"
    ["FUN_1801503e0"]="CalculateUIMemoryOffset"
    ["FUN_180300bf0"]="CreateUIIndexBuffer"
    ["FUN_18063b720"]="ApplyUILightingEffect"
    ["FUN_18066d210"]="ProcessUIEventQueue"
    ["FUN_18066d130"]="HandleUIEvent"
    ["FUN_18066eea0"]="UpdateUIComponentState"
    ["FUN_18066d370"]="DispatchUIEvent"
    ["FUN_18066e500"]="ExecuteUIEventHandler"
    ["FUN_18066f080"]="CreateUISemaphore"
    ["FUN_18066ef60"]="AcquireUILock"
    ["FUN_18066efd0"]="UpdateUIElementSize"
    ["FUN_18066e8f0"]="AllocateUIMemory"
    ["FUN_1806725c0"]="InitializeUIRendering"
    ["FUN_180673970"]="SetupUIVertexShader"
    ["FUN_180673f50"]="SetupUIPixelShader"
    ["FUN_180674040"]="ConfigureUIBlendState"
    ["FUN_1806742a0"]="SetupUIDepthStencil"
    ["FUN_1806743e0"]="ConfigureUIRasterizer"
    ["FUN_1806744d0"]="InitializeUITextureSampler"
    ["FUN_180674610"]="SetupUIRenderTargets"
    ["FUN_180676930"]="RegisterUIEventCallback"
    ["FUN_180677190"]="SetupUIEventFilter"
    ["FUN_180676320"]="InitializeUIVertexBuffers"
    ["FUN_1806760f0"]="ProcessUIMatrixTransform"
    ["FUN_180676490"]="SetupUIRenderPipeline"
    ["FUN_180676700"]="InitializeUIInputHandler"
    ["FUN_180677300"]="ConfigureUIGestureRecognition"
    ["FUN_180676aa0"]="SetupUILayoutConstraints"
    ["FUN_180677530"]="ApplyUILayoutRules"
    ["FUN_1806780c0"]="InitializeUIResourceManager"
    ["FUN_1806782c0"]="UpdateUIState"
    ["FUN_180678430"]="DispatchUIEvents"
    ["FUN_180678540"]="UpdateUIRenderState"
    ["FUN_180678810"]="ManageUIMemory"
    ["FUN_1806789c0"]="ScheduleUITasks"
    ["FUN_180678b10"]="SynchronizeUIThreads"
    ["FUN_180678bc0"]="ExecuteUITask"
    ["FUN_180678e20"]="InitializeUIFontSystem"
    ["FUN_180678ef0"]="ManageUITextures"
    ["FUN_180678fc0"]="CompileUIShaders"
    ["FUN_1806790b0"]="SetupUIConstantBuffer"
    ["FUN_180679310"]="ConfigureUITextureSampler"
    ["FUN_180679480"]="InitializeUIComputeShader"
    ["FUN_1806795f0"]="SetupUIGeometryShader"
    ["FUN_1806796f0"]="ConfigureUITessellation"
    ["FUN_18067c470"]="InitializeUIComputePipeline"
    ["FUN_1806844a0"]="SetupUIGeometryPipeline"
    ["FUN_180679d30"]="ConfigureUIVertexInput"
    ["FUN_18068b080"]="SetupUIPixelOutput"
    ["FUN_180683f90"]="InitializeUIComputeContext"
    ["FUN_18068d2b0"]="SetupUIRenderTarget"
    ["FUN_1806905c0"]="ConfigureUIDepthBuffer"
    ["FUN_180679ac0"]="InitializeUIStencilState"
    ["FUN_180679b20"]="SetupUIBlendMode"
    ["FUN_1806917c0"]="ConfigureUICullMode"
    ["FUN_180691db0"]="SetupUIFillMode"
    ["FUN_18068d480"]="InitializeUIPrimitiveTopology"
    ["FUN_180697770"]="SetupUIIndexBuffer"
    ["FUN_180677100"]="ConfigureUIVertexFormat"
    ["FUN_18068d4b0"]="InitializeUIInputLayout"
    ["FUN_18068d530"]="SetupUIVertexDeclaration"
    ["FUN_18068d5b0"]="ConfigureUIVertexStream"
    ["FUN_18068d630"]="SetupUIInstanceData"
    ["FUN_18068d6b0"]="InitializeUIVertexBuffer"
    ["FUN_18068d730"]="ConfigureUIVertexStride"
    ["FUN_18068d7b0"]="SetupUIVertexOffset"
    ["FUN_18068d8d0"]="InitializeUIVertexFrequency"
    ["FUN_18068d9f0"]="ConfigureUIVertexDivisor"
    ["FUN_18068db10"]="SetupUIInstanceStepRate"
    ["FUN_18068dc30"]="InitializeUIVertexAttributes"
    ["FUN_18068dd50"]="ConfigureUIVertexSemantic"
    ["FUN_18068de70"]="SetupUIVertexFormat"
    ["FUN_18068def0"]="InitializeUIVertexClassification"
    ["FUN_18068df70"]="ConfigureUIVertexInputRate"
    ["FUN_18068dff0"]="InitializeUIVertexBinding"
    ["FUN_18068e070"]="ConfigureUIVertexSlot"
    ["FUN_18068e250"]="InitializeUIVertexAlignment"
    ["FUN_18068e430"]="SetupUIVertexPadding"
    ["FUN_18068e610"]="ConfigureUIVertexCompression"
    ["FUN_18068e7f0"]="InitializeUIVertexQuantization"
    ["FUN_18068e870"]="SetupUIVertexNormalization"
    ["FUN_18068e8f0"]="ConfigureUIVertexTransformation"
    ["FUN_18068e970"]="InitializeUIVertexProjection"
    ["FUN_18068e9f0"]="SetupUIViewportTransform"
    ["FUN_18068ea70"]="ConfigureUIViewportScaling"
    ["FUN_18068eaf0"]="InitializeUIViewportClipping"
    ["FUN_18068eb60"]="SetupUIViewportCulling"
    ["FUN_18068ebd0"]="ConfigureUIViewportScissor"
    ["FUN_18068ecb0"]="InitializeUIViewportMasking"
    ["FUN_18068ed20"]="SetupUIViewportStereo"
    ["FUN_18068ed90"]="ConfigureUIViewportMultiview"
    ["FUN_18068f150"]="InitializeUIViewportLayer"
    ["FUN_18068f240"]="SetupUIViewportArray"
    ["FUN_18068fdd0"]="ConfigureUIViewportInstancing"
    ["FUN_18068fe10"]="InitializeUIViewportMultiSampling"
    ["FUN_18068ff60"]="SetupUIViewportAntiAliasing"
    ["FUN_180690200"]="ConfigureUIViewportPostProcessing"
    ["FUN_18066e7a0"]="InitializeUIRenderContext"
    ["FUN_180697e60"]="CreateUIRenderBuffer"
    ["FUN_180697ed0"]="ReleaseUIRenderBuffer"
    ["FUN_180698140"]="FinalizeUIRenderContext"
    ["FUN_18069c540"]="CopyUIRenderData"
    ["FUN_18066ea6a"]="GetUserInterfaceSystemStatus"
    ["FUN_18066ea80"]="InitializeUserInterfaceMemoryPool"
    ["FUN_18066e960"]="AllocateUIMemoryPool"
    ["FUN_180671080"]="ProcessUISystemInstance"
    ["FUN_180698e20"]="UpdateUIRenderConfiguration"
    ["FUN_18066e9b0"]="GetUISemaphoreIndex"
    ["FUN_18069a490"]="GetUISemaphoreCount"
    ["FUN_18069cf80"]="GetUIResourceIndex"
    ["FUN_18069c080"]="UpdateUIRenderTargets"
    ["FUN_18069d280"]="RenderUIPrimitive"
    ["FUN_18069c200"]="UpdateUIConstantBuffers"
    ["FUN_18069de90"]="FinalizeUIRenderPass"
    ["FUN_18069c820"]="UpdateUIShaderConstants"
    ["FUN_18069c710"]="UpdateUITextureSamplers"
    ["FUN_18066f6fa"]="InitializeUISystemDataStructures"
)

# 遍历所有映射并执行替换
for old_name in "${!function_mappings[@]}"; do
    new_name="${function_mappings[$old_name]}"
    
    # 使用sed进行替换，确保只替换完整的函数名
    sed -i "s/\b$old_name\b/$new_name/g" 04_ui_system.c
    
    echo "已替换: $old_name -> $new_name"
done

echo "FUN函数美化完成"