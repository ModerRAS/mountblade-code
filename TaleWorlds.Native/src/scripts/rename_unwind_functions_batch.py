#!/usr/bin/env python3
"""
批量重命名Unwind函数的脚本
专门处理06_utilities.c中的Unwind函数
"""

import re
import sys

def generate_unwind_function_mappings():
    """生成Unwind函数的映射关系"""
    mappings = []
    
    # 根据函数地址后缀推测功能
    unwind_functions = {
        '050100': 'InitializeSystemResources',
        '050160': 'ProcessResourceAllocation',
        '050170': 'HandleResourceCreation',
        '050180': 'ValidateResourceState',
        '050190': 'CheckResourceAvailability',
        '0501a0': 'PrepareResourceContext',
        '0501d0': 'SetupResourceEnvironment',
        '0501e0': 'ConfigureResourceSettings',
        '0501f0': 'ExecuteResourceInitialization',
        '050200': 'CompleteResourceSetup',
        '050210': 'FinalizeResourceConfiguration',
        '050220': 'ValidateResourceIntegrity',
        '050230': 'CheckResourceConsistency',
        '050240': 'VerifyResourceCompatibility',
        '050250': 'ProcessResourceValidation',
        '050260': 'HandleResourceVerification',
        '050270': 'ExecuteResourceChecks',
        '050280': 'CompleteResourceValidation',
        '050290': 'FinalizeResourceChecks',
        '0502a0': 'PrepareResourceForUse',
        '0502b0': 'SetupResourceOperationalState',
        '0502c0': 'InitializeResourceHandlers',
        '050380': 'ConfigureResourceManagement',
        '050390': 'SetupResourceControl',
        '0503a0': 'InitializeResourceMonitoring',
        '0503b0': 'SetupResourceTracking',
        '0503c0': 'ConfigureResourceLogging',
        '0503d0': 'InitializeResourceReporting',
        '0503e0': 'SetupResourceMetrics',
        '0503f0': 'ConfigureResourcePerformance',
        '050400': 'InitializeResourceOptimization',
        '050410': 'SetupResourceEfficiency',
        '050420': 'ConfigureResourceScaling',
        '050430': 'InitializeResourceBalancing',
        '050440': 'SetupResourceDistribution',
        '050450': 'ConfigureResourceAllocation',
        '050460': 'InitializeResourceScheduling',
        '0504f0': 'HandleResourcePriority',
        '050540': 'ManageResourceQueue',
        '050560': 'ProcessResourceRequests',
        '0505b0': 'HandleResourceCallbacks',
        '0505c0': 'ProcessResourceEvents',
        '0506b0': 'ManageResourceNotifications',
        '0506c0': 'HandleResourceAlerts',
        '0506e0': 'ProcessResourceWarnings',
        '050700': 'HandleResourceErrors',
        '050710': 'ProcessResourceExceptions',
        '050720': 'HandleResourceFailures',
        '050730': 'ProcessResourceRecovery',
        '050740': 'HandleResourceRestoration',
        '050770': 'ExecuteResourceRepair',
        '050780': 'HandleResourceMaintenance',
        '0507b0': 'ProcessResourceOptimization',
        '0507c0': 'HandleResourceTuning',
        '0507e0': 'ProcessResourceImprovement',
        '0507f0': 'HandleResourceEnhancement',
        '050800': 'ProcessResourceUpgrades',
        '050810': 'HandleResourceUpdates',
        '050830': 'ProcessResourceRefresh',
        '050840': 'HandleResourceReload',
        '050860': 'ExecuteResourceRestart',
        '0508e0': 'HandleResourceReset',
        '050950': 'ProcessResourceReinitialization',
        '050960': 'HandleResourceRecycling',
        '050980': 'ProcessResourceCleanup',
        '0509a0': 'HandleResourceDisposal',
        '0509b0': 'ExecuteResourceDeallocation',
        '0509c0': 'HandleResourceRelease',
        '0509f0': 'ProcessResourceDestruction',
        '050b10': 'HandleResourceTermination',
        '050b40': 'ProcessResourceShutdown',
        '050b50': 'HandleResourceFinalization',
        '050b90': 'ExecuteResourceCompletion',
        '050c20': 'HandleResourceConclusion',
        '050c30': 'ProcessResourceFinalization',
        '050c40': 'HandleResourceWrapUp',
        '050c50': 'ProcessResourceCleanup',
        '050c60': 'HandleResourceClearing',
        '050c80': 'ProcessResourceReset',
        '050c90': 'HandleResourceRestart',
        '050e40': 'ExecuteResourceRecovery',
        '050e50': 'HandleResourceRestoration',
        '050e70': 'ProcessResourceRepair',
        '050e90': 'HandleResourceFixing',
        '050ea0': 'ProcessResourceCorrection',
        '050ec0': 'HandleResourceAdjustment',
        '050ee0': 'ProcessResourceCalibration',
        '050ef0': 'HandleResourceConfiguration',
        '050f00': 'ExecuteSystemInitialization',
        '050f20': 'HandleSystemSetup',
        '050f40': 'ProcessSystemConfiguration',
        '050f50': 'HandleSystemPreparation',
        '050f60': 'ProcessSystemReadiness',
        '050f70': 'HandleSystemActivation',
        '050f80': 'ProcessSystemStartup',
        '050f90': 'HandleSystemLaunch',
        '050fa0': 'ExecuteSystemBoot',
        '050fc0': 'HandleSystemInitialization',
        '050fe0': 'ProcessSystemSetup',
        '050ff0': 'HandleSystemConfiguration',
        '051180': 'ExecuteSystemPreparation',
        '051190': 'HandleSystemActivation',
        '0511a0': 'ProcessSystemStartup',
        '0511b0': 'HandleSystemLaunch',
        '0511c0': 'ProcessSystemBoot',
        '0511d0': 'HandleSystemInitialization',
        '0511f0': 'ExecuteSystemSetup',
        '052c0': 'HandleSystemConfiguration',
        '052f0': 'ProcessSystemReadiness',
        '05320': 'HandleSystemActivation',
        '05350': 'ProcessSystemStartup',
        '05360': 'HandleSystemLaunch',
        '05390': 'ExecuteSystemBoot',
        '053c0': 'HandleSystemInitialization',
        '053f0': 'ProcessSystemSetup',
        '05400': 'HandleSystemConfiguration',
        '05470': 'ExecuteSystemPreparation',
        '05480': 'HandleSystemActivation',
        '05490': 'ProcessSystemStartup',
        '054a0': 'HandleSystemLaunch',
        '054b0': 'ProcessSystemBoot',
        '054c0': 'HandleSystemInitialization',
        '054d0': 'ExecuteSystemSetup',
        '054e0': 'HandleSystemConfiguration',
        '054f0': 'ProcessSystemReadiness',
        '05500': 'HandleSystemActivation',
        '05510': 'ProcessSystemStartup',
        '05520': 'HandleSystemLaunch',
        '05530': 'ExecuteSystemBoot',
        '05540': 'HandleSystemInitialization',
        '05550': 'ProcessSystemSetup',
        '05560': 'HandleSystemConfiguration',
        '05570': 'ExecuteSystemPreparation',
        '05580': 'HandleSystemActivation',
        '05590': 'ProcessSystemStartup',
        '055a0': 'HandleSystemLaunch',
        '055b0': 'ExecuteSystemBoot',
        '055c0': 'HandleSystemInitialization',
        '055d0': 'ProcessSystemSetup',
        '055e0': 'HandleSystemConfiguration',
        '055f0': 'ExecuteSystemPreparation',
        '05600': 'HandleSystemActivation',
        '05630': 'ProcessSystemStartup',
        '05640': 'HandleSystemLaunch',
        '05660': 'ExecuteSystemBoot',
        '05680': 'HandleSystemInitialization',
        '056a0': 'ProcessSystemSetup',
        '056c0': 'HandleSystemConfiguration',
        '056e0': 'ExecuteSystemPreparation',
        '056810': 'HandleSystemActivation',
        '056830': 'ProcessSystemStartup',
        '056850': 'HandleSystemLaunch',
        '056870': 'ExecuteSystemBoot',
        '056890': 'HandleSystemInitialization',
        '056960': 'ProcessSystemSetup',
        '056970': 'HandleSystemConfiguration',
        '056980': 'ExecuteSystemPreparation',
        '056990': 'HandleSystemActivation',
        '0569a0': 'ProcessSystemStartup',
        '0569b0': 'HandleSystemLaunch',
        '0569c0': 'ExecuteSystemBoot',
        '056a00': 'HandleSystemInitialization',
        '056a10': 'ProcessSystemSetup',
        '056a20': 'HandleSystemConfiguration',
        '056a30': 'ExecuteSystemPreparation',
        '056a40': 'HandleSystemActivation',
        '056a50': 'ProcessSystemStartup',
        '056a60': 'HandleSystemLaunch',
        '056a70': 'ExecuteSystemBoot',
        '056a80': 'HandleSystemInitialization',
        '056a90': 'ProcessSystemSetup',
        '056ac0': 'HandleSystemConfiguration',
        '056ad0': 'ExecuteSystemPreparation',
        '056ae0': 'HandleSystemActivation',
        '056af0': 'ProcessSystemStartup',
        '056b20': 'HandleSystemLaunch',
        '056b30': 'ExecuteSystemBoot',
        '056b40': 'HandleSystemInitialization',
        '056b50': 'ProcessSystemSetup',
        '056b60': 'HandleSystemConfiguration',
        '056b70': 'ExecuteSystemPreparation',
        '056ba0': 'HandleSystemActivation',
        '056bb0': 'ProcessSystemStartup',
        '056bc0': 'HandleSystemLaunch',
        '056bd0': 'ExecuteSystemBoot',
        '056c00': 'HandleSystemInitialization',
        '056c10': 'ProcessSystemSetup',
        '056c20': 'HandleSystemConfiguration',
        '056c30': 'ExecuteSystemPreparation',
        '056c40': 'HandleSystemActivation',
        '056c50': 'ProcessSystemStartup',
        '056c60': 'HandleSystemLaunch',
        '056c70': 'ExecuteSystemBoot',
        '056c80': 'HandleSystemInitialization',
        '056c90': 'ProcessSystemSetup',
        '056ca0': 'HandleSystemConfiguration',
        '056d10': 'ExecuteSystemPreparation',
        '056d20': 'HandleSystemActivation',
        '056d30': 'ProcessSystemStartup',
        '056d40': 'HandleSystemLaunch',
        '056d50': 'ExecuteSystemBoot',
        '056d60': 'HandleSystemInitialization',
        '056d70': 'ProcessSystemSetup',
        '056d80': 'HandleSystemConfiguration',
        '056d90': 'ExecuteSystemPreparation',
        '056da0': 'HandleSystemActivation',
        '056db0': 'ProcessSystemStartup',
        '056dc0': 'HandleSystemLaunch',
        '056dd0': 'ExecuteSystemBoot',
        '056de0': 'HandleSystemInitialization',
        '056df0': 'ProcessSystemSetup',
        '056e00': 'HandleSystemConfiguration',
        '056e10': 'ExecuteSystemPreparation',
        '056e20': 'HandleSystemActivation',
        '056e30': 'ProcessSystemStartup',
        '056e40': 'HandleSystemLaunch',
        '056ec0': 'ExecuteSystemBoot',
        '056ed0': 'HandleSystemInitialization',
        '056ee0': 'ProcessSystemSetup',
        '056ef0': 'HandleSystemConfiguration',
        '056f00': 'ExecuteSystemPreparation',
        '056f10': 'HandleSystemActivation',
        '056f20': 'ProcessSystemStartup',
        '056f30': 'HandleSystemLaunch',
        '056f40': 'ExecuteSystemBoot',
        '056f50': 'HandleSystemInitialization',
        '056f60': 'ProcessSystemSetup',
        '056f70': 'HandleSystemConfiguration',
        '056f80': 'ExecuteSystemPreparation',
        '056f90': 'HandleSystemActivation',
        '056fc0': 'ProcessSystemStartup',
        '056ff0': 'HandleSystemLaunch',
        '057010': 'ExecuteSystemBoot',
        '057020': 'HandleSystemInitialization',
        '057030': 'ProcessSystemSetup',
        '057040': 'HandleSystemConfiguration',
        '0570c0': 'ExecuteSystemPreparation',
        '0570d0': 'HandleSystemActivation',
        '0570e0': 'ProcessSystemStartup',
        '0570f0': 'HandleSystemLaunch',
        '057100': 'ExecuteSystemBoot',
        '057110': 'HandleSystemInitialization',
        '057120': 'ProcessSystemSetup',
        '057130': 'HandleSystemConfiguration',
        '057140': 'ExecuteSystemPreparation',
        '057170': 'HandleSystemActivation',
        '057180': 'ProcessSystemStartup',
        '057190': 'HandleSystemLaunch',
        '0571a0': 'ExecuteSystemBoot',
        '0571b0': 'HandleSystemInitialization',
        '0571c0': 'ProcessSystemSetup',
        '0571d0': 'HandleSystemConfiguration',
        '0571e0': 'ExecuteSystemPreparation',
        '0571f0': 'HandleSystemActivation',
        '057200': 'ProcessSystemStartup',
        '057210': 'HandleSystemLaunch',
        '057230': 'ExecuteSystemBoot',
        '057250': 'HandleSystemInitialization',
        '057270': 'ProcessSystemSetup',
        '057280': 'HandleSystemConfiguration',
        '057290': 'ExecuteSystemPreparation',
        '0572a0': 'HandleSystemActivation',
        '0572c0': 'ProcessSystemStartup',
    }
    
    for suffix, new_name in unwind_functions.items():
        mappings.append((f'Unwind_1809{suffix}', new_name))
    
    return mappings

def process_file(file_path):
    """处理文件，替换Unwind函数名"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # 生成映射
        mappings = generate_unwind_function_mappings()
        
        # 进行替换
        for old_name, new_name in mappings:
            # 替换函数定义
            content = re.sub(
                r'void\s+' + re.escape(old_name) + r'\s*\(',
                f'void {new_name}(',
                content
            )
            # 替换函数调用
            content = re.sub(
                r'\b' + re.escape(old_name) + r'\b',
                new_name,
                content
            )
        
        # 写回文件
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print(f"成功处理文件: {file_path}")
        return True
        
    except Exception as e:
        print(f"处理文件时出错: {e}")
        return False

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("使用方法: python rename_unwind_functions_batch.py <文件路径>")
        sys.exit(1)
    
    file_path = sys.argv[1]
    process_file(file_path)