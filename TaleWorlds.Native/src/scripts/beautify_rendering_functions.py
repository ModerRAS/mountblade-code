#!/usr/bin/env python3
"""
渲染系统代码美化脚本
用于批量重命名03_rendering.c中的函数和变量
"""

import re
import os

def read_file(filepath):
    """读取文件内容"""
    with open(filepath, 'r', encoding='utf-8') as f:
        return f.read()

def write_file(filepath, content):
    """写入文件内容"""
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(content)

def beautify_rendering_functions(content):
    """美化渲染系统函数"""
    
    # 函数重命名映射表
    function_mappings = {
        'FUN_180442020': 'InitializeRenderContext',
        'FUN_1804420c0': 'CreateRenderDevice',
        'FUN_180442180': 'SetupSwapChain',
        'FUN_1804422a0': 'ConfigureRenderPipeline',
        'FUN_180442370': 'InitializeShaderCompiler',
        'FUN_180442450': 'CreateVertexBuffer',
        'FUN_1804424d0': 'CreateIndexBuffer',
        'FUN_180442560': 'CreateConstantBuffer',
        'FUN_180442670': 'CreateTexture2D',
        'FUN_180442720': 'CreateSamplerState',
        'FUN_180442860': 'CreateRenderTarget',
        'FUN_180442950': 'CreateDepthStencil',
        'FUN_1804429f0': 'CreateRenderPass',
        'FUN_180442b30': 'SetupVertexLayout',
        'FUN_180442d10': 'SetPrimitiveTopology',
        'FUN_180442e00': 'CreateRasterizerState',
        'FUN_180443000': 'CreateDepthStencilState',
        'FUN_180443080': 'CreateBlendState',
        'FUN_1804431c0': 'CompileVertexShader',
        'FUN_180443320': 'CompilePixelShader',
        'FUN_180443510': 'LinkShaderProgram',
        'FUN_180443630': 'SetShaderUniform',
        'FUN_180443680': 'SetShaderTexture',
        'FUN_180443700': 'SetShaderSampler',
        'FUN_180443770': 'SetShaderBuffer',
        'FUN_180443820': 'DrawIndexedPrimitive',
        'FUN_180443930': 'DrawInstancedPrimitive',
        'FUN_180443a40': 'DispatchComputeShader',
        'FUN_180443aa0': 'CopyTextureRegion',
        'FUN_180443b00': 'ResolveMultisampleTexture',
        'FUN_180443b40': 'GenerateMipmaps',
        'FUN_180443b80': 'MapBuffer',
        'FUN_180443d10': 'UnmapBuffer',
        'FUN_180443d70': 'UpdateBuffer',
        'FUN_180443df0': 'UpdateTexture',
        'FUN_180443f80': 'SetViewport',
        'FUN_180443ff0': 'SetScissorRect',
        'FUN_180444030': 'SetRenderTarget',
        'FUN_180444070': 'SetDepthStencil',
        'FUN_180444100': 'ClearRenderTarget',
        'FUN_180444200': 'ClearDepthStencil',
        'FUN_180444280': 'BeginRenderPass',
        'FUN_1804442c0': 'EndRenderPass',
        'FUN_1804442e0': 'PresentFrame',
        'FUN_180444370': 'WaitForGPU',
        'FUN_1804443c0': 'FlushCommandQueue',
        'FUN_180444410': 'ExecuteCommandList',
        'FUN_1804445b0': 'CreateFence',
        'FUN_180444600': 'SignalFence',
        'FUN_180444700': 'WaitForFence',
        'FUN_1804447c0': 'CreateQueryHeap',
        'FUN_1804448a0': 'BeginQuery',
        'FUN_1804449a0': 'EndQuery',
        'FUN_180444a20': 'ResolveQueryData',
        'FUN_180444b70': 'CreatePipelineState',
        'FUN_180444dd0': 'SetPipelineState',
        'FUN_180444e90': 'CreateRootSignature',
        'FUN_180445060': 'SetRootSignature',
        'FUN_180445110': 'SetGraphicsRootDescriptorTable',
        'FUN_180445180': 'SetGraphicsRootConstantBufferView',
        'FUN_180445390': 'SetGraphicsRootShaderResourceView',
        'FUN_180445480': 'SetGraphicsRootUnorderedAccessView',
        'FUN_180445570': 'SetGraphicsRoot32BitConstant',
        'FUN_180445680': 'SetGraphicsRoot32BitConstants',
        'FUN_1804457b0': 'IASetVertexBuffers',
        'FUN_180445870': 'IASetIndexBuffer',
        'FUN_180445970': 'IASetPrimitiveTopology',
        'FUN_180445a80': 'VSSetShader',
        'FUN_180445cd0': 'PSSetShader',
        'FUN_180445dc0': 'GSSetShader',
        'FUN_180445eb0': 'CSSetShader',
        'FUN_180445fd0': 'HSSetShader',
        'FUN_180446010': 'DSSetShader',
        'FUN_180446080': 'SOSetTargets',
        'FUN_1804460c0': 'RSSetViewports',
        'FUN_1804460f0': 'RSSetScissorRects',
        'FUN_180446120': 'RSSetState',
        'FUN_180446160': 'OMSetBlendState',
        'FUN_1804461b0': 'OMSetDepthStencilState',
        'FUN_1804462a0': 'OMSetRenderTargets',
        'FUN_1804462e0': 'ClearDepthStencilView',
        'FUN_180446320': 'ClearRenderTargetView',
        'FUN_180446370': 'DrawIndexedInstanced',
        'FUN_180446430': 'ExecuteIndirect',
        'FUN_180446480': 'CreateCommandAllocator',
        'FUN_180446610': 'CreateCommandList',
        'FUN_180446650': 'ResetCommandList',
        'FUN_180446690': 'CloseCommandList',
        'FUN_180446760': 'CreateCommandQueue',
        'FUN_180446810': 'ExecuteCommandLists',
        'FUN_180446960': 'CreateDescriptorHeap',
        'FUN_180446a60': 'CreateRenderTargetView',
        'FUN_180446b20': 'CreateDepthStencilView',
        'FUN_180446ba0': 'CreateShaderResourceView',
        'FUN_180446ca0': 'CreateUnorderedAccessView',
        'FUN_180446d20': 'CreateConstantBufferView',
        'FUN_180446dc0': 'CreateSampler',
        'FUN_180446e70': 'CopyDescriptors',
        'FUN_180446f00': 'CopyDescriptorSimple',
        'FUN_180446fa0': 'GetCPUDescriptorHandle',
        'FUN_180446fd0': 'GetGPUDescriptorHandle',
        'FUN_180447030': 'CreateResource',
        'FUN_1804470d0': 'CreateCommittedResource',
        'FUN_180447120': 'CreatePlacedResource',
        'FUN_1804471a0': 'CreateReservedResource',
        'FUN_180447220': 'GetResourceAddress',
        'FUN_1804472c0': 'MapResource',
        'FUN_180447320': 'UnmapResource',
        'FUN_180447360': 'UpdateSubresource',
        'FUN_1804473b0': 'CopyResource',
        'FUN_180447430': 'CopySubresourceRegion',
        'FUN_1804475e0': 'ResolveSubresource',
        'FUN_180447660': 'CreateTexture1D',
        'FUN_180447710': 'CreateTexture2DArray',
        'FUN_1804477f0': 'CreateTexture3D',
        'FUN_180447850': 'CreateBuffer',
        'FUN_180447990': 'CreateHeap',
        'FUN_180447b80': 'CreateQuery',
        'FUN_180447c00': 'CreatePredicate',
        'FUN_180447ca0': 'CreateCounter',
        'FUN_180447d40': 'SetMarker',
        'FUN_180447de0': 'BeginEvent',
        'FUN_180447e10': 'EndEvent',
        'FUN_180447e40': 'SetStablePowerState',
        'FUN_180447f70': 'CreateShaderResourceView1',
        'FUN_180448110': 'CreateRenderTargetView1',
        'FUN_180448420': 'CreateUnorderedAccessView1',
        'FUN_180448470': 'CreateDepthStencilView1',
        'FUN_1804484c0': 'CreateConstantBufferView1',
        'FUN_180448540': 'CreateSampler1',
        'FUN_1804485c0': 'CreateVertexShader1',
        'FUN_1804489a0': 'CreatePixelShader1',
        'FUN_180448d90': 'CreateGeometryShader1',
        'FUN_180448df0': 'CreateHullShader1',
        'FUN_180448e50': 'CreateDomainShader1',
        'FUN_180448ea0': 'CreateComputeShader1',
        'FUN_180448f00': 'SetVertexShader1',
        'FUN_180448f50': 'SetPixelShader1',
        'FUN_180448fb0': 'SetGeometryShader1',
        'FUN_180449000': 'SetHullShader1',
        'FUN_180449070': 'SetDomainShader1',
        'FUN_1804491c0': 'SetComputeShader1',
        'FUN_180449230': 'VSGetShader1',
        'FUN_180449300': 'PSGetShader1',
        'FUN_1804496f0': 'GSGetShader1',
        'FUN_180449780': 'HSGetShader1',
        'FUN_180449850': 'DSGetShader1',
        'FUN_1804498f0': 'CSGetShader1',
        'FUN_180449930': 'VSSetConstantBuffers1',
        'FUN_180449a00': 'PSSetConstantBuffers1',
        'FUN_180449a80': 'GSSetConstantBuffers1',
        'FUN_180449c00': 'HSSetConstantBuffers1',
        'FUN_180449d70': 'DSSetConstantBuffers1',
        'FUN_18044a080': 'CSSetConstantBuffers1',
        'FUN_18044a3a0': 'VSGetConstantBuffers1',
        'FUN_18044a590': 'PSGetConstantBuffers1',
        'FUN_18044a810': 'GSGetConstantBuffers1',
        'FUN_18044aad0': 'HSGetConstantBuffers1',
        'FUN_18044ab80': 'DSGetConstantBuffers1',
        'FUN_18044ac20': 'CSGetConstantBuffers1',
        'FUN_18044ad90': 'VSSetShaderResources1',
        'FUN_18044af00': 'PSSetShaderResources1',
        'FUN_18044afb0': 'GSSetShaderResources1',
        'FUN_18044b010': 'HSSetShaderResources1',
        'FUN_18044b080': 'DSSetShaderResources1',
        'FUN_18044b110': 'CSSetShaderResources1',
        'FUN_18044b1d0': 'VSGetShaderResources1',
        'FUN_18044b280': 'PSGetShaderResources1',
        'FUN_18044b3d0': 'GSGetShaderResources1',
        'FUN_18044b4f0': 'HSGetShaderResources1',
        'FUN_18044b580': 'DSGetShaderResources1',
        'FUN_18044b610': 'CSGetShaderResources1',
        'FUN_18044b6e0': 'VSSetSamplers1',
        'FUN_18044b700': 'PSSetSamplers1',
        'FUN_18044b7a0': 'GSSetSamplers1',
        'FUN_18044b910': 'HSSetSamplers1',
        'FUN_18044baf0': 'DSSetSamplers1',
        'FUN_18044bc50': 'CSSetSamplers1',
        'FUN_18044be30': 'VSGetSamplers1',
        'FUN_18044c0d0': 'PSGetSamplers1',
        'FUN_18044c190': 'GSGetSamplers1',
        'FUN_18044c420': 'HSGetSamplers1',
        'FUN_18044c840': 'DSGetSamplers1',
        'FUN_18044c9c0': 'CSGetSamplers1',
        'FUN_18044cb80': 'CreateRasterizerState1',
        'FUN_18044cd30': 'CreateDepthStencilState1',
        'FUN_18044ce10': 'CreateBlendState1',
        'FUN_18044cf20': 'CreateInputLayout1',
        'FUN_18044d0b0': 'CreateVertexLayout1',
        'FUN_18044d0f0': 'CreateGeometryShaderWithStreamOutput',
        'FUN_18044d130': 'CreateGeometryShaderWithStreamOutput1',
        'FUN_18044d2d0': 'CreateShaderResourceViewFromMemory',
        'FUN_18044d340': 'CreateRenderTargetViewFromMemory',
        'FUN_18044d450': 'CreateUnorderedAccessViewFromMemory',
        'FUN_18044d4f0': 'CreateDepthStencilViewFromMemory',
        'FUN_18044d570': 'CreateConstantBufferViewFromMemory',
        'FUN_18044d680': 'CreateSamplerFromMemory',
        'FUN_18044d910': 'CreateTextureFromMemory',
        'FUN_18044da90': 'CreateBufferFromMemory',
        'FUN_18044db70': 'CreateHeapFromMemory',
        'FUN_18044dc10': 'CreateResourceFromMemory',
        'FUN_18044df40': 'CreateShaderFromMemory',
        'FUN_18044e000': 'CreateVertexShaderFromMemory',
        'FUN_18044e0d0': 'CreatePixelShaderFromMemory',
        'FUN_18044e180': 'CreateGeometryShaderFromMemory',
        'FUN_18044e2b0': 'CreateHullShaderFromMemory',
        'FUN_18044e3b0': 'CreateDomainShaderFromMemory',
        'FUN_18044e4f0': 'CreateComputeShaderFromMemory',
        'FUN_18044e590': 'CreateInputLayoutFromMemory',
        'FUN_18044e620': 'CreateVertexLayoutFromMemory',
        'FUN_18044e650': 'CreateRasterizerStateFromMemory',
        'FUN_18044e890': 'CreateDepthStencilStateFromMemory',
        'FUN_18044ead0': 'CreateBlendStateFromMemory',
        'FUN_18044ed20': 'CreatePipelineStateFromMemory',
        'FUN_18044edc0': 'CreateRootSignatureFromMemory',
        'FUN_18044efd0': 'CreateDescriptorHeapFromMemory',
        'FUN_18044f210': 'CreateCommandAllocatorFromMemory',
        'FUN_18044f370': 'CreateCommandListFromMemory',
        'FUN_18044f780': 'CreateCommandQueueFromMemory',
        'FUN_18044f880': 'CreateFenceFromMemory',
        'FUN_18044fa00': 'CreateQueryHeapFromMemory',
        'FUN_18044ffa0': 'CreateResourceFromDesc',
        'FUN_180450070': 'CreateTextureFromDesc',
        'FUN_180450140': 'CreateBufferFromDesc',
        'FUN_1804501c0': 'CreateHeapFromDesc',
        'FUN_1804502d0': 'CreateShaderFromDesc',
        'FUN_180450360': 'CreateVertexShaderFromDesc',
        'FUN_1804508a0': 'CreatePixelShaderFromDesc',
        'FUN_1804509e0': 'CreateGeometryShaderFromDesc',
        'FUN_180450a20': 'CreateHullShaderFromDesc',
        'FUN_180450ba0': 'CreateDomainShaderFromDesc',
        'FUN_180450d90': 'CreateComputeShaderFromDesc',
        'FUN_1804510a0': 'CreateInputLayoutFromDesc',
        'FUN_1804511e0': 'CreateVertexLayoutFromDesc',
        'FUN_1804512f0': 'CreateRasterizerStateFromDesc',
        'FUN_180451770': 'CreateDepthStencilStateFromDesc',
        'FUN_1804517c0': 'CreateBlendStateFromDesc',
        'FUN_180451890': 'CreatePipelineStateFromDesc',
        'FUN_1804519d0': 'CreateRootSignatureFromDesc',
        'FUN_180451bd0': 'CreateDescriptorHeapFromDesc',
        'FUN_180451ca0': 'CreateCommandAllocatorFromDesc',
        'FUN_180451d20': 'CreateCommandListFromDesc',
        'FUN_180451da0': 'CreateCommandQueueFromDesc',
        'FUN_180451e30': 'CreateFenceFromDesc',
        'FUN_1804520a0': 'CreateQueryHeapFromDesc',
        'FUN_1804522d0': 'CreateResourceFromFile',
        'FUN_180452500': 'CreateTextureFromFile',
        'FUN_180452630': 'CreateBufferFromFile',
        'FUN_180452f40': 'CreateHeapFromFile',
        'FUN_180452fa0': 'CreateShaderFromFile',
        'FUN_1804530a0': 'CreateVertexShaderFromFile',
        'FUN_180453140': 'CreatePixelShaderFromFile',
        'FUN_1804531d0': 'CreateGeometryShaderFromFile',
        'FUN_180453300': 'CreateHullShaderFromFile',
        'FUN_1804534d0': 'CreateDomainShaderFromFile',
        'FUN_180453580': 'CreateComputeShaderFromFile',
        'FUN_180453750': 'CreateInputLayoutFromFile',
        'FUN_1804537b0': 'CreateVertexLayoutFromFile',
        'FUN_1804537e0': 'CreateRasterizerStateFromFile',
        'FUN_180453810': 'CreateDepthStencilStateFromFile',
        'FUN_180453860': 'CreateBlendStateFromFile',
        'FUN_1804538b0': 'CreatePipelineStateFromFile',
        'FUN_1804539b0': 'CreateRootSignatureFromFile',
        'FUN_180453b60': 'CreateDescriptorHeapFromFile',
        'FUN_180453cb0': 'CreateCommandAllocatorFromFile',
        'FUN_180453d60': 'CreateCommandListFromFile',
        'FUN_180453de0': 'CreateCommandQueueFromFile',
        'FUN_180453e40': 'CreateFenceFromFile',
        'FUN_180453f70': 'CreateQueryHeapFromFile',
        'FUN_180453f90': 'InitializeRenderDeviceFromFile',
        'FUN_180454070': 'InitializeRenderDeviceFromMemory',
        'FUN_1804541a0': 'InitializeRenderDeviceFromDesc',
        'FUN_180454230': 'InitializeRenderDeviceFromFile',
        'FUN_180454300': 'InitializeRenderDeviceFromMemory',
        'FUN_1804543f0': 'InitializeRenderDeviceFromDesc',
        'FUN_180454d00': 'InitializeRenderContextFromFile',
        'FUN_180454d80': 'InitializeRenderContextFromMemory',
        'FUN_180454ea0': 'InitializeRenderContextFromDesc',
        'FUN_180454ff0': 'InitializeRenderContextFromFile',
        'FUN_180455090': 'InitializeRenderContextFromMemory',
        'FUN_180455250': 'InitializeRenderContextFromDesc',
        'FUN_180455340': 'InitializeRenderPipelineFromFile',
        'FUN_180455430': 'InitializeRenderPipelineFromMemory',
        'FUN_1804555a0': 'InitializeRenderPipelineFromDesc',
        'FUN_1804557b0': 'InitializeRenderPipelineFromFile',
        'FUN_180455980': 'InitializeRenderPipelineFromMemory',
        'FUN_1804559d0': 'InitializeRenderPipelineFromDesc',
    }
    
    # 变量重命名映射表
    variable_mappings = {
        'bVar1': 'byteValue1',
        'bVar2': 'byteValue2',
        'uVar3': 'uintValue3',
        'uVar4': 'uintValue4',
        'uVar5': 'uintValue5',
        'iVar7': 'intValue7',
        'pbVar6': 'pointerByte6',
        'bVar8': 'boolValue8',
        'unaff_RBX': 'registerRBX',
        'unaff_ESI': 'registerESI',
        'unaff_R12': 'registerR12',
        'unaff_R13': 'registerR13',
        'local_': 'localVar',
        'param_': 'paramVar',
    }
    
    # 应用函数重命名
    for old_name, new_name in function_mappings.items():
        content = re.sub(r'\b' + old_name + r'\b', new_name, content)
    
    # 应用变量重命名
    for old_name, new_name in variable_mappings.items():
        content = re.sub(r'\b' + old_name + r'\b', new_name, content)
    
    return content

def main():
    """主函数"""
    filepath = '/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c'
    
    print("开始美化渲染系统代码...")
    
    # 读取文件
    content = read_file(filepath)
    
    # 美化代码
    beautified_content = beautify_rendering_functions(content)
    
    # 写入文件
    write_file(filepath, beautified_content)
    
    print("渲染系统代码美化完成！")

if __name__ == '__main__':
    main()