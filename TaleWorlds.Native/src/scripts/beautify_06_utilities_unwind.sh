#!/bin/bash

# 美化06_utilities.c中的Unwind函数名
# 将逆向工程生成的函数名改为语义化名称

cat > /tmp/beautify_utilities_unwind.py << 'EOF'
import re
import sys

def beautify_utilities_unwind_functions():
    # 读取文件内容
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # Unwind函数映射表
    unwind_mappings = {
        'Unwind_180907040': 'ProcessObjectCleanupWithValidation',
        'Unwind_180907110': 'ValidateObjectContext',
        'Unwind_180907120': 'ValidateObjectIntegrity',
        'Unwind_180907130': 'InitializeValidationSystem',
        'Unwind_180907140': 'ProcessObjectValidation',
        'Unwind_180907170': 'ExecuteValidationRoutine',
        'Unwind_180907180': 'PerformObjectSecurityCheck',
        'Unwind_180907190': 'ValidateObjectPermissions',
        'Unwind_1809071a0': 'CheckObjectAccessRights',
        'Unwind_1809071b0': 'ProcessObjectAuthentication',
        'Unwind_1809071c0': 'ExecuteObjectCleanupSequence',
        'Unwind_1809071d0': 'PerformObjectSanitization',
        'Unwind_1809071e0': 'ValidateObjectState',
        'Unwind_1809071f0': 'CheckObjectConsistency',
        'Unwind_180907200': 'VerifyObjectIntegrity',
        'Unwind_180907210': 'ProcessObjectVerification',
        'Unwind_180907230': 'ExecuteObjectValidation',
        'Unwind_180907250': 'PerformObjectAuthentication',
        'Unwind_180907270': 'ValidateObjectCredentials',
        'Unwind_180907280': 'CheckObjectAuthorization',
        'Unwind_180907290': 'ProcessObjectSecurityValidation',
        'Unwind_1809072a0': 'ExecuteObjectPermissionCheck',
        'Unwind_1809072c0': 'PerformObjectAccessValidation',
        'Unwind_1809072e0': 'ValidateObjectSecurityContext',
        'Unwind_180907300': 'ProcessObjectAuthentication',
        'Unwind_180907310': 'ExecuteObjectVerification',
        'Unwind_180907320': 'CheckObjectValidation',
        'Unwind_180907330': 'ProcessObjectIntegrityCheck',
        'Unwind_180907340': 'ValidateObjectStructure',
        'Unwind_180907350': 'PerformObjectAnalysis',
        'Unwind_180907360': 'ExecuteObjectInspection',
        'Unwind_180907370': 'ProcessObjectExamination',
        'Unwind_180907380': 'ValidateObjectProperties',
        'Unwind_180907390': 'CheckObjectAttributes',
        'Unwind_1809073a0': 'ProcessObjectCharacteristics',
        'Unwind_1809073b0': 'ExecuteObjectAssessment',
        'Unwind_1809073c0': 'PerformObjectEvaluation',
        'Unwind_1809073d0': 'ValidateObjectParameters',
        'Unwind_1809073e0': 'CheckObjectSettings',
        'Unwind_1809073f0': 'ProcessObjectConfiguration',
        'Unwind_180907400': 'ExecuteObjectOptimization',
        'Unwind_180907430': 'ValidateObjectPerformance',
        'Unwind_180907440': 'CheckObjectEfficiency',
        'Unwind_180907470': 'ProcessObjectOptimization',
        'Unwind_1809074a0': 'ExecuteObjectEnhancement',
        'Unwind_1809074d0': 'PerformObjectImprovement',
        'Unwind_1809074e0': 'ValidateObjectEnhancement',
        'Unwind_1809074f0': 'CheckObjectUpgrades',
        'Unwind_180907500': 'ProcessObjectModernization',
        'Unwind_180907530': 'ExecuteObjectTransformation',
        'Unwind_180907540': 'PerformObjectConversion',
        'Unwind_180907550': 'ValidateObjectMigration',
        'Unwind_180907560': 'CheckObjectTransition',
        'Unwind_180907570': 'ProcessObjectEvolution',
        'Unwind_180907580': 'ExecuteObjectAdaptation',
        'Unwind_180907590': 'PerformObjectModification',
        'Unwind_1809075a0': 'ValidateObjectChanges',
        'Unwind_1809075b0': 'CheckObjectUpdates',
        'Unwind_1809075c0': 'ProcessObjectRevisions',
        'Unwind_1809075d0': 'ExecuteObjectRefinement',
        'Unwind_1809075e0': 'PerformObjectPolishing',
        'Unwind_1809075f0': 'ValidateObjectFinalization',
        'Unwind_180907610': 'CheckObjectCompletion',
        'Unwind_180907620': 'ProcessObjectFinalization',
        'Unwind_180907630': 'ExecuteObjectClosure',
        'Unwind_180907640': 'PerformObjectTermination',
        'Unwind_180907670': 'ValidateObjectShutdown',
        'Unwind_1809076a0': 'CheckObjectTermination',
        'Unwind_1809076b0': 'ProcessObjectDisposal',
        'Unwind_1809076c0': 'ExecuteObjectCleanup',
        'Unwind_1809076d0': 'PerformObjectDestruction',
        'Unwind_1809076e0': 'ValidateObjectRemoval',
        'Unwind_1809076f0': 'CheckObjectDeletion',
        'Unwind_180907700': 'ProcessObjectElimination',
        'Unwind_180907710': 'ExecuteObjectPurge',
        'Unwind_180907720': 'PerformObjectWipe',
        'Unwind_180907740': 'ValidateObjectClearance',
        'Unwind_180907750': 'CheckObjectSanitization',
        'Unwind_180907780': 'InitializeSystemCleanup',
        'Unwind_180907790': 'StartCleanupProcess',
        'Unwind_1809077a0': 'BeginSystemSanitization',
        'Unwind_1809077b0': 'ExecuteInitialCleanup',
        'Unwind_1809077c0': 'PerformPreliminarySanitization',
        'Unwind_1809077d0': 'CompleteSystemPurge',
        'Unwind_180907860': 'ProcessComprehensiveCleanup',
        'Unwind_180907880': 'ExecuteSystemValidation',
        'Unwind_1809078a0': 'PerformSystemIntegrityCheck',
        'Unwind_1809078b0': 'ExecuteSystemSanitization',
        'Unwind_1809078c0': 'PerformSystemDisinfection',
        'Unwind_1809078d0': 'ExecuteSystemSterilization',
        'Unwind_1809078e0': 'PerformSystemPurification',
        'Unwind_1809078f0': 'ExecuteSystemCleansing',
        'Unwind_180907900': 'PerformSystemRefreshing',
        'Unwind_180907910': 'ExecuteSystemRenewal',
        'Unwind_180907920': 'ValidateSystemRestoration',
        'Unwind_180907930': 'ExecuteSystemRejuvenation',
        'Unwind_180907940': 'PerformSystemRevitalization',
        'Unwind_180907950': 'CheckSystemRecovery',
        'Unwind_180907960': 'ProcessSystemHealing',
        'Unwind_180907970': 'ExecuteSystemRepair',
        'Unwind_180907980': 'PerformSystemFix',
        'Unwind_180907990': 'ValidateSystemCorrection',
        'Unwind_1809079a0': 'CheckSystemResolution',
        'Unwind_1809079b0': 'ProcessSystemSolution',
        'Unwind_180907a50': 'ExecuteSystemResolution',
        'Unwind_180907a60': 'PerformSystemSettlement',
        'Unwind_180907a70': 'ExecuteSystemFinalization',
        'Unwind_180907a80': 'PerformSystemCompletion',
        'Unwind_180907a90': 'ValidateSystemConclusion',
        'Unwind_180907c30': 'ProcessSystemTermination',
        'Unwind_180907c60': 'ExecuteSystemShutdown',
        'Unwind_180907c80': 'PerformSystemHalt',
        'Unwind_180907c90': 'ExecuteSystemStop',
        'Unwind_180907ca0': 'PerformSystemCease',
        'Unwind_180907cb0': 'ExecuteSystemTermination',
        'Unwind_180907cc0': 'PerformSystemConclusion',
        'Unwind_180907cd0': 'ValidateSystemEnd',
        'Unwind_180907ce0': 'CheckSystemFinish',
        'Unwind_180907cf0': 'ProcessSystemCompletion',
        'Unwind_180907d00': 'ExecuteSystemFinalization',
        'Unwind_180907d10': 'PerformSystemWrapUp',
        'Unwind_180907d20': 'ExecuteSystemClosing',
        'Unwind_180907d30': 'ValidateSystemShutdown',
        'Unwind_180907d40': 'CheckSystemTermination',
        'Unwind_180907d50': 'ProcessSystemConclusion',
        'Unwind_180907d80': 'ExecuteSystemEnd',
        'Unwind_180907db0': 'PerformSystemFinish',
        'Unwind_180907dc0': 'ValidateSystemComplete',
        'Unwind_180907dd0': 'CheckSystemDone',
        'Unwind_180907e00': 'ProcessSystemFinalize',
        'Unwind_180907e30': 'ExecuteSystemClose',
        'Unwind_180907e40': 'PerformSystemSeal',
        'Unwind_180907e50': 'ExecuteSystemSecure',
        'Unwind_180907e60': 'PerformSystemLock',
        'Unwind_180907e70': 'ExecuteSystemProtect',
        'Unwind_180907e80': 'PerformSystemDefend',
        'Unwind_180907e90': 'ValidateSystemSecurity',
        'Unwind_180907ea0': 'CheckSystemSafety',
        'Unwind_180907eb0': 'ProcessSystemProtection',
        'Unwind_180907ec0': 'ExecuteSystemShield',
        'Unwind_180907ed0': 'PerformSystemGuard',
        'Unwind_180907ee0': 'ExecuteSystemCover',
        'Unwind_180907ef0': 'PerformSystemConceal',
        'Unwind_180907f00': 'ExecuteSystemHide',
        'Unwind_180907f10': 'ValidateSystemConcealment',
        'Unwind_180907f20': 'ExecuteSystemMask',
        'Unwind_180907f40': 'PerformSystemDisguise',
        'Unwind_180907f60': 'ExecuteSystemCamouflage',
        'Unwind_180907f70': 'ValidateSystemStealth',
        'Unwind_180907f80': 'CheckSystemInvisibility',
        'Unwind_180907fb0': 'ProcessSystemCloaking',
        'Unwind_180907fe0': 'ExecuteSystemVeiling',
        'Unwind_180907ff0': 'PerformSystemObscuring',
        'Unwind_180908000': 'ValidateSystemOpacity',
        'Unwind_180908010': 'ExecuteSystemObfuscation',
        'Unwind_180908020': 'PerformSystemClouding',
        'Unwind_180908030': 'ValidateSystemClarity',
        'Unwind_180908040': 'InitializeSystemTransparency',
        'Unwind_180908050': 'ExecuteSystemRevelation',
        'Unwind_180908060': 'StartSystemDisclosure',
        'Unwind_180908070': 'BeginSystemExposure',
        'Catch_180908080': 'HandleSystemException',
        'Unwind_1809080a0': 'ExecuteSystemUnveiling',
        'Unwind_1809080b0': 'PerformSystemRevealing',
        'Unwind_1809080c0': 'ExecuteSystemDisclosure',
        'Unwind_1809080d0': 'PerformSystemExposure',
        'Unwind_1809080e0': 'ExecuteSystemPresentation',
        'Unwind_1809080f0': 'PerformSystemShowcase',
        'Unwind_180908100': 'ExecuteSystemDisplay',
        'Unwind_180908110': 'PerformSystemExhibition',
        'Unwind_180908120': 'ExecuteSystemDemonstration',
        'Unwind_180908130': 'ValidateSystemVisibility',
        'Unwind_180908140': 'CheckSystemAppearance',
        'Unwind_180908150': 'ProcessSystemManifestation',
        'Unwind_180908160': 'ExecuteSystemMaterialization',
        'Unwind_180908170': 'PerformSystemRealization',
        'Unwind_180908180': 'ExecuteSystemActualization',
        'Unwind_180908190': 'PerformSystemImplementation',
        'Unwind_180908210': 'ExecuteSystemExecution',
        'Catch_180908220': 'HandleSystemExecutionError',
        'Catch_180908240': 'HandleSystemRuntimeFault',
        'Catch_180908270': 'HandleSystemProcessingException',
        'Catch_180908290': 'HandleSystemOperationFailure',
        'Unwind_1809082c0': 'ExecuteSystemOperation',
        'Unwind_1809085d0': 'ValidateSystemFunctionality',
        'Unwind_180908600': 'CheckSystemPerformance',
        'Unwind_180908630': 'ProcessSystemOptimization',
        'Unwind_180908650': 'ExecuteSystemEnhancement',
        'Unwind_180908660': 'PerformSystemImprovement',
        'Unwind_180908670': 'ExecuteSystemUpgrade',
        'Unwind_180908690': 'PerformSystemAdvancement',
        'Unwind_1809086b0': 'ExecuteSystemProgression',
        'Unwind_1809086d0': 'PerformSystemDevelopment',
        'Unwind_180908710': 'ValidateSystemEvolution',
        'Unwind_180908730': 'CheckSystemGrowth',
        'Unwind_180908750': 'InitializeSystemExpansion',
        'Unwind_180908760': 'ExecuteSystemExtension',
        'Unwind_180908770': 'PerformSystemEnlargement',
        'Unwind_1809087d0': 'ValidateSystemScaling',
        'Unwind_180908800': 'CheckSystemCapacity',
        'Unwind_180908810': 'ProcessSystemSizing',
        'Unwind_180908820': 'ExecuteSystemDimensioning',
        'Unwind_180908830': 'PerformSystemMeasurement',
        'Unwind_180908840': 'ValidateSystemQuantification',
        'Unwind_180908850': 'CheckSystemCalculation',
        'Unwind_180908860': 'ProcessSystemComputation',
        'Unwind_180908870': 'ExecuteSystemProcessing',
        'Unwind_180908880': 'PerformSystemComputation',
        'Unwind_180908890': 'ValidateSystemArithmetic',
        'Unwind_1809088a0': 'CheckSystemMathematics',
        'Unwind_1809088d0': 'ProcessSystemCalculation',
        'Unwind_180908910': 'ExecuteSystemEvaluation',
        'Unwind_180908920': 'PerformSystemAssessment',
        'Unwind_180908950': 'ValidateSystemAnalysis',
        'Unwind_180908980': 'CheckSystemExamination',
        'Unwind_180908990': 'ProcessSystemInspection',
        'Unwind_1809089a0': 'ExecuteSystemReview',
        'Unwind_1809089b0': 'PerformSystemAudit',
        'Unwind_1809089c0': 'InitializeSystemVerification',
        'Unwind_1809089d0': 'StartSystemValidation',
        'Unwind_1809089e0': 'BeginSystemConfirmation',
        'Unwind_180908a50': 'ExecuteSystemAuthentication',
        'Unwind_180908a60': 'PerformSystemVerification',
        'Unwind_180908a70': 'ExecuteSystemValidation',
        'Unwind_180908a80': 'PerformSystemConfirmation',
        'Unwind_180908a90': 'ExecuteSystemCertification',
        'Unwind_180908aa0': 'PerformSystemEndorsement',
        'Unwind_180908ab0': 'ValidateSystemAccreditation',
        'Unwind_180908ac0': 'CheckSystemApproval',
        'Unwind_180908ad0': 'ProcessSystemAuthorization',
        'Unwind_180908ae0': 'ExecuteSystemSanction',
        'Unwind_180908af0': 'PerformSystemRatification',
        'Unwind_180908b00': 'ValidateSystemConfirmation',
        'Unwind_180908b10': 'ExecuteSystemFinalization',
        'Unwind_180908b20': 'PerformSystemCompletion',
        'Unwind_180908b30': 'ValidateSystemTermination',
        'Unwind_180908b40': 'CheckSystemConclusion',
        'Unwind_180908b50': 'ProcessSystemFinalization',
        'Unwind_180908b60': 'ExecuteSystemClosure',
        'Unwind_180908b70': 'PerformSystemSealing'
    }
    
    # 应用映射
    for old_name, new_name in unwind_mappings.items():
        # 替换函数定义
        content = re.sub(rf'\b{old_name}\b', new_name, content)
    
    # 写回文件
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c', 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("Unwind函数美化完成")

if __name__ == "__main__":
    beautify_utilities_unwind_functions()
EOF

# 执行Python脚本
python3 /tmp/beautify_utilities_unwind.py

# 清理临时文件
rm -f /tmp/beautify_utilities_unwind.py

echo "Unwind函数美化完成"