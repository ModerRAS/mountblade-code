#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import re

def process_file(file_path):
    """
    处理文件，为Unwind函数添加有意义的名称和注释
    """
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # Unwind函数重命名映射
    unwind_replacements = [
        ("Unwind_1809027d0", "UnwindSystemContext001"),
        ("Unwind_180902870", "UnwindResourceHandler001"),
        ("Unwind_180902880", "UnwindMemoryManager001"),
        ("Unwind_1809028a0", "UnwindProcessController001"),
        ("Unwind_1809028e0", "UnwindExceptionHandler001"),
        ("Unwind_1809028f0", "UnwindStackFrame001"),
        ("Unwind_180902900", "UnwindThreadContext001"),
        ("Unwind_180902930", "UnwindModuleManager001"),
        ("Unwind_180902940", "UnwindEventProcessor001"),
        ("Unwind_180902950", "UnwindStateController001"),
        ("Unwind_180902960", "UnwindSystemContext002"),
        ("Unwind_180902970", "UnwindResourceHandler002"),
        ("Unwind_180902980", "UnwindMemoryManager002"),
        ("Unwind_1809029c0", "UnwindProcessController002"),
        ("Unwind_180902a00", "UnwindExceptionHandler002"),
        ("Unwind_180902a40", "UnwindStackFrame002"),
        ("Unwind_180902a50", "UnwindThreadContext002"),
        ("Unwind_180902a60", "UnwindModuleManager002"),
        ("Unwind_180902a70", "UnwindEventProcessor002"),
        ("Unwind_180902a80", "UnwindStateController002"),
        ("Unwind_180902a90", "UnwindSystemContext003"),
        ("Unwind_180902ab0", "UnwindResourceHandler003"),
        ("Unwind_180902af0", "UnwindMemoryManager003"),
        ("Unwind_180902b00", "UnwindProcessController003"),
        ("Unwind_180902b30", "UnwindExceptionHandler003"),
        ("Unwind_180902b60", "UnwindStackFrame003"),
        ("Unwind_180902b70", "UnwindThreadContext003"),
        ("Unwind_180902b80", "UnwindModuleManager003"),
        ("Unwind_180902b90", "UnwindEventProcessor003"),
        ("Unwind_180902ba0", "UnwindStateController003"),
        ("Unwind_180902bb0", "UnwindSystemContext004"),
        ("Unwind_180902bc0", "UnwindResourceHandler004"),
        ("Unwind_180902bd0", "UnwindMemoryManager004"),
        ("Unwind_180902be0", "UnwindProcessController004"),
        ("Unwind_180902bf0", "UnwindExceptionHandler004"),
        ("Unwind_180902c00", "UnwindStackFrame004"),
        ("Unwind_180902c10", "UnwindThreadContext004"),
        ("Unwind_180902c20", "UnwindModuleManager004"),
        ("Unwind_180902c30", "UnwindEventProcessor004"),
        ("Unwind_180902c40", "UnwindStateController004"),
        ("Unwind_180902c50", "UnwindSystemContext005"),
        ("Unwind_180902c90", "UnwindResourceHandler005"),
        ("Unwind_180902ca0", "UnwindMemoryManager005"),
        ("Unwind_180902cb0", "UnwindProcessController005"),
        ("Unwind_180902cc0", "UnwindExceptionHandler005"),
        ("Unwind_180902cd0", "UnwindStackFrame005"),
        ("Unwind_180902ce0", "UnwindThreadContext005"),
        ("Unwind_180902cf0", "UnwindModuleManager005"),
        ("Unwind_180902d00", "UnwindEventProcessor005"),
        ("Unwind_180902d10", "UnwindStateController005"),
        ("Unwind_180902d20", "UnwindSystemContext006"),
        ("Unwind_180902d30", "UnwindResourceHandler006"),
        ("Unwind_180902d40", "UnwindMemoryManager006"),
        ("Unwind_180902d50", "UnwindProcessController006"),
        ("Unwind_180902d70", "UnwindExceptionHandler006"),
        ("Unwind_180902d90", "UnwindStackFrame006"),
        ("Unwind_180902db0", "UnwindThreadContext006"),
        ("Unwind_180902dd0", "UnwindModuleManager006"),
        ("Unwind_180902df0", "UnwindEventProcessor006"),
        ("Unwind_180902e10", "UnwindStateController006"),
        ("Unwind_180902e30", "UnwindSystemContext007"),
        ("Unwind_180902e40", "UnwindResourceHandler007"),
        ("Unwind_180902e50", "UnwindMemoryManager007"),
        ("Unwind_180902e60", "UnwindProcessController007"),
        ("Unwind_180902e70", "UnwindExceptionHandler007"),
        ("Unwind_180902e80", "UnwindStackFrame007"),
        ("Unwind_180902e90", "UnwindThreadContext007"),
        ("Unwind_180902eb0", "UnwindModuleManager007"),
        ("Unwind_180902ec0", "UnwindEventProcessor007"),
        ("Unwind_180902ed0", "UnwindStateController007"),
        ("Unwind_180902ee0", "UnwindSystemContext008"),
        ("Unwind_180902f00", "UnwindResourceHandler008"),
        ("Unwind_180902f20", "UnwindMemoryManager008"),
        ("Unwind_180902f40", "UnwindProcessController008"),
        ("Unwind_180902f60", "UnwindExceptionHandler008"),
        ("Unwind_180902f80", "UnwindStackFrame008"),
        ("Unwind_180902fa0", "UnwindThreadContext008"),
        ("Unwind_180902fc0", "UnwindModuleManager008"),
        ("Unwind_180902fe0", "UnwindEventProcessor008"),
        ("Unwind_180903000", "UnwindStateController008"),
        ("Unwind_180903010", "UnwindSystemContext009"),
        ("Unwind_180903020", "UnwindResourceHandler009"),
        ("Unwind_180903030", "UnwindMemoryManager009"),
        ("Unwind_180903040", "UnwindProcessController009"),
        ("Unwind_180903050", "UnwindExceptionHandler009"),
        ("Unwind_180903060", "UnwindStackFrame009"),
        ("Unwind_180903070", "UnwindThreadContext009"),
        ("Unwind_180903080", "UnwindModuleManager009"),
        ("Unwind_180903090", "UnwindEventProcessor009"),
        ("Unwind_1809030a0", "UnwindStateController009"),
        ("Unwind_1809030b0", "UnwindSystemContext010"),
        ("Unwind_1809030c0", "UnwindResourceHandler010"),
        ("Unwind_1809030d0", "UnwindMemoryManager010"),
        ("Unwind_1809030f0", "UnwindProcessController010"),
        ("Unwind_180903100", "UnwindExceptionHandler010"),
        ("Unwind_180903110", "UnwindStackFrame010"),
        ("Unwind_180903120", "UnwindThreadContext010"),
        ("Unwind_180903130", "UnwindModuleManager010"),
        ("Unwind_180903140", "UnwindEventProcessor010"),
        ("Unwind_180903150", "UnwindStateController010"),
        ("Unwind_180903160", "UnwindSystemContext011"),
        ("Unwind_180903170", "UnwindResourceHandler011"),
        ("Unwind_180903180", "UnwindMemoryManager011"),
        ("Unwind_180903190", "UnwindProcessController011"),
        ("Unwind_1809031a0", "UnwindExceptionHandler011"),
        ("Unwind_1809031b0", "UnwindStackFrame011"),
        ("Unwind_1809031c0", "UnwindThreadContext011"),
        ("Unwind_1809031e0", "UnwindModuleManager011"),
        ("Unwind_1809031f0", "UnwindEventProcessor011"),
        ("Unwind_180903200", "UnwindStateController011"),
        ("Unwind_180903210", "UnwindSystemContext012"),
        ("Unwind_180903220", "UnwindResourceHandler012"),
        ("Unwind_180903230", "UnwindMemoryManager012"),
        ("Unwind_180903240", "UnwindProcessController012"),
        ("Unwind_180903250", "UnwindExceptionHandler012"),
        ("Unwind_180903270", "UnwindStackFrame012"),
        ("Unwind_180903290", "UnwindThreadContext012"),
        ("Unwind_1809032b0", "UnwindModuleManager012"),
        ("Unwind_1809032d0", "UnwindEventProcessor012"),
        ("Unwind_1809032e0", "UnwindStateController012"),
        ("Unwind_1809032f0", "UnwindSystemContext013"),
        ("Unwind_180903300", "UnwindResourceHandler013"),
        ("Unwind_180903310", "UnwindMemoryManager013"),
        ("Unwind_180903320", "UnwindProcessController013"),
        ("Unwind_180903330", "UnwindExceptionHandler013"),
        ("Unwind_180903340", "UnwindStackFrame013"),
        ("Unwind_180903350", "UnwindThreadContext013"),
        ("Unwind_180903360", "UnwindModuleManager013"),
        ("Unwind_180903370", "UnwindEventProcessor013"),
        ("Unwind_1809033b0", "UnwindStateController013"),
        ("Unwind_1809033f0", "UnwindSystemContext014"),
        ("Unwind_180903430", "UnwindResourceHandler014"),
        ("Unwind_180903440", "UnwindMemoryManager014"),
        ("Unwind_180903450", "UnwindProcessController014"),
        ("Unwind_180903460", "UnwindExceptionHandler014"),
        ("Unwind_180903470", "UnwindStackFrame014"),
        ("Unwind_180903490", "UnwindThreadContext014"),
        ("Unwind_1809034b0", "UnwindModuleManager014"),
        ("Unwind_1809034c0", "UnwindEventProcessor014"),
        ("Unwind_1809034d0", "UnwindStateController014"),
        ("Unwind_1809034e0", "UnwindSystemContext015"),
        ("Unwind_1809034f0", "UnwindResourceHandler015"),
        ("Unwind_180903500", "UnwindMemoryManager015"),
        ("Unwind_180903510", "UnwindProcessController015"),
        ("Unwind_180903520", "UnwindExceptionHandler015"),
        ("Unwind_180903540", "UnwindStackFrame015"),
        ("Unwind_180903560", "UnwindThreadContext015"),
        ("Unwind_180903580", "UnwindModuleManager015"),
        ("Unwind_180903590", "UnwindEventProcessor015"),
        ("Unwind_1809035b0", "UnwindStateController015"),
        ("Unwind_1809035d0", "UnwindSystemContext016"),
        ("Unwind_1809035e0", "UnwindResourceHandler016"),
        ("Unwind_1809035f0", "UnwindMemoryManager016"),
        ("Unwind_180903600", "UnwindProcessController016"),
        ("Unwind_180903610", "UnwindExceptionHandler016"),
        ("Unwind_180903620", "UnwindStackFrame016"),
        ("Unwind_180903640", "UnwindThreadContext016"),
        ("Unwind_180903660", "UnwindModuleManager016"),
        ("Unwind_180903680", "UnwindEventProcessor016"),
        ("Unwind_1809036a0", "UnwindStateController016"),
        ("Unwind_1809036c0", "UnwindSystemContext017"),
        ("Unwind_1809036e0", "UnwindResourceHandler017"),
        ("Unwind_180903700", "UnwindMemoryManager017"),
        ("Unwind_180903720", "UnwindProcessController017"),
        ("Unwind_180903740", "UnwindExceptionHandler017"),
        ("Unwind_180903760", "UnwindStackFrame017"),
        ("Unwind_180903770", "UnwindThreadContext017"),
        ("Unwind_180903790", "UnwindModuleManager017"),
        ("Unwind_1809037b0", "UnwindEventProcessor017"),
        ("Unwind_1809037d0", "UnwindStateController017"),
        ("Unwind_1809037f0", "UnwindSystemContext018"),
        ("Unwind_180903810", "UnwindResourceHandler018"),
        ("Unwind_180903830", "UnwindMemoryManager018"),
        ("Unwind_180903850", "UnwindProcessController018"),
        ("Unwind_180903870", "UnwindExceptionHandler018"),
        ("Unwind_180903890", "UnwindStackFrame018"),
        ("Unwind_1809038b0", "UnwindThreadContext018"),
        ("Unwind_1809038c0", "UnwindModuleManager018"),
        ("Unwind_1809038d0", "UnwindEventProcessor018"),
        ("Unwind_1809038e0", "UnwindStateController018"),
        ("Unwind_180903930", "UnwindSystemContext019"),
        ("Unwind_180903950", "UnwindResourceHandler019"),
        ("Unwind_180903970", "UnwindMemoryManager019"),
        ("Unwind_180903990", "UnwindProcessController019"),
        ("Unwind_1809039b0", "UnwindExceptionHandler019"),
        ("Unwind_1809039d0", "UnwindStackFrame019"),
        ("Unwind_1809039f0", "UnwindThreadContext019"),
        ("Unwind_180903a10", "UnwindModuleManager019"),
        ("Unwind_180903a30", "UnwindEventProcessor019"),
        ("Unwind_180903a50", "UnwindStateController019"),
        ("Unwind_180903a70", "UnwindSystemContext020"),
        ("Unwind_180903a90", "UnwindResourceHandler020"),
        ("Unwind_180903ab0", "UnwindMemoryManager020"),
        ("Unwind_180903ac0", "UnwindProcessController020"),
        ("Unwind_180903ad0", "UnwindExceptionHandler020"),
        ("Unwind_180903ae0", "UnwindStackFrame020"),
        ("Unwind_180903af0", "UnwindThreadContext020"),
        ("Unwind_180903b00", "UnwindModuleManager020"),
        ("Unwind_180903b20", "UnwindEventProcessor020"),
        ("Unwind_180903b40", "UnwindStateController020"),
        ("Unwind_180903b60", "UnwindSystemContext021"),
        ("Unwind_180903b80", "UnwindResourceHandler021"),
        ("Unwind_180903ba0", "UnwindMemoryManager021"),
        ("Unwind_180903bc0", "UnwindProcessController021"),
        ("Unwind_180903be0", "UnwindExceptionHandler021"),
    ]
    
    # 替换函数定义
    for old_name, new_name in unwind_replacements:
        # 替换函数定义
        content = re.sub(rf'void {old_name}\(', f'void {new_name}(', content)
        # 替换函数调用
        content = content.replace(old_name, new_name)
    
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"已成功处理 {len(unwind_replacements)} 个Unwind函数")

if __name__ == "__main__":
    file_path = '/dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c'
    process_file(file_path)