#!/usr/bin/env python3
"""
美化LAB_标签脚本
将01_initialization.c文件中的LAB_标签替换为语义化名称
"""

import re

def beautify_lab_labels():
    """美化LAB_标签为语义化名称"""
    
    # 读取文件
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/01_initialization.c', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # LAB_标签映射到语义化名称
    label_mappings = {
        'LAB_180047f2c': 'LABEL_STRING_MATCH_PROCESSING',
        'LAB_180047f93': 'LABEL_NODE_CONFIGURATION_COMPLETE',
        'LAB_180048db7': 'LABEL_TARGET_NODE_VALIDATION_START',
        'LAB_180048dba': 'LABEL_TARGET_NODE_VALIDATION_CONTINUE',
        'LAB_180048dd7': 'LABEL_TARGET_NODE_VALIDATION_END',
        'LAB_180048e00': 'LABEL_BOOLEAN_CHECK_START',
        'LAB_180048e20': 'LABEL_BOOLEAN_CHECK_END',
        'LAB_180048e74': 'LABEL_COMPARISON_CHECK_COMPLETE',
        'LAB_180048f62': 'LABEL_CONFIGURATION_FLAG_CHECK',
        'LAB_18004a2b9': 'LABEL_RESOURCE_OFFSET_VALIDATION',
        'LAB_18004a322': 'LABEL_RESOURCE_ALLOCATION_CONTINUE',
        'LAB_18004c7ef': 'LABEL_BUFFER_ADDRESS_VALIDATION',
        'LAB_18004e721': 'LABEL_SYSTEM_FLAG_PROCESSING',
        'LAB_180051f8b': 'LABEL_UNSIGNED_VALUE_PROCESSING_START',
        'LAB_180051fc9': 'LABEL_UNSIGNED_VALUE_PROCESSING_END',
        'LAB_180052ce3': 'LABEL_BITMASK_CHECK_FIRST',
        'LAB_180052de5': 'LABEL_BITMASK_CHECK_SECOND',
        'LAB_1800535b0': 'LABEL_INFINITE_LOOP_START',
        'LAB_18005364c': 'LABEL_DATA_LENGTH_VALIDATION',
        'LAB_180054302': 'LABEL_RESOURCE_COUNT_VALIDATION',
        'LAB_18005419d': 'LABEL_STRING_INDEX_VALIDATION',
        'LAB_18005485e': 'LABEL_STACK_POINTER_VALIDATION',
        'LAB_180054912': 'LABEL_SYSTEM_ID_VALIDATION',
        'LAB_180054d28': 'LABEL_PATH_SEPARATOR_CHECK',
        'LAB_180054d57': 'LABEL_PATH_SEPARATOR_FOUND',
        'LAB_180054ec9': 'LABEL_MEMORY_POINTER_VALIDATION',
        'LAB_180056220': 'LABEL_SYSTEM_COUNTER_CHECK',
        'LAB_180056228': 'LABEL_SYSTEM_FLAG_CHECK',
        'LAB_18005726e': 'LABEL_SYSTEM_OPERATION_CONTINUE',
        'LAB_180057b97': 'LABEL_COMPARISON_OPERATION_START',
        'LAB_180057ba2': 'LABEL_COMPARISON_OPERATION_END',
        'LAB_1800580f9': 'LABEL_UNSIGNED_VALUE_PROCESSING',
        'LAB_180058138': 'LABEL_UNSIGNED_VALUE_CHECK',
        'LAB_18005856a': 'LABEL_SYSTEM_POINTER_VALIDATION',
        'LAB_1800590e2': 'LABEL_BOOLEAN_VALIDATION_START',
        'LAB_1800591a6': 'LABEL_BOOLEAN_VALIDATION_END',
        'LAB_180059885': 'LABEL_RESOURCE_OPERATION_COMPLETE',
        'LAB_18005c9be': 'LABEL_RESOURCE_NODE_VALIDATION',
        'LAB_18005ccff': 'LABEL_DATA_MANAGER_VALIDATION',
        'LAB_18005eb20': 'LABEL_MEMORY_ADDRESS_ASSIGNMENT',
        'LAB_18005f0e6': 'LABEL_RESOURCE_EXPANSION_LOOP',
        'LAB_18005f30a': 'LABEL_MEMORY_ALLOCATION_LOOP',
        'LAB_18005f6a2': 'LABEL_SYSTEM_HANDLE_VALIDATION',
        'LAB_18005fa1c': 'LABEL_UNSIGNED_VALUE_RANGE_CHECK',
        'LAB_18005fa01': 'LABEL_VALUE_CALCULATION_START',
        'LAB_18005f818': 'LABEL_VALUE_CALCULATION_CONTINUE',
        'LAB_18005f848': 'LABEL_VALUE_PROCESSING_START',
        'LAB_18005f84c': 'LABEL_VALUE_PROCESSING_CONTINUE',
        'LAB_18005f8c7': 'LABEL_VALUE_COMPARISON_CHECK',
        'LAB_18005f8e3': 'LABEL_VALUE_ASSIGNMENT_PATH',
        'LAB_18005f9e1': 'LABEL_VALUE_MULTIPLICATION_START',
        'LAB_18005f92b': 'LABEL_VALUE_ZERO_CHECK',
        'LAB_18005fd51': 'LABEL_SECOND_VALUE_VALIDATION_START',
        'LAB_18005fd56': 'LABEL_SECOND_VALUE_VALIDATION_CONTINUE',
        'LAB_18005fc81': 'LABEL_SECOND_VALUE_PROCESSING_START',
        'LAB_18005fcf9': 'LABEL_SECOND_VALUE_COMPARISON',
        'LAB_18005fd0d': 'LABEL_SECOND_VALUE_ASSIGNMENT',
        'LAB_18005fda6': 'LABEL_SECOND_VALUE_VALIDATION_END',
        'LAB_18005ff87': 'LABEL_THIRD_VALUE_PROCESSING_START',
        'LAB_180060026': 'LABEL_THIRD_VALUE_PROCESSING_CONTINUE',
        'LAB_180060007': 'LABEL_THIRD_VALUE_COMPARISON',
        'LAB_1800602a0': 'LABEL_SYSTEM_CONFIGURATION_LOOP',
        'LAB_18006039b': 'LABEL_SYSTEM_CONFIGURATION_END',
        'LAB_1800602f0': 'LABEL_CONFIGURATION_CONTINUE',
        'LAB_18006031a': 'LABEL_CONFIGURATION_JUMP',
        'LAB_1800604d1': 'LABEL_RESOURCE_POINTER_VALIDATION',
        'LAB_1800607cc': 'LABEL_STACK_FLAG_CHECK',
        'LAB_180060993': 'LABEL_RESOURCE_ALLOCATION_COMPLETE',
        'LAB_18006357e': 'LABEL_UNSIGNED_VALUE_CHECK_END',
        'LAB_180063de9': 'LABEL_DATA_POINTER_VALIDATION',
        'LAB_180064eed': 'LABEL_MEMORY_POINTER_VALIDATION_START',
        'LAB_180065009': 'LABEL_MEMORY_POINTER_VALIDATION_END',
        'LAB_180065a3e': 'LABEL_SYSTEM_RESULT_CHECK',
        'LAB_18006650a': 'LABEL_SYSTEM_INDEX_VALIDATION',
        'LAB_180066971': 'LABEL_SYSTEM_CONFIGURATION_COMPLETE',
        'LAB_180066bf4': 'LABEL_CONTEXT_INITIALIZATION_START',
        'LAB_180066ec4': 'LABEL_CONTEXT_INITIALIZATION_END',
        'LAB_180068c87': 'LABEL_RESOURCE_CLEANUP_START',
        'LAB_180068c92': 'LABEL_RESOURCE_CLEANUP_CONTINUE',
        'LAB_180068c94': 'LABEL_RESOURCE_CLEANUP_END',
        'LAB_180069842': 'LABEL_MEMORY_MANAGER_START',
        'LAB_180069c2b': 'LABEL_MEMORY_MANAGER_CONTINUE',
        'LAB_180069dc3': 'LABEL_MEMORY_MANAGER_END',
        'LAB_180069dda': 'LABEL_MEMORY_MANAGER_FINAL',
        'LAB_18006bf7f': 'LABEL_STRING_PROCESSING_START',
        'LAB_18006c61e': 'LABEL_STRING_PROCESSING_CONTINUE',
        'LAB_18006c642': 'LABEL_STRING_PROCESSING_END',
        'LAB_18006c852': 'LABEL_STRING_PROCESSING_FINAL',
        'LAB_18006ca44': 'LABEL_BUFFER_OPERATION_START',
        'LAB_18006c9ac': 'LABEL_BUFFER_OPERATION_CONTINUE',
        'LAB_18006ca95': 'LABEL_BUFFER_OPERATION_END',
        'LAB_18006ccef': 'LABEL_BUFFER_VALIDATION_START',
        'LAB_18006cfb1': 'LABEL_BUFFER_VALIDATION_END',
        'LAB_18006d3bb': 'LABEL_DATA_TRANSFER_START',
        'LAB_18006d67d': 'LABEL_DATA_TRANSFER_CONTINUE',
        'LAB_18006d7fb': 'LABEL_DATA_TRANSFER_END',
        'LAB_18006d957': 'LABEL_THREAD_OPERATION_START',
        'LAB_18006d9f6': 'LABEL_THREAD_OPERATION_CONTINUE',
        'LAB_18006d9d7': 'LABEL_THREAD_OPERATION_END',
        'LAB_18006f48d': 'LABEL_SECURITY_CHECK_START',
        'LAB_180070230': 'LABEL_SECURITY_CHECK_CONTINUE',
        'LAB_180070a3f': 'LABEL_SECURITY_CHECK_END',
        'LAB_180070b00': 'LABEL_VALIDATION_COMPLETE',
        'LAB_180070db8': 'LABEL_INITIALIZATION_START',
        'LAB_180070e64': 'LABEL_INITIALIZATION_CONTINUE',
        'LAB_180070ee8': 'LABEL_INITIALIZATION_END',
        'LAB_180070f81': 'LABEL_INITIALIZATION_FINAL',
        'LAB_180071000': 'LABEL_ALLOCATION_START',
        'LAB_1800710b8': 'LABEL_ALLOCATION_CONTINUE',
        'LAB_18007113f': 'LABEL_ALLOCATION_END',
        'LAB_1800718e9': 'LABEL_CLEANUP_START',
        'LAB_1800715eb': 'LABEL_CLEANUP_CONTINUE',
        'LAB_180071af3': 'LABEL_CLEANUP_END',
        'LAB_180071b69': 'LABEL_CLEANUP_FINAL',
        'LAB_180071c1a': 'LABEL_FINALIZATION_START',
        'LAB_180071c93': 'LABEL_FINALIZATION_CONTINUE',
        'LAB_180071d1f': 'LABEL_FINALIZATION_END',
        'LAB_180071d94': 'LABEL_FINALIZATION_FINAL',
        'LAB_180071e34': 'LABEL_TERMINATION_START',
        'LAB_180071eb0': 'LABEL_TERMINATION_END',
        'LAB_180072120': 'LABEL_ERROR_HANDLING_START',
        'LAB_1800721e1': 'LABEL_ERROR_HANDLING_CONTINUE',
        'LAB_1800722f5': 'LABEL_ERROR_HANDLING_END',
        'LAB_180072521': 'LABEL_EXCEPTION_START',
        'LAB_1800725ac': 'LABEL_EXCEPTION_CONTINUE',
        'LAB_180072662': 'LABEL_EXCEPTION_END',
        'LAB_1800726e7': 'LABEL_EXCEPTION_FINAL',
        'LAB_180072780': 'LABEL_RECOVERY_START',
        'LAB_1800727ff': 'LABEL_RECOVERY_CONTINUE',
        'LAB_1800728ad': 'LABEL_RECOVERY_END',
        'LAB_180072934': 'LABEL_RECOVERY_FINAL',
        'LAB_1800729bd': 'LABEL_EXIT_START',
        'LAB_180075f4f': 'LABEL_SYSTEM_SHUTDOWN_START',
        'LAB_180076feb': 'LABEL_SYSTEM_SHUTDOWN_CONTINUE',
        'LAB_18007738d': 'LABEL_SYSTEM_SHUTDOWN_END',
        'LAB_180077847': 'LABEL_MEMORY_DEALLOCATION_START',
        'LAB_180077879': 'LABEL_MEMORY_DEALLOCATION_END',
        'LAB_180077fcf': 'LABEL_RESOURCE_RELEASE_START',
        'LAB_1800782d4': 'LABEL_RESOURCE_RELEASE_CONTINUE',
        'LAB_1800782e0': 'LABEL_RESOURCE_RELEASE_END',
        'LAB_180079c12': 'LABEL_CONFIGURATION_SAVE_START',
        'LAB_180079cd7': 'LABEL_CONFIGURATION_SAVE_CONTINUE',
        'LAB_180079d9b': 'LABEL_CONFIGURATION_SAVE_END',
        'LAB_18007a5ac': 'LABEL_STATE_PRESERVATION_START',
        'LAB_18007ac04': 'LABEL_STATE_PRESERVATION_END',
        'LAB_180079e40': 'LABEL_CONTEXT_SWITCH_START',
        'LAB_180079fb3': 'LABEL_CONTEXT_SWITCH_CONTINUE',
        'LAB_18007a203': 'LABEL_CONTEXT_SWITCH_END',
        'LAB_18007a142': 'LABEL_CONTEXT_SWITCH_FINAL',
        'LAB_18007a312': 'LABEL_THREAD_SYNC_START',
        'LAB_18007a58b': 'LABEL_THREAD_SYNC_END',
        'LAB_18007b44a': 'LABEL_SIGNAL_HANDLER_START',
        'LAB_18007b454': 'LABEL_SIGNAL_HANDLER_END',
        'LAB_18007b8dc': 'LABEL_INTERRUPT_HANDLER_START',
        'LAB_18007b8fd': 'LABEL_INTERRUPT_HANDLER_END',
        'LAB_18007eb55': 'LABEL_FINAL_CLEANUP_START',
        'LAB_18007f5cb': 'LABEL_FINAL_CLEANUP_CONTINUE',
        'LAB_18007f7cf': 'LABEL_FINAL_CLEANUP_END',
        'LAB_18007f89f': 'LABEL_SYSTEM_TERMINATION_START',
        'LAB_18007f89f': 'LABEL_SYSTEM_TERMINATION_END'
    }
    
    # 执行替换
    for old_label, new_label in label_mappings.items():
        # 替换标签定义
        content = content.replace(f'{old_label}:', f'{new_label}:')
        # 替换goto语句
        content = content.replace(f'goto {old_label}', f'goto {new_label}')
    
    # 写回文件
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/01_initialization.c', 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"成功替换了 {len(label_mappings)} 个LAB_标签")

if __name__ == '__main__':
    beautify_lab_labels()