#!/usr/bin/env python3
"""
批量替换03_rendering.c文件中的变量名，美化代码
"""

def replace_variable_names():
    # 读取文件内容
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c', 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 定义变量名替换映射
    replacements = {
        # 基本变量名替换
        'propertyLength': 'propertySegmentLength',
        'dataPointer': 'dataStreamPointer',
        'tempPointer': 'tempStreamPointer',
        'bufferPointer': 'bufferDataPointer',
        'objectIndex': 'objectStateIndex',
        'checksumValue': 'calculatedChecksum',
        'stackIndex': 'stackProcessingIndex',
        'referencePointer': 'referenceDataPointer',
        'stackGuard': 'stackGuardValue',
        'doublePointer': 'doubleIndirectPointer',
        'memoryBlock': 'memoryBlockPointer',
        'dataBuffer': 'dataSegmentBuffer',
        'tempBuffer': 'temporaryBuffer',
        'statusFlag': 'processingStatusFlag',
        'securityBuffer': 'securityDataBuffer',
        'processingBuffer': 'dataProcessingBuffer',
        'securityChecksum': 'securityValidationChecksum',
        'allocationSize': 'contextDataSize',
        'propertyPointer': 'propertySegmentPointer',
        
        # 特殊变量名替换
        'pointerStackVariableA8': 'propertySegmentPointer',
        'pointerStackVariableA0': 'arrayDataBuffer',
        'arrayStackVariable90': 'arrayDataBuffer',
        'unsignedStackVariable98': 'processingStatusFlag',
        'unsignedStackVariable50': 'dataSegmentLength',
        'stringPointer': 'stringDataSource',
        'ppuStack_b8': 'referenceDataPointer',
        'ppuStack_c8': 'doubleIndirectPointer',
        'puStack_b0': 'bufferDataPointer',
        'loopCounter': 'calculatedChecksum',
        'puStack_e8': 'propertySegmentPointer',
        'auStack_e8': 'dataProcessingBuffer',
        'puStack_e0': 'arrayDataBuffer',
        'uStack_e8': 'dataSegmentLength',
        'auStack_d0': 'dataProcessingBuffer',
        'uStack_d8': 'processingStatusFlag',
        'loopCounter8': 'dataSegmentLength',
        'ploopCounter8': 'bufferDataPointer',
        'iterationCount': 'calculatedChecksum',
        'propertyLength0': 'propertySegmentLength',
        'propertyLength1': 'dataSegmentLength',
        'propertyLength2': 'propertySegmentLength',
        'propertyLength3': 'dataSegmentLength',
        'propertyLength4': 'propertySegmentLength',
        'propertyLength5': 'dataSegmentLength',
        'propertyLength6': 'propertySegmentLength',
        'propertyLength7': 'dataSegmentLength',
        'propertyLength8': 'propertySegmentLength',
        'propertyLength9': 'dataSegmentLength',
        'ppropertyLength1': 'propertySegmentPointer',
        'ppropertyLength2': 'propertySegmentPointer',
        'ppropertyLength3': 'propertySegmentPointer',
        'ppropertyLength4': 'propertySegmentPointer',
        'ppropertyLength5': 'propertySegmentPointer',
        'ppropertyLength7': 'propertySegmentPointer',
        'ppropertyLength8': 'propertySegmentPointer',
        'ppropertyLength9': 'propertySegmentPointer',
        'currentNode': 'currentDataNode',
        'CalculatedValue': 'calculatedChecksum',
        'dataCounter': 'dataSegmentLength',
        'contextOffset': 'contextDataOffset',
        'contextOffset1': 'contextDataOffset1',
        'contextOffset2': 'contextDataOffset2',
        'contextOffset3': 'contextDataOffset3',
        'memoryOffset': 'memoryDataOffset',
        'bufferOffset8': 'bufferDataOffset',
        'iterationCount9': 'calculatedChecksum',
        'pbufferOffset8': 'bufferDataPointer',
        'stringLength': 'dataSegmentLength',
        'memoryOffset': 'memoryDataOffset',
        'IterationCount': 'calculatedChecksum',
        'IterationCount4': 'calculatedChecksum',
        'IterationCount9': 'calculatedChecksum',
        'byteDataPointer': 'bufferDataPointer',
        'bytePointer880': 'bufferDataPointer',
        'pbStack_460': 'bufferDataPointer',
        'pbVar1': 'bufferDataPointer',
        'pbVar2': 'bufferDataPointer',
        'pbVar5': 'bufferDataPointer',
        'pbVar11': 'bufferDataPointer',
        'pbVar12': 'bufferDataPointer',
        'pbVar1': 'bufferDataPointer',
        'pbVar6': 'bufferDataPointer',
        'pbVar1': 'bufferDataPointer',
        'pbVar2': 'bufferDataPointer',
        'pbVar5': 'bufferDataPointer',
        'pbVar11': 'bufferDataPointer',
        'iVar1': 'calculatedChecksum',
        'iVar15': 'calculatedChecksum',
        'iVar3': 'calculatedChecksum',
        'iVar4': 'calculatedChecksum',
        'iVar5': 'calculatedChecksum',
        'iVar20': 'calculatedChecksum',
        'uVar2': 'processingStatusFlag',
        'uVar3': 'calculatedChecksum',
        'uVar9': 'calculatedChecksum',
        'uVar25': 'calculatedChecksum',
        'uStack_48': 'stackGuardValue',
        'uStack_40': 'processingStatusFlag',
        'uStack_28': 'dataSegmentLength',
        'auStack_60': 'dataProcessingBuffer',
        'plStack_30': 'bufferDataPointer',
        'plStack_48': 'bufferDataPointer',
        'plStack_50': 'bufferDataPointer',
        'plStack_68': 'bufferDataPointer',
        'plStackX_8': 'bufferDataPointer',
        'plStackX_10': 'bufferDataPointer',
        'fVar1': 'processingStatusFlag',
        'fVar8': 'processingStatusFlag',
        'fVar9': 'processingStatusFlag',
        'fVar19': 'processingStatusFlag',
        'bVar1': 'processingStatusFlag',
        'bVar2': 'processingStatusFlag',
        'bVar6': 'processingStatusFlag',
        'bVar12': 'processingStatusFlag',
        'bVar16': 'processingStatusFlag',
        'bVar21': 'processingStatusFlag',
        'bVar2': 'processingStatusFlag',
        'fStack_78': 'dataProcessingBuffer',
        'fStack_74': 'dataProcessingBuffer',
        'fStack_70': 'dataProcessingBuffer',
        'fStack_68': 'dataProcessingBuffer',
        'fStack_64': 'dataProcessingBuffer',
        'fStack_60': 'dataProcessingBuffer',
        'fStack_5c': 'dataProcessingBuffer',
        'fStack_54': 'dataProcessingBuffer',
        'fStack_50': 'dataProcessingBuffer',
        'fStack_48': 'dataProcessingBuffer',
        'fStack_44': 'dataProcessingBuffer',
        'fStack_40': 'dataProcessingBuffer',
        'fStack_3c': 'dataProcessingBuffer',
        'scaleFactor': 'processingStatusFlag',
        'scaleFactor3': 'processingStatusFlag',
        'scaleFactor4': 'processingStatusFlag',
        'scaleFactor5': 'processingStatusFlag',
        'scaleFactor6': 'processingStatusFlag',
        'scaleFactor7': 'processingStatusFlag',
        'scaleFactor10': 'processingStatusFlag',
        'scaleFactor11': 'processingStatusFlag',
        'scaleFactor12': 'processingStatusFlag',
        'scaleFactor13': 'processingStatusFlag',
        'scaleFactor14': 'processingStatusFlag',
        'scaleFactor16': 'processingStatusFlag',
        'scaleFactor17': 'processingStatusFlag',
        'scaleFactor18': 'processingStatusFlag',
        'scaleFactor31': 'processingStatusFlag',
        'FourthValue': 'dataSegmentLength',
        'ThirdValue': 'propertySegmentLength',
        'renderContextBase': 'renderObjectContext',
        'prenderContextBase': 'renderObjectContext',
        'pdataPointer': 'dataStreamPointer',
        'pCalculatedValue': 'calculatedChecksum',
        'piVar1': 'calculatedChecksum',
        'pbVar2': 'bufferDataPointer',
        'ContextOffsetPointer': 'contextDataPointer',
        'ContextOffsetPointer2': 'contextDataPointer',
        'memoryBlock2': 'memoryBlockPointer',
        'lStack_900': 'calculatedChecksum',
        'lStack_8f8': 'calculatedChecksum',
        'uStack_910': 'dataSegmentLength',
        'uStack_918': 'calculatedChecksum',
        'uStack_8d8': 'processingStatusFlag',
        'auStack_8d0': 'dataProcessingBuffer',
        'puStack_8e8': 'propertySegmentPointer',
        'puStack_8e0': 'arrayDataBuffer',
        'puStack_908': 'bufferDataPointer',
        'memoryBlock': 'memoryBlockPointer',
        'dataPointer': 'dataStreamPointer',
        'ObjectState': 'renderObjectContext',
        'allocationSize': 'contextDataSize',
        'renderObjectState': 'renderObjectContext',
        'propertyLength': 'propertySegmentLength',
        'dataPointer': 'dataStreamPointer',
        'loopCounter': 'calculatedChecksum',
        'iterationCount': 'calculatedChecksum',
        'propertyLength0': 'propertySegmentLength',
        'propertyLength1': 'dataSegmentLength',
        'propertyLength2': 'propertySegmentLength',
        'propertyLength3': 'dataSegmentLength',
        'propertyLength4': 'propertySegmentLength',
        'propertyLength5': 'dataSegmentLength',
        'propertyLength6': 'propertySegmentLength',
        'propertyLength7': 'dataSegmentLength',
        'propertyLength8': 'propertySegmentLength',
        'propertyLength9': 'dataSegmentLength',
        'contextOffset': 'contextDataOffset',
        'contextOffset1': 'contextDataOffset1',
        'contextOffset2': 'contextDataOffset2',
        'contextOffset3': 'contextDataOffset3',
        'memoryOffset': 'memoryDataOffset',
        'bufferOffset8': 'bufferDataOffset',
        'iterationCount9': 'calculatedChecksum',
        'stringLength': 'dataSegmentLength',
        'memoryOffset': 'memoryDataOffset',
        'IterationCount': 'calculatedChecksum',
        'IterationCount4': 'calculatedChecksum',
        'IterationCount9': 'calculatedChecksum',
        'byteDataPointer': 'bufferDataPointer',
        'bytePointer880': 'bufferDataPointer',
        'pbStack_460': 'bufferDataPointer',
        'pbVar1': 'bufferDataPointer',
        'pbVar2': 'bufferDataPointer',
        'pbVar5': 'bufferDataPointer',
        'pbVar11': 'bufferDataPointer',
        'pbVar12': 'bufferDataPointer',
        'iVar1': 'calculatedChecksum',
        'iVar15': 'calculatedChecksum',
        'iVar3': 'calculatedChecksum',
        'iVar4': 'calculatedChecksum',
        'iVar5': 'calculatedChecksum',
        'iVar20': 'calculatedChecksum',
        'uVar2': 'processingStatusFlag',
        'uVar3': 'calculatedChecksum',
        'uVar9': 'calculatedChecksum',
        'uVar25': 'calculatedChecksum',
        'uStack_48': 'stackGuardValue',
        'uStack_40': 'processingStatusFlag',
        'uStack_28': 'dataSegmentLength',
        'auStack_60': 'dataProcessingBuffer',
        'plStack_30': 'bufferDataPointer',
        'plStack_48': 'bufferDataPointer',
        'plStack_50': 'bufferDataPointer',
        'plStack_68': 'bufferDataPointer',
        'plStackX_8': 'bufferDataPointer',
        'plStackX_10': 'bufferDataPointer',
        'fVar1': 'processingStatusFlag',
        'fVar8': 'processingStatusFlag',
        'fVar9': 'processingStatusFlag',
        'fVar19': 'processingStatusFlag',
        'bVar1': 'processingStatusFlag',
        'bVar2': 'processingStatusFlag',
        'bVar6': 'processingStatusFlag',
        'bVar12': 'processingStatusFlag',
        'bVar16': 'processingStatusFlag',
        'bVar21': 'processingStatusFlag',
        'fStack_78': 'dataProcessingBuffer',
        'fStack_74': 'dataProcessingBuffer',
        'fStack_70': 'dataProcessingBuffer',
        'fStack_68': 'dataProcessingBuffer',
        'fStack_64': 'dataProcessingBuffer',
        'fStack_60': 'dataProcessingBuffer',
        'fStack_5c': 'dataProcessingBuffer',
        'fStack_54': 'dataProcessingBuffer',
        'fStack_50': 'dataProcessingBuffer',
        'fStack_48': 'dataProcessingBuffer',
        'fStack_44': 'dataProcessingBuffer',
        'fStack_40': 'dataProcessingBuffer',
        'fStack_3c': 'dataProcessingBuffer',
        'scaleFactor': 'processingStatusFlag',
        'scaleFactor3': 'processingStatusFlag',
        'scaleFactor4': 'processingStatusFlag',
        'scaleFactor5': 'processingStatusFlag',
        'scaleFactor6': 'processingStatusFlag',
        'scaleFactor7': 'processingStatusFlag',
        'scaleFactor10': 'processingStatusFlag',
        'scaleFactor11': 'processingStatusFlag',
        'scaleFactor12': 'processingStatusFlag',
        'scaleFactor13': 'processingStatusFlag',
        'scaleFactor14': 'processingStatusFlag',
        'scaleFactor16': 'processingStatusFlag',
        'scaleFactor17': 'processingStatusFlag',
        'scaleFactor18': 'processingStatusFlag',
        'scaleFactor31': 'processingStatusFlag',
        'FourthValue': 'dataSegmentLength',
        'ThirdValue': 'propertySegmentLength',
        'renderContextBase': 'renderObjectContext',
        'prenderContextBase': 'renderObjectContext',
        'pdataPointer': 'dataStreamPointer',
        'pCalculatedValue': 'calculatedChecksum',
        'piVar1': 'calculatedChecksum',
        'pbVar2': 'bufferDataPointer',
        'ContextOffsetPointer': 'contextDataPointer',
        'ContextOffsetPointer2': 'contextDataPointer',
        'memoryBlock2': 'memoryBlockPointer',
        'lStack_900': 'calculatedChecksum',
        'lStack_8f8': 'calculatedChecksum',
        'uStack_910': 'dataSegmentLength',
        'uStack_918': 'calculatedChecksum',
        'uStack_8d8': 'processingStatusFlag',
        'auStack_8d0': 'dataProcessingBuffer',
        'puStack_8e8': 'propertySegmentPointer',
        'puStack_8e0': 'arrayDataBuffer',
        'puStack_908': 'bufferDataPointer',
    }
    
    # 应用替换
    for old_name, new_name in replacements.items():
        content = content.replace(old_name, new_name)
    
    # 写回文件
    with open('/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c', 'w', encoding='utf-8') as f:
        f.write(content)
    
    print("变量名替换完成")

if __name__ == "__main__":
    replace_variable_names()