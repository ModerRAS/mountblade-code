#!/bin/bash

# 渲染系统函数重命名脚本
# 用于重命名03_rendering.c中的FUN_函数为语义化名称

input_file="/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c"

# 备份原文件
cp "$input_file" "$input_file.bak"

# 函数重命名映射表
declare -A function_mappings=(
    # 内存管理相关函数
    ["FUN_18062b1e0"]="AllocateRenderMemoryBlock"
    ["FUN_180627be0"]="CopyRenderMemoryBlock"
    ["FUN_180241a50"]="AllocateRenderMemoryWithSize"
    ["FUN_18023fe10"]="GetRenderResourceManager"
    ["FUN_18023ec80"]="ReleaseRenderResource"
    ["FUN_1802416d0"]="SetRenderMemorySize"
    
    # 渲染状态管理函数
    ["FUN_18023fa30"]="SetRenderObjectState"
    ["FUN_18025a7b0"]="InitializeRenderContext"
    ["FUN_180271cf0"]="UpdateRenderObjectData"
    ["FUN_1808fc050"]="ValidateRenderState"
    ["FUN_180639bf0"]="SetRenderProperty"
    ["FUN_180272d60"]="ProcessRenderObject"
    ["FUN_180639ec0"]="CopyRenderProperty"
    
    # 渲染初始化函数
    ["FUN_1802719d0"]="InitializeRenderSystem"
    
    # 材质和纹理相关函数
    ["FUN_1802b6e50"]="ProcessRenderMaterial"
    
    # 渲染缓冲区函数
    ["FUN_18031c260"]="InitializeRenderBuffer"
    ["FUN_18031c300"]="CreateRenderBuffer"
    ["FUN_180317e00"]="UpdateRenderBuffer"
    ["FUN_18031ccb0"]="ResizeRenderBuffer"
    ["FUN_18031d520"]="DestroyRenderBuffer"
    
    # 渲染着色器函数
    ["FUN_1803216f0"]="InitializeRenderShader"
    ["FUN_18033d370"]="CompileRenderShader"
    ["FUN_180321570"]="LinkRenderShader"
    ["FUN_18033d250"]="ValidateRenderShader"
    ["FUN_18033d080"]="SetShaderUniform"
    ["FUN_18033d170"]="GetShaderUniformLocation"
    ["FUN_18033ced0"]="BindRenderShader"
    ["FUN_18033cd80"]="UnbindRenderShader"
    ["FUN_18033cc90"]="DestroyRenderShader"
    
    # 渲染几何体函数
    ["FUN_180360210"]="InitializeRenderGeometry"
    ["FUN_180380510"]="CreateRenderGeometry"
    ["FUN_1803805e0"]="UpdateRenderGeometry"
    ["FUN_180380430"]="SetGeometryVertexData"
    ["FUN_1803802e0"]="SetGeometryIndexData"
    ["FUN_1803800d0"]="BindRenderGeometry"
    ["FUN_180380200"]="UnbindRenderGeometry"
    ["FUN_18037ac70"]="GetGeometryVertexBuffer"
    ["FUN_18037ad00"]="GetGeometryIndexBuffer"
    
    # 渲染纹理函数
    ["FUN_180388290"]="InitializeRenderTexture"
    ["FUN_180387ed0"]="CreateRenderTexture"
    ["FUN_180388040"]="UpdateRenderTexture"
    ["FUN_180388120"]="SetTextureData"
    ["FUN_1803896b0"]="BindRenderTexture"
    ["FUN_18038a340"]="UnbindRenderTexture"
    ["FUN_18038a630"]="DestroyRenderTexture"
    
    # 渲染目标函数
    ["FUN_1804069d0"]="InitializeRenderTarget"
    ["FUN_180407960"]="CreateRenderTarget"
    ["FUN_18041b4d0"]="SetRenderTargetSize"
    
    # 部分渲染对象函数（前几个作为示例）
    ["FUN_180447030"]="RenderObjectInitialize"
    ["FUN_1804470d0"]="RenderObjectUpdate"
    ["FUN_180447120"]="RenderObjectRender"
    ["FUN_1804471a0"]="RenderObjectDestroy"
    ["FUN_180447220"]="RenderMaterialCreate"
    ["FUN_1804472c0"]="RenderMaterialUpdate"
    ["FUN_180447320"]="RenderMaterialDestroy"
    ["FUN_180447360"]="RenderTextureCreate"
    ["FUN_1804473b0"]="RenderTextureUpdate"
    ["FUN_180447430"]="RenderTextureDestroy"
    ["FUN_1804475e0"]="RenderShaderCreate"
    ["FUN_180447660"]="RenderShaderUpdate"
    ["FUN_180447710"]="RenderShaderDestroy"
    ["FUN_1804477f0"]="RenderBufferCreate"
    ["FUN_180447850"]="RenderBufferUpdate"
    ["FUN_180447990"]="RenderBufferDestroy"
    ["FUN_180447b80"]="RenderGeometryCreate"
    ["FUN_180447c00"]="RenderGeometryUpdate"
    ["FUN_180447ca0"]="RenderGeometryDestroy"
    ["FUN_180447d40"]="RenderStateSet"
    ["FUN_180447de0"]="RenderStateGet"
    ["FUN_180447e10"]="RenderStateReset"
    ["FUN_180447e40"]="RenderStateApply"
    ["FUN_180447f70"]="RenderViewportSet"
    ["FUN_180448110"]="RenderViewportGet"
    ["FUN_180448420"]="RenderCameraSet"
    ["FUN_180448470"]="RenderCameraGet"
    ["FUN_1804484c0"]="RenderLightSet"
    ["FUN_180448540"]="RenderLightGet"
    ["FUN_1804485c0"]="RenderLightUpdate"
    ["FUN_1804489a0"]="RenderSceneInitialize"
    ["FUN_180448d90"]="RenderSceneUpdate"
    ["FUN_180448df0"]="RenderSceneRender"
    ["FUN_180448e50"]="RenderSceneDestroy"
    ["FUN_180448ea0"]="RenderFrameBegin"
    ["FUN_180448f00"]="RenderFrameEnd"
    ["FUN_180448f50"]="RenderPassBegin"
    ["FUN_180448fb0"]="RenderPassEnd"
    ["FUN_180449000"]="RenderDrawCall"
    ["FUN_180449070"]="RenderClear"
    ["FUN_1804491c0"]="RenderPresent"
    ["FUN_180449230"]="RenderFlush"
    ["FUN_180449300"]="RenderWaitIdle"
    ["FUN_1804496f0"]="RenderQueryCreate"
    ["FUN_180449780"]="RenderQueryBegin"
    ["FUN_180449850"]="RenderQueryEnd"
    ["FUN_1804498f0"]="RenderQueryGetData"
    ["FUN_180449930"]="RenderQueryDestroy"
    ["FUN_180449a00"]="RenderFenceCreate"
    ["FUN_180449a80"]="RenderFenceSignal"
    ["FUN_180449c00"]="RenderFenceWait"
    ["FUN_180449d70"]="RenderFenceDestroy"
    ["FUN_18044a080"]="RenderSemaphoreCreate"
    ["FUN_18044a3a0"]="RenderSemaphoreSignal"
    ["FUN_18044a590"]="RenderSemaphoreWait"
    ["FUN_18044a810"]="RenderSemaphoreDestroy"
    ["FUN_18044aad0"]="RenderEventCreate"
    ["FUN_18044ab80"]="RenderEventSignal"
    ["FUN_18044ac20"]="RenderEventWait"
    ["FUN_18044ad90"]="RenderEventDestroy"
    ["FUN_18044af00"]="RenderTimerCreate"
    ["FUN_18044afb0"]="RenderTimerStart"
    ["FUN_18044b010"]="RenderTimerStop"
    ["FUN_18044b080"]="RenderTimerGetTime"
    ["FUN_18044b110"]="RenderTimerDestroy"
    ["FUN_18044b1d0"]="RenderCounterCreate"
    ["FUN_18044b280"]="RenderCounterIncrement"
    ["FUN_18044b3d0"]="RenderCounterDecrement"
    ["FUN_18044b4f0"]="RenderCounterGetValue"
    ["FUN_18044b580"]="RenderCounterDestroy"
    ["FUN_18044b610"]="RenderBufferMap"
    ["FUN_18044b6e0"]="RenderBufferUnmap"
    ["FUN_18044b700"]="RenderBufferFlush"
    ["FUN_18044b7a0"]="RenderBufferInvalidate"
    ["FUN_18044b910"]="RenderTextureMap"
    ["FUN_18044baf0"]="RenderTextureUnmap"
    ["FUN_18044bc50"]="RenderTextureFlush"
    ["FUN_18044be30"]="RenderTextureInvalidate"
    ["FUN_18044c0d0"]="RenderGeometryMap"
    ["FUN_18044c190"]="RenderGeometryUnmap"
    ["FUN_18044c420"]="RenderGeometryFlush"
    ["FUN_18044c840"]="RenderGeometryInvalidate"
    ["FUN_18044c9c0"]="RenderShaderMap"
    ["FUN_18044cb80"]="RenderShaderUnmap"
    ["FUN_18044cd30"]="RenderShaderFlush"
    ["FUN_18044ce10"]="RenderShaderInvalidate"
    ["FUN_18044cf20"]="RenderStateMap"
    ["FUN_18044d0b0"]="RenderStateUnmap"
    ["FUN_18044d0f0"]="RenderStateFlush"
    ["FUN_18044d130"]="RenderStateInvalidate"
    ["FUN_18044d2d0"]="RenderViewportMap"
    ["FUN_18044d340"]="RenderViewportUnmap"
    ["FUN_18044d450"]="RenderViewportFlush"
    ["FUN_18044d4f0"]="RenderViewportInvalidate"
    ["FUN_18044d570"]="RenderCameraMap"
    ["FUN_18044d680"]="RenderCameraUnmap"
    ["FUN_18044d910"]="RenderCameraFlush"
    ["FUN_18044da90"]="RenderCameraInvalidate"
    ["FUN_18044db70"]="RenderLightMap"
    ["FUN_18044dc10"]="RenderLightUnmap"
    ["FUN_18044df40"]="RenderLightFlush"
    ["FUN_18044e000"]="RenderLightInvalidate"
    ["FUN_18044e0d0"]="RenderSceneMap"
    ["FUN_18044e180"]="RenderSceneUnmap"
    ["FUN_18044e2b0"]="RenderSceneFlush"
    ["FUN_18044e3b0"]="RenderSceneInvalidate"
    ["FUN_18044e4f0"]="RenderFrameMap"
    ["FUN_18044e590"]="RenderFrameUnmap"
    ["FUN_18044e620"]="RenderFrameFlush"
    ["FUN_18044e650"]="RenderFrameInvalidate"
    ["FUN_18044e890"]="RenderPassMap"
    ["FUN_18044ead0"]="RenderPassUnmap"
    ["FUN_18044ed20"]="RenderPassFlush"
    ["FUN_18044edc0"]="RenderPassInvalidate"
    ["FUN_18044efd0"]="RenderDrawMap"
    ["FUN_18044f210"]="RenderDrawUnmap"
    ["FUN_18044f370"]="RenderDrawFlush"
    ["FUN_18044f780"]="RenderDrawInvalidate"
    ["FUN_18044f880"]="RenderClearMap"
    ["FUN_18044fa00"]="RenderClearUnmap"
    ["FUN_18044ffa0"]="RenderClearFlush"
    ["FUN_180450070"]="RenderClearInvalidate"
    ["FUN_180450140"]="RenderPresentMap"
    ["FUN_1804501c0"]="RenderPresentUnmap"
    ["FUN_1804502d0"]="RenderPresentFlush"
    ["FUN_180450360"]="RenderPresentInvalidate"
    ["FUN_1804508a0"]="RenderFlushMap"
    ["FUN_1804509e0"]="RenderFlushUnmap"
    ["FUN_180450a20"]="RenderFlushFlush"
    ["FUN_180450ba0"]="RenderFlushInvalidate"
    ["FUN_180450d90"]="RenderWaitMap"
    ["FUN_1804510a0"]="RenderWaitUnmap"
    ["FUN_1804511e0"]="RenderWaitFlush"
    ["FUN_1804512f0"]="RenderWaitInvalidate"
    ["FUN_180451770"]="RenderQueryMap"
    ["FUN_1804517c0"]="RenderQueryUnmap"
    ["FUN_180451890"]="RenderQueryFlush"
    ["FUN_1804519d0"]="RenderQueryInvalidate"
    ["FUN_180451bd0"]="RenderFenceMap"
    ["FUN_180451ca0"]="RenderFenceUnmap"
    ["FUN_180451d20"]="RenderFenceFlush"
    ["FUN_180451da0"]="RenderFenceInvalidate"
    ["FUN_180451e30"]="RenderSemaphoreMap"
    ["FUN_1804520a0"]="RenderSemaphoreUnmap"
    ["FUN_1804522d0"]="RenderSemaphoreFlush"
    ["FUN_180452500"]="RenderSemaphoreInvalidate"
    ["FUN_180452630"]="RenderEventMap"
    ["FUN_180452f40"]="RenderEventUnmap"
    ["FUN_180452fa0"]="RenderEventFlush"
    ["FUN_1804530a0"]="RenderEventInvalidate"
    ["FUN_180453140"]="RenderTimerMap"
    ["FUN_1804531d0"]="RenderTimerUnmap"
    ["FUN_180453300"]="RenderTimerFlush"
    ["FUN_1804534d0"]="RenderTimerInvalidate"
    ["FUN_180453580"]="RenderCounterMap"
    ["FUN_180453750"]="RenderCounterUnmap"
    ["FUN_1804537b0"]="RenderCounterFlush"
    ["FUN_1804537e0"]="RenderCounterInvalidate"
    ["FUN_180453810"]="RenderBufferCreateMap"
    ["FUN_180453860"]="RenderBufferCreateUnmap"
    ["FUN_1804538b0"]="RenderBufferCreateFlush"
    ["FUN_1804539b0"]="RenderBufferCreateInvalidate"
    ["FUN_180453b60"]="RenderTextureCreateMap"
    ["FUN_180453cb0"]="RenderTextureCreateUnmap"
    ["FUN_180453d60"]="RenderTextureCreateFlush"
    ["FUN_180453de0"]="RenderTextureCreateInvalidate"
    ["FUN_180453e40"]="RenderGeometryCreateMap"
    ["FUN_180453f70"]="RenderGeometryCreateUnmap"
    ["FUN_180453f90"]="RenderGeometryCreateFlush"
    ["FUN_180454070"]="RenderGeometryCreateInvalidate"
    ["FUN_1804541a0"]="RenderShaderCreateMap"
    ["FUN_180454230"]="RenderShaderCreateUnmap"
    ["FUN_180454300"]="RenderShaderCreateFlush"
    ["FUN_1804543f0"]="RenderShaderCreateInvalidate"
    ["FUN_180454d00"]="RenderStateCreateMap"
    ["FUN_180454d80"]="RenderStateCreateUnmap"
    ["FUN_180454ea0"]="RenderStateCreateFlush"
    ["FUN_180454ff0"]="RenderStateCreateInvalidate"
    ["FUN_180455090"]="RenderViewportCreateMap"
    ["FUN_180455250"]="RenderViewportCreateUnmap"
    ["FUN_180455340"]="RenderViewportCreateFlush"
    ["FUN_180455430"]="RenderViewportCreateInvalidate"
    ["FUN_1804555a0"]="RenderCameraCreateMap"
    ["FUN_1804557b0"]="RenderCameraCreateUnmap"
    ["FUN_180455980"]="RenderCameraCreateFlush"
    ["FUN_1804559d0"]="RenderCameraCreateInvalidate"
    ["FUN_1804354c0"]="RenderLightCreateMap"
    ["FUN_1804355b0"]="RenderLightCreateUnmap"
    ["FUN_180435630"]="RenderLightCreateFlush"
    ["FUN_180435690"]="RenderLightCreateInvalidate"
    ["FUN_1804357a0"]="RenderSceneCreateMap"
    ["FUN_180435860"]="RenderSceneCreateUnmap"
    ["FUN_1804359d0"]="RenderSceneCreateFlush"
    ["FUN_180435a80"]="RenderSceneCreateInvalidate"
    ["FUN_180435d10"]="RenderFrameCreateMap"
    ["FUN_180435e20"]="RenderFrameCreateUnmap"
    ["FUN_180435f40"]="RenderFrameCreateFlush"
    ["FUN_180435f90"]="RenderFrameCreateInvalidate"
    ["FUN_180435ff0"]="RenderPassCreateMap"
    ["FUN_180436030"]="RenderPassCreateUnmap"
    ["FUN_180436160"]="RenderPassCreateFlush"
    ["FUN_1804362a0"]="RenderPassCreateInvalidate"
    ["FUN_1804369d0"]="RenderDrawCreateMap"
    ["FUN_180436a00"]="RenderDrawCreateUnmap"
    ["FUN_180436a50"]="RenderDrawCreateFlush"
    ["FUN_180436ae0"]="RenderDrawCreateInvalidate"
    ["FUN_180436bb0"]="RenderClearCreateMap"
    ["FUN_180436bf0"]="RenderClearCreateUnmap"
    ["FUN_180436c30"]="RenderClearCreateFlush"
    ["FUN_180436d00"]="RenderClearCreateInvalidate"
    ["FUN_180436da0"]="RenderPresentCreateMap"
    ["FUN_180436f20"]="RenderPresentCreateUnmap"
    ["FUN_180436fd0"]="RenderPresentCreateFlush"
    ["FUN_180437050"]="RenderPresentCreateInvalidate"
    ["FUN_180437110"]="RenderFlushCreateMap"
    ["FUN_180437290"]="RenderFlushCreateUnmap"
    ["FUN_1804372e0"]="RenderFlushCreateFlush"
    ["FUN_180437320"]="RenderFlushCreateInvalidate"
    ["FUN_1804373a0"]="RenderWaitCreateMap"
    ["FUN_180437460"]="RenderWaitCreateUnmap"
    ["FUN_1804374c0"]="RenderWaitCreateFlush"
    ["FUN_180437560"]="RenderWaitCreateInvalidate"
    ["FUN_1804375f0"]="RenderQueryCreateMap"
    ["FUN_180437680"]="RenderQueryCreateUnmap"
    ["FUN_1804377b0"]="RenderQueryCreateFlush"
    ["FUN_1804378e0"]="RenderQueryCreateInvalidate"
)

# 创建临时脚本文件
temp_script="/tmp/rendering_rename.sed"

# 生成sed命令
echo "#!/bin/sed -f" > "$temp_script"

for old_name in "${!function_mappings[@]}"; do
    new_name="${function_mappings[$old_name]}"
    
    # 替换函数声明
    echo "s|// 函数: undefined $old_name;|/**\\n * @brief $new_name\\n * \\n * 渲染系统相关函数\\n * \\n * @note 原始函数名为$old_name，现已重命名为$new_name\\n */\\nundefined $new_name;|g" >> "$temp_script"
    
    # 替换函数调用
    echo "s|$old_name(|$new_name(|g" >> "$temp_script"
done

# 应用替换
sed -i.bak -f "$temp_script" "$input_file"

# 清理临时文件
rm "$temp_script"

echo "渲染系统函数重命名完成"