#!/bin/bash

# 批量替换网络模块中的LAB标签为语义化名称

cd /dev/shm/mountblade-code/TaleWorlds.Native/src

# 定义LAB标签到语义化名称的映射
declare -A LAB_MAPPINGS=(
    ["LAB_1808591d6"]="NetworkValidationFailure"
    ["LAB_180859535"]="NetworkConnectionTimeout"
    ["LAB_180859665"]="NetworkConnectionStatusFlagExit"
    ["LAB_180859953"]="NetworkPacketDataExit"
    ["LAB_18085996b"]="NetworkOperationComplete"
    ["LAB_1808597c2"]="NetworkTimeoutCheck"
    ["LAB_180859ef9"]="NetworkDataPointerCheck"
    ["LAB_18085a4c4"]="NetworkConnectionComplete"
    ["LAB_18085a4fd"]="NetworkSecurityValidation"
    ["LAB_18085a294"]="NetworkValidationCheck"
    ["LAB_18085a2e9"]="NetworkPacketProcessingStart"
    ["LAB_18085a4b5"]="NetworkPacketProcessingEnd"
    ["LAB_18085a91b"]="NetworkPacketDataCheck"
    ["LAB_18085a652"]="NetworkPacketValidation"
    ["LAB_18085a66c"]="NetworkConnectionStatusCheck"
    ["LAB_18085a689"]="NetworkConnectionValidation"
    ["LAB_18085a698"]="NetworkDataProcessing"
    ["LAB_18085a6ac"]="NetworkStatusCheck"
    ["LAB_18085a6b0"]="NetworkStatusValidation"
    ["LAB_18085a742"]="NetworkBufferProcessing"
    ["LAB_18085a746"]="NetworkBufferValidation"
    ["LAB_18085a7de"]="NetworkDataTransfer"
    ["LAB_18085a8bd"]="NetworkTransferComplete"
    ["LAB_18085a8c1"]="NetworkTransferValidation"
    ["LAB_18085abe3"]="NetworkProtocolProcessing"
    ["LAB_180857f18"]="NetworkProtocolExit"
    ["LAB_180858c20"]="NetworkConnectionSetup"
    ["LAB_180858e04"]="NetworkConnectionError"
    ["LAB_18085add0"]="NetworkSecurityCheck"
    ["LAB_18085b8b5"]="NetworkIterationComplete"
    ["LAB_18085b88c"]="NetworkIterationExit"
    ["LAB_18085c76e"]="NetworkDataValidation"
    ["LAB_18085d424"]="NetworkConnectionFailure"
    ["LAB_18085ceec"]="NetworkConnectionRetry"
    ["LAB_18085d2fd"]="NetworkConnectionSuccess"
    ["LAB_18085d4e7"]="NetworkDataProcessingComplete"
    ["LAB_18085d61f"]="NetworkPacketProcessingComplete"
    ["LAB_18085d78f"]="NetworkContextInitialization"
    ["LAB_18085e1d5"]="NetworkContextValidation"
    ["LAB_18085ea6d"]="NetworkTimeoutValidation"
    ["LAB_18085ebc2"]="NetworkLoopContinuation"
    ["LAB_18085f8b2"]="NetworkStatusUpdate"
    ["LAB_1808605ab"]="NetworkHandleValidation"
    ["LAB_1808605b0"]="NetworkHandleProcessing"
    ["LAB_1808607eb"]="NetworkConnectionProcessing"
    ["LAB_180860998"]="NetworkDataValidationCheck"
    ["LAB_1808609c2"]="NetworkDataProcessingStart"
    ["LAB_180860a65"]="NetworkDataProcessingContinue"
    ["LAB_180860af6"]="NetworkDataValidationComplete"
    ["LAB_180860f7b"]="NetworkDataTransferComplete"
    ["LAB_18086142b"]="NetworkPacketProcessingComplete"
    ["LAB_180861693"]="NetworkOperationFailure"
    ["LAB_18086154d"]="NetworkConnectionIndexCheck"
    ["LAB_180861f94"]="NetworkDataTransferStart"
    ["LAB_18086223e"]="NetworkPrimaryStatusCheck"
    ["LAB_180862261"]="NetworkPrimaryStatusValidation"
    ["LAB_180862804"]="NetworkConnectionDataCheck"
    ["LAB_180863270"]="NetworkSecurityFlagCheck"
    ["LAB_1808632ec"]="NetworkConnectionStatusCheck"
    ["LAB_180863343"]="NetworkConnectionComplete"
    ["LAB_1808634f7"]="NetworkConnectionIndexValidation"
    ["LAB_18086350f"]="NetworkConnectionIndexReset"
    ["LAB_180863615"]="NetworkConnectionContextCheck"
    ["LAB_180863724"]="NetworkConnectionContextValidation"
    ["LAB_18086378e"]="NetworkConnectionContextProcessing"
    ["LAB_180863790"]="NetworkConnectionContextContinue"
    ["LAB_180863795"]="NetworkConnectionContextComplete"
    ["LAB_18086389c"]="NetworkPacketDataValidation"
    ["LAB_180864019"]="NetworkConnectionStatusValidation"
    ["LAB_1808640fb"]="NetworkConnectionSecurityCheck"
    ["LAB_180864477"]="NetworkConnectionTimeoutCheck"
    ["LAB_1808645f6"]="NetworkConnectionRetryLoop"
    ["LAB_18086460a"]="NetworkConnectionRetryComplete"
    ["LAB_180864624"]="NetworkConnectionProcessingComplete"
    ["LAB_180864627"]="NetworkConnectionProcessingExit"
    ["LAB_18086428a"]="NetworkConnectionSecondaryCheck"
    ["LAB_1808642a1"]="NetworkConnectionSecondaryValidation"
)

# 创建临时文件进行替换
temp_file="05_networking_temp.c"
cp 05_networking.c "$temp_file"

# 执行替换操作
for lab_label in "${!LAB_MAPPINGS[@]}"; do
    semantic_name="${LAB_MAPPINGS[$lab_label]}"
    echo "替换 $lab_label -> $semantic_name"
    sed -i "s/goto $lab_label$/goto $semantic_name/g" "$temp_file"
    sed -i "s/^$lab_label:/$semantic_name:/g" "$temp_file"
done

# 替换文件
mv "$temp_file" 05_networking.c

echo "LAB标签替换完成"