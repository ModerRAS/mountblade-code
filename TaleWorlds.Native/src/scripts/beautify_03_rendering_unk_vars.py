#!/usr/bin/env python3
"""
美化03_rendering.c文件中的UNK_变量名
"""

import re
import sys

def beautify_rendering_file():
    input_file = '/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c'
    
    # 读取文件内容
    with open(input_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # 定义UNK_变量重命名映射
    # 基于地址范围和上下文推测功能
    unk_mappings = {
        'UNK_18044fba0': 'RenderCommandBufferFlushCallback',
        'UNK_18044fbc0': 'RenderCommandBufferExecuteCallback',
        'UNK_18044fbe0': 'RenderPassBeginCallback',
        'UNK_18044fc00': 'RenderPassEndCallback',
        'UNK_18044fc20': 'RenderPassBindCallback',
        'UNK_18044fc40': 'RenderPassUnbindCallback',
        'UNK_18044fc60': 'RenderTargetSetCallback',
        'UNK_18044fc80': 'RenderTargetClearCallback',
        'UNK_18044fca0': 'RenderTargetBlitCallback',
        'UNK_18044fcc0': 'RenderTargetResolveCallback',
        'UNK_18044fce0': 'DepthStencilSetCallback',
        'UNK_18044fd00': 'DepthStencilClearCallback',
        'UNK_18044fd20': 'DepthStencilBindCallback',
        'UNK_18044fd40': 'StencilTestEnableCallback',
        'UNK_18044fd60': 'StencilFuncSetCallback',
        'UNK_18044fd80': 'StencilOpSetCallback',
        'UNK_18044fda0': 'StencilMaskSetCallback',
        'UNK_18044fdc0': 'DepthTestEnableCallback',
        'UNK_18044fde0': 'DepthFuncSetCallback',
        'UNK_18044fe00': 'DepthMaskSetCallback',
        'UNK_18044fe20': 'DepthRangeSetCallback',
        'UNK_18044fe40': 'BlendStateEnableCallback',
        'UNK_18044fe60': 'BlendFuncSetCallback',
        'UNK_18044fe80': 'BlendEquationSetCallback',
        'UNK_18044fe90': 'BlendColorSetCallback',
        'UNK_18044fea0': 'BlendMaskSetCallback',
        'UNK_18044fee0': 'RasterizerStateSetCallback',
        'UNK_18044ff00': 'CullModeSetCallback',
        'UNK_18044ff20': 'FrontFaceSetCallback',
        'UNK_18044ff40': 'PolygonModeSetCallback',
        'UNK_18044ff60': 'LineWidthSetCallback',
        'UNK_18044ff80': 'PointSizeSetCallback',
        'UNK_180450350': 'ViewportSetCallback',
        'UNK_180450a00': 'ScissorSetCallback',
        'UNK_180450b90': 'VertexInputSetCallback',
        'UNK_1804512e0': 'VertexAttributeSetCallback',
        'UNK_1804517b0': 'VertexBindingSetCallback',
        'UNK_1804518e0': 'VertexDivisorSetCallback',
        'UNK_1804518f0': 'ShaderProgramSetCallback',
        'UNK_180451900': 'ShaderUniformSetCallback',
        'UNK_180451920': 'ShaderAttributeSetCallback',
        'UNK_180451930': 'TextureBindCallback',
        'UNK_180451940': 'TextureUnbindCallback',
        'UNK_180451970': 'SamplerBindCallback',
        'UNK_180451990': 'BufferBindCallback',
        'UNK_1804519b0': 'BufferUnbindCallback',
        'UNK_180451c70': 'DrawArraysCallback',
        'UNK_180451c80': 'DrawElementsCallback',
        'UNK_180451c90': 'DrawIndexedCallback',
        'UNK_180452530': 'DrawIndirectCallback',
        'UNK_180452550': 'DispatchComputeCallback',
        'UNK_180452570': 'MemoryBarrierCallback',
        'UNK_180452590': 'FenceSyncCallback',
        'UNK_1804525b0': 'QueryBeginCallback',
        'UNK_1804525d0': 'QueryEndCallback',
        'UNK_1804525f0': 'QueryResultCallback',
        'UNK_180452610': 'TextureCreateCallback',
        'UNK_180452630': 'TextureDestroyCallback',
        'UNK_180452650': 'TextureUploadCallback',
        'UNK_180452670': 'TextureDownloadCallback',
        'UNK_180452690': 'BufferCreateCallback',
        'UNK_1804526b0': 'BufferDestroyCallback',
        'UNK_1804526d0': 'BufferUploadCallback',
        'UNK_1804526f0': 'BufferDownloadCallback',
        'UNK_180452710': 'ShaderCreateCallback',
        'UNK_180452730': 'ShaderDestroyCallback',
        'UNK_180452750': 'ShaderCompileCallback',
        'UNK_180452770': 'ShaderLinkCallback',
        'UNK_180452790': 'ProgramCreateCallback',
        'UNK_1804527b0': 'ProgramDestroyCallback',
        'UNK_1804527d0': 'ProgramUseCallback',
        'UNK_1804527f0': 'PipelineCreateCallback',
        'UNK_180452810': 'PipelineDestroyCallback',
        'UNK_180452830': 'PipelineBindCallback',
        'UNK_180452850': 'FramebufferCreateCallback',
        'UNK_180452870': 'FramebufferDestroyCallback',
        'UNK_180452890': 'FramebufferBindCallback',
        'UNK_1804528b0': 'RenderbufferCreateCallback',
        'UNK_1804528d0': 'RenderbufferDestroyCallback',
        'UNK_1804528f0': 'RenderbufferBindCallback',
        'UNK_180452910': 'VertexArrayCreateCallback',
        'UNK_180452930': 'VertexArrayDestroyCallback',
        'UNK_180452950': 'VertexArrayBindCallback',
        'UNK_180452970': 'VertexArrayUnbindCallback',
        'UNK_180452990': 'VertexArrayAttributeSetCallback',
        'UNK_1804529b0': 'VertexArrayBindingSetCallback',
        'UNK_1804529d0': 'TransformFeedbackCreateCallback',
        'UNK_1804529f0': 'TransformFeedbackDestroyCallback',
        'UNK_180452a10': 'TransformFeedbackBindCallback',
        'UNK_180452a30': 'TransformFeedbackBeginCallback',
        'UNK_180452a50': 'TransformFeedbackEndCallback',
        'UNK_180452a70': 'TransformFeedbackPauseCallback',
        'UNK_180452a90': 'TransformFeedbackResumeCallback',
        'UNK_180452ab0': 'QueryCreateCallback',
        'UNK_180452ad0': 'QueryDestroyCallback',
        'UNK_180452af0': 'QueryBeginCallback',
        'UNK_180452b10': 'QueryEndCallback',
        'UNK_180452b30': 'QueryResultCallback',
        'UNK_180452b50': 'SyncCreateCallback',
        'UNK_180452b70': 'SyncDestroyCallback',
        'UNK_180452b90': 'SyncSignalCallback',
        'UNK_180452bb0': 'SyncWaitCallback',
        'UNK_180452bd0': 'SyncClientWaitCallback',
        'UNK_180452bf0': 'FenceCreateCallback',
        'UNK_180452c10': 'FenceDestroyCallback',
        'UNK_180452c30': 'FenceSignalCallback',
        'UNK_180452c50': 'FenceWaitCallback',
        'UNK_180452c70': 'FenceClientWaitCallback',
        'UNK_180452c90': 'MemoryMapCallback',
        'UNK_180452cb0': 'MemoryUnmapCallback',
        'UNK_180452cd0': 'MemoryFlushCallback',
        'UNK_180452cf0': 'MemoryInvalidateCallback',
        'UNK_180452d10': 'TextureGenerateMipmapCallback',
        'UNK_180452d30': 'TextureCopyCallback',
        'UNK_180452d50': 'TextureCompressCallback',
        'UNK_180452d70': 'TextureDecompressCallback',
        'UNK_180452d90': 'BufferCopyCallback',
        'UNK_180452db0': 'BufferFillCallback',
        'UNK_180452dd0': 'BufferInvalidateCallback',
        'UNK_180452df0': 'ShaderUniformSetCallback',
        'UNK_180452e10': 'ShaderUniformGetCallback',
        'UNK_180452e30': 'ShaderAttributeSetCallback',
        'UNK_180452e50': 'ShaderAttributeGetCallback',
        'UNK_180452e70': 'ProgramUniformSetCallback',
        'UNK_180452e90': 'ProgramUniformGetCallback',
        'UNK_180452eb0': 'ProgramAttributeSetCallback',
        'UNK_180452ed0': 'ProgramAttributeGetCallback',
        'UNK_180452ef0': 'TextureParameterSetCallback',
        'UNK_180452f10': 'TextureParameterGetCallback',
        'UNK_180452f30': 'SamplerParameterSetCallback',
        'UNK_180452f50': 'SamplerParameterGetCallback',
        'UNK_180452f70': 'BufferParameterSetCallback',
        'UNK_180452f90': 'BufferParameterGetCallback',
        'UNK_180452fb0': 'PipelineParameterSetCallback',
        'UNK_180452fd0': 'PipelineParameterGetCallback',
        'UNK_180452ff0': 'FramebufferParameterSetCallback',
        'UNK_180453010': 'FramebufferParameterGetCallback',
        'UNK_180453030': 'RenderbufferParameterSetCallback',
        'UNK_180453050': 'RenderbufferParameterGetCallback',
        'UNK_180453070': 'VertexArrayParameterSetCallback',
        'UNK_180453090': 'VertexArrayParameterGetCallback',
        'UNK_1804530b0': 'TransformFeedbackParameterSetCallback',
        'UNK_1804530d0': 'TransformFeedbackParameterGetCallback',
        'UNK_1804530f0': 'QueryParameterSetCallback',
        'UNK_180453110': 'QueryParameterGetCallback',
        'UNK_180453130': 'SyncParameterSetCallback',
        'UNK_180453150': 'SyncParameterGetCallback',
        'UNK_180453170': 'FenceParameterSetCallback',
        'UNK_180453190': 'FenceParameterGetCallback',
        'UNK_1804531b0': 'MemoryParameterSetCallback',
        'UNK_1804531d0': 'MemoryParameterGetCallback',
        'UNK_1804531f0': 'ShaderParameterSetCallback',
        'UNK_180453210': 'ShaderParameterGetCallback',
        'UNK_180453230': 'ProgramParameterSetCallback',
        'UNK_180453250': 'ProgramParameterGetCallback',
        'UNK_180453270': 'TextureParameterSetCallback',
        'UNK_180453290': 'TextureParameterGetCallback',
        'UNK_1804532b0': 'SamplerParameterSetCallback',
        'UNK_1804532d0': 'SamplerParameterGetCallback',
        'UNK_1804532f0': 'BufferParameterSetCallback',
        'UNK_180453310': 'BufferParameterGetCallback',
        'UNK_180453330': 'PipelineParameterSetCallback',
        'UNK_180453350': 'PipelineParameterGetCallback',
        'UNK_180453370': 'FramebufferParameterSetCallback',
        'UNK_180453390': 'FramebufferParameterGetCallback',
        'UNK_1804533b0': 'RenderbufferParameterSetCallback',
        'UNK_1804533d0': 'RenderbufferParameterGetCallback',
        'UNK_1804533f0': 'VertexArrayParameterSetCallback',
        'UNK_180453410': 'VertexArrayParameterGetCallback',
        'UNK_180453430': 'TransformFeedbackParameterSetCallback',
        'UNK_180453450': 'TransformFeedbackParameterGetCallback',
        'UNK_180453470': 'QueryParameterSetCallback',
        'UNK_180453490': 'QueryParameterGetCallback',
        'UNK_1804534b0': 'SyncParameterSetCallback',
        'UNK_1804534d0': 'SyncParameterGetCallback',
        'UNK_1804534f0': 'FenceParameterSetCallback',
        'UNK_180453510': 'FenceParameterGetCallback',
        'UNK_180453530': 'MemoryParameterSetCallback',
        'UNK_180453550': 'MemoryParameterGetCallback'
    }
    
    # 应用重命名映射
    for old_name, new_name in unk_mappings.items():
        # 只替换完整的变量名
        pattern = r'\b' + re.escape(old_name) + r'\b'
        content = re.sub(pattern, new_name, content)
    
    # 写回文件
    with open(input_file, 'w', encoding='utf-8') as f:
        f.write(content)
    
    print(f"成功美化 {len(unk_mappings)} 个UNK_变量名")

if __name__ == "__main__":
    beautify_rendering_file()