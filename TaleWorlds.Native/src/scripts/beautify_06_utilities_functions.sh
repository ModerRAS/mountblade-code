#!/bin/bash

# 批量重命名06_utilities.c中的Unwind函数

# 定义重命名映射
declare -A rename_mapping=(
    # 系统资源处理相关函数
    ["Unwind_180905010"]="InitializeSystemResourceHandlerTemplate"
    ["Unwind_180905020"]="ExecuteSystemResourceCleanupWithFlags"
    ["Unwind_180905030"]="ValidateSystemResourceContext"
    ["Unwind_180905040"]="ExecuteSystemResourceValidationWithFlags"
    ["Unwind_180905050"]="InitializeSystemResourceValidator"
    ["Unwind_180905060"]="ExecuteSystemResourceValidation"
    ["Unwind_180905070"]="CleanupSystemResourceContext"
    ["Unwind_180905080"]="InitializeSystemResourceCleanup"
    ["Unwind_180905090"]="ExecuteSystemResourceCleanup"
    ["Unwind_1809050c0"]="ValidateSystemResourceIntegrity"
    ["Unwind_1809050d0"]="InitializeSystemResourceIntegrityCheck"
    ["Unwind_1809050e0"]="ExecuteSystemResourceIntegrityValidation"
    ["Unwind_1809050f0"]="CleanupSystemResourceValidation"
    ["Unwind_180905100"]="InitializeSystemResourceValidationContext"
    ["Unwind_180905110"]="ExecuteSystemResourceCleanupWithOptions"
    ["Unwind_180905120"]="ExecuteSystemResourceValidationWithOptions"
    ["Unwind_180905130"]="FinalizeSystemResourceCleanup"
    ["Unwind_180905140"]="InitializeSystemResourceFinalization"
    ["Unwind_180905150"]="ExecuteSystemResourceFinalization"
    
    # 资源清理相关函数
    ["Unwind_180905160"]="CleanupResourceHandlersAtOffset0x168"
    ["Unwind_180905170"]="CleanupResourceHandlersAtOffset0x178"
    ["Unwind_180905180"]="CleanupResourceHandlersAtOffset0x198"
    ["Unwind_180905190"]="CleanupResourceHandlersAtOffset0x1a8"
    ["Unwind_1809051a0"]="CleanupResourceHandlersAtOffset0x1b8"
    ["Unwind_1809051d0"]="CleanupResourceHandlersAtOffset0x1e8"
    ["Unwind_1809051e0"]="CleanupResourceHandlersAtOffset0x1f8"
    ["Unwind_1809051f0"]="CleanupResourceHandlersAtOffset0x208"
    ["Unwind_180905200"]="CleanupResourceHandlersAtOffset0x218"
    ["Unwind_180905210"]="CleanupResourceHandlersAtOffset0x228"
    ["Unwind_180905220"]="CleanupResourceHandlersAtOffset0x238"
    ["Unwind_180905230"]="CleanupResourceHandlersAtOffset0x248"
    ["Unwind_180905240"]="CleanupResourceHandlersAtOffset0x258"
    ["Unwind_180905250"]="CleanupResourceHandlersAtOffset0x268"
    ["Unwind_180905260"]="CleanupResourceHandlersAtOffset0x278"
    ["Unwind_180905270"]="CleanupResourceHandlersAtOffset0x288"
    ["Unwind_180905280"]="CleanupResourceHandlersAtOffset0x298"
    ["Unwind_180905290"]="CleanupResourceHandlersAtOffset0x2a8"
    ["Unwind_1809052a0"]="CleanupResourceHandlersAtOffset0x2b8"
    ["Unwind_1809052b0"]="CleanupResourceHandlersAtOffset0x2c8"
    ["Unwind_1809052c0"]="CleanupResourceHandlersAtOffset0x2d8"
    
    # 上下文清理相关函数
    ["Unwind_180905c60"]="CleanupContextAtOffset0x340"
    ["Unwind_180905c80"]="CleanupContextAtOffset0x10"
    ["Unwind_180905c90"]="CleanupContextAtOffset0x18"
    ["Unwind_180905e40"]="CleanupContextAtOffset0x38"
    ["Unwind_180905e50"]="CleanupContextAtOffset0x48"
    ["Unwind_180905e70"]="CleanupContextAtOffset0x58"
    ["Unwind_180905e90"]="CleanupContextAtOffset0x68"
    ["Unwind_180905ea0"]="CleanupContextAtOffset0x78"
    ["Unwind_180905ec0"]="CleanupContextAtOffset0x88"
    ["Unwind_180905ee0"]="CleanupContextAtOffset0x98"
    ["Unwind_180905ef0"]="CleanupContextAtOffset0xa8"
    
    # 同步对象销毁相关函数
    ["Unwind_180905f00"]="DestroyConditionVariableGlobal"
    ["Unwind_180905f20"]="DestroyMutexGlobalPrimary"
    ["Unwind_180905f40"]="DestroyMutexGlobalSecondary"
    ["Unwind_180905f50"]="DestroyMutexAtOffset0x68"
    ["Unwind_180905f60"]="DestroyConditionVariableAtOffset0x68"
    ["Unwind_180905f70"]="CleanupResourceIndexAndStatus"
    ["Unwind_180905f80"]="ResetSystemStateAtOffset0xb8"
    ["Unwind_180905f90"]="ResetSystemStateAtOffset0xc8"
    ["Unwind_180905fa0"]="ResetSystemStateAtOffset0xd8"
    ["Unwind_180905fc0"]="ResetSystemStateAtOffset0xe8"
    ["Unwind_180905fe0"]="ResetSystemStateAtOffset0xf8"
    ["Unwind_180905ff0"]="DestroyConditionVariableGlobalSecondary"
    
    # 资源验证相关函数
    ["Unwind_180906180"]="ValidateResourceAtOffset0x108"
    ["Unwind_180906190"]="ValidateResourceAtOffset0x118"
    ["Unwind_1809061a0"]="ValidateResourceAtOffset0x128"
    ["Unwind_1809061b0"]="ValidateResourceAtOffset0x138"
    ["Unwind_1809061c0"]="ValidateResourceAtOffset0x148"
    ["Unwind_1809061d0"]="ValidateResourceAtOffset0x158"
    ["Unwind_1809061f0"]="ValidateResourceAtOffset0x178"
    
    # 内存管理相关函数
    ["Unwind_1809062c0"]="FreeMemoryAtOffset0x1c8"
    ["Unwind_1809062f0"]="FreeMemoryAtOffset0x1f8"
    ["Unwind_180906320"]="FreeMemoryAtOffset0x228"
    ["Unwind_180906350"]="FreeMemoryAtOffset0x258"
    ["Unwind_180906360"]="FreeMemoryAtOffset0x268"
    ["Unwind_180906390"]="FreeMemoryAtOffset0x298"
    ["Unwind_1809063c0"]="FreeMemoryAtOffset0x2c8"
    ["Unwind_1809063f0"]="FreeMemoryAtOffset0x2f8"
    
    # 句柄清理相关函数
    ["Unwind_180906400"]="CleanupHandleAtOffset0x308"
    ["Unwind_180906470"]="CleanupHandleAtOffset0x378"
    ["Unwind_180906480"]="CleanupHandleAtOffset0x388"
    ["Unwind_180906490"]="CleanupHandleAtOffset0x398"
    ["Unwind_1809064a0"]="CleanupHandleAtOffset0x3a8"
    ["Unwind_1809064b0"]="CleanupHandleAtOffset0x3b8"
    ["Unwind_1809064c0"]="CleanupHandleAtOffset0x3c8"
    ["Unwind_1809064d0"]="CleanupHandleAtOffset0x3d8"
    ["Unwind_1809064e0"]="CleanupHandleAtOffset0x3e8"
    ["Unwind_1809064f0"]="CleanupHandleAtOffset0x3f8"
    ["Unwind_180906500"]="CleanupHandleAtOffset0x408"
    ["Unwind_180906510"]="CleanupHandleAtOffset0x418"
    ["Unwind_180906520"]="CleanupHandleAtOffset0x428"
    ["Unwind_180906530"]="CleanupHandleAtOffset0x438"
    ["Unwind_180906540"]="CleanupHandleAtOffset0x448"
    ["Unwind_180906550"]="CleanupHandleAtOffset0x458"
    ["Unwind_180906560"]="CleanupHandleAtOffset0x468"
    ["Unwind_180906570"]="CleanupHandleAtOffset0x478"
    ["Unwind_180906580"]="CleanupHandleAtOffset0x488"
    ["Unwind_180906590"]="CleanupHandleAtOffset0x498"
    ["Unwind_1809065a0"]="CleanupHandleAtOffset0x4a8"
    ["Unwind_1809065b0"]="CleanupHandleAtOffset0x4b8"
    
    # 全局清理函数
    ["Unwind_1809065c0"]="GlobalCleanupFunction1"
    ["Unwind_1809065d0"]="GlobalCleanupFunction2"
    ["Unwind_1809065e0"]="GlobalCleanupAtOffset0x4c8"
    ["Unwind_1809065f0"]="GlobalCleanupAtOffset0x4d8"
    ["Unwind_180906600"]="GlobalCleanupAtOffset0x4e8"
    ["Unwind_180906630"]="GlobalCleanupAtOffset0x518"
    ["Unwind_180906640"]="GlobalCleanupAtOffset0x528"
    ["Unwind_180906660"]="GlobalCleanupAtOffset0x548"
    ["Unwind_180906680"]="GlobalCleanupAtOffset0x568"
    ["Unwind_1809066a0"]="GlobalCleanupAtOffset0x588"
    ["Unwind_1809066c0"]="GlobalCleanupAtOffset0x5a8"
    ["Unwind_1809066e0"]="GlobalCleanupAtOffset0x5c8"
    
    # 系统重置相关函数
    ["Unwind_180906810"]="ResetSystemAtOffset0x608"
    ["Unwind_180906830"]="ResetSystemAtOffset0x628"
    ["Unwind_180906850"]="ResetSystemAtOffset0x648"
    ["Unwind_180906870"]="ResetSystemAtOffset0x668"
    ["Unwind_180906890"]="ResetSystemAtOffset0x688"
    
    # 上下文验证相关函数
    ["Unwind_180906960"]="ValidateContextAtOffset0x6c8"
    ["Unwind_180906970"]="ValidateContextAtOffset0x6d8"
    ["Unwind_180906980"]="ValidateContextAtOffset0x6e8"
    ["Unwind_180906990"]="ValidateContextAtOffset0x6f8"
    ["Unwind_1809069a0"]="ValidateContextAtOffset0x708"
    ["Unwind_1809069b0"]="ValidateContextAtOffset0x718"
    ["Unwind_1809069c0"]="ValidateContextAtOffset0x728"
    
    # 资源释放相关函数
    ["Unwind_180906a00"]="ReleaseResourceAtOffset0x738"
    ["Unwind_180906a10"]="ReleaseResourceAtOffset0x748"
    ["Unwind_180906a20"]="ReleaseResourceAtOffset0x758"
    ["Unwind_180906a30"]="ReleaseResourceAtOffset0x768"
    ["Unwind_180906a40"]="ReleaseResourceAtOffset0x778"
    ["Unwind_180906a50"]="ReleaseResourceAtOffset0x788"
    ["Unwind_180906a60"]="ReleaseResourceAtOffset0x798"
    ["Unwind_180906a70"]="ReleaseResourceAtOffset0x7a8"
    ["Unwind_180906a80"]="ReleaseResourceAtOffset0x7b8"
    ["Unwind_180906a90"]="ReleaseResourceAtOffset0x7c8"
    ["Unwind_180906ac0"]="ReleaseResourceAtOffset0x7f8"
    ["Unwind_180906ad0"]="ReleaseResourceAtOffset0x808"
    ["Unwind_180906ae0"]="ReleaseResourceAtOffset0x818"
    ["Unwind_180906af0"]="ReleaseResourceAtOffset0x828"
    
    # 缓存清理相关函数
    ["Unwind_180906b20"]="CleanupCacheAtOffset0x858"
    ["Unwind_180906b30"]="CleanupCacheAtOffset0x868"
    ["Unwind_180906b40"]="CleanupCacheAtOffset0x878"
    ["Unwind_180906b50"]="CleanupCacheAtOffset0x888"
    ["Unwind_180906b60"]="CleanupCacheAtOffset0x898"
    ["Unwind_180906b70"]="CleanupCacheAtOffset0x8a8"
    ["Unwind_180906ba0"]="CleanupCacheAtOffset0x8d8"
    ["Unwind_180906bb0"]="CleanupCacheAtOffset0x8e8"
    ["Unwind_180906bc0"]="CleanupCacheAtOffset0x908"
    ["Unwind_180906bd0"]="CleanupCacheAtOffset0x928"
    
    # 系统终止相关函数
    ["Unwind_180906c00"]="SystemTerminationHandler1"
    ["Unwind_180906c10"]="SystemTerminationHandler2"
    ["Unwind_180906c20"]="SystemTerminationAtOffset0x948"
    ["Unwind_180906c30"]="SystemTerminationAtOffset0x958"
    ["Unwind_180906c40"]="SystemTerminationAtOffset0x968"
    ["Unwind_180906c50"]="SystemTerminationAtOffset0x978"
    ["Unwind_180906c60"]="SystemTerminationAtOffset0x988"
    ["Unwind_180906c70"]="SystemTerminationAtOffset0x998"
    ["Unwind_180906c80"]="SystemTerminationAtOffset0x9a8"
    ["Unwind_180906c90"]="SystemTerminationAtOffset0x9c8"
    ["Unwind_180906ca0"]="SystemTerminationAtOffset0x9e8"
    
    # 数据清理相关函数
    ["Unwind_180906d10"]="CleanupDataAtOffset0xa08"
    ["Unwind_180906d20"]="CleanupDataAtOffset0xa18"
    ["Unwind_180906d30"]="CleanupDataAtOffset0xa28"
    ["Unwind_180906d40"]="CleanupDataAtOffset0xa38"
    ["Unwind_180906d50"]="CleanupDataAtOffset0xa48"
    ["Unwind_180906d60"]="CleanupDataAtOffset0xa58"
    ["Unwind_180906d70"]="CleanupDataAtOffset0xa68"
    ["Unwind_180906d80"]="CleanupDataAtOffset0xa78"
    ["Unwind_180906d90"]="CleanupDataAtOffset0xa88"
    ["Unwind_180906da0"]="CleanupDataAtOffset0xa98"
    ["Unwind_180906db0"]="CleanupDataAtOffset0xaa8"
    ["Unwind_180906dc0"]="CleanupDataAtOffset0xab8"
    ["Unwind_180906dd0"]="CleanupDataAtOffset0xac8"
    ["Unwind_180906de0"]="CleanupDataAtOffset0xad8"
    ["Unwind_180906df0"]="CleanupDataAtOffset0xae8"
    ["Unwind_180906e00"]="CleanupDataAtOffset0xaf8"
    ["Unwind_180906e10"]="CleanupDataAtOffset0xb08"
    ["Unwind_180906e20"]="CleanupDataAtOffset0xb18"
    ["Unwind_180906e30"]="CleanupDataAtOffset0xb28"
    ["Unwind_180906e40"]="CleanupDataAtOffset0xb38"
    
    # 最终清理相关函数
    ["Unwind_180906ec0"]="FinalCleanupAtOffset0xb98"
    ["Unwind_180906ed0"]="FinalCleanupAtOffset0xba8"
    ["Unwind_180906ee0"]="FinalCleanupAtOffset0xbb8"
    ["Unwind_180906ef0"]="FinalCleanupAtOffset0xbc8"
    ["Unwind_180906f00"]="FinalCleanupAtOffset0xbd8"
    ["Unwind_180906f10"]="FinalCleanupAtOffset0xbe8"
    ["Unwind_180906f20"]="FinalCleanupAtOffset0xbf8"
    ["Unwind_180906f30"]="FinalCleanupAtOffset0xc08"
    ["Unwind_180906f40"]="FinalCleanupAtOffset0xc18"
    ["Unwind_180906f50"]="FinalCleanupAtOffset0xc28"
    ["Unwind_180906f60"]="FinalCleanupAtOffset0xc38"
    ["Unwind_180906f70"]="FinalCleanupAtOffset0xc48"
    ["Unwind_180906f80"]="FinalCleanupAtOffset0xc58"
    ["Unwind_180906f90"]="FinalCleanupAtOffset0xc68"
    ["Unwind_180906fc0"]="FinalCleanupAtOffset0xc98"
    ["Unwind_180906ff0"]="FinalCleanupAtOffset0xcc8"
    
    # 系统重置最终函数
    ["Unwind_180907010"]="FinalSystemResetAtOffset0xcd8"
)

# 处理每个重命名
for old_name in "${!rename_mapping[@]}"; do
    new_name="${rename_mapping[$old_name]}"
    
    # 使用sed进行替换
    sed -i "s/void $old_name(/void $new_name(/g" "TaleWorlds.Native/src/06_utilities.c"
    sed -i "s/$old_name(/$new_name(/g" "TaleWorlds.Native/src/06_utilities.c"
    
    echo "重命名: $old_name -> $new_name"
done

echo "函数重命名完成"