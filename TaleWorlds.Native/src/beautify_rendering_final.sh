#!/bin/bash

# 渲染系统美化脚本
# 用于美化 03_rendering.c 文件

FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/03_rendering.c"

echo "开始美化渲染文件: $FILE"

# 1. 替换 undefined 类型为 void 类型（对于函数声明）
echo "1. 替换 undefined 类型为 void 类型..."
sed -i 's/\bundefined\s+\([A-Za-z_][A-Za-z0-9_]*\)\s*;/void \1;/g' "$FILE"

# 2. 替换 undefined 类型为 void* 类型（对于变量声明）
echo "2. 替换 undefined 类型为 void* 类型..."
sed -i 's/\bundefined\s+\([A-Za-z_][A-Za-z0-9_]*\)\s*[;=]/void* \1 /g' "$FILE"

# 3. 替换 FUN_180xxxxx 函数名为语义化名称
echo "3. 替换 FUN_180xxxxx 函数名..."
# 主要的渲染函数
sed -i 's/\bFUN_18043fe10\b/InitializeRenderContext/g' "$FILE"
sed -i 's/\bFUN_18043fe70\b/CreateRenderDevice/g' "$FILE"
sed -i 's/\bFUN_18043fef0\b/SetupRenderPipeline/g' "$FILE"
sed -i 's/\bFUN_18043ff20\b/ConfigureRenderState/g' "$FILE"
sed -i 's/\bFUN_1804401b0\b/CreateVertexBuffer/g' "$FILE"
sed -i 's/\bFUN_180440220\b/CreateIndexBuffer/g' "$FILE"
sed -i 's/\bFUN_180440280\b/CreateConstantBuffer/g' "$FILE"
sed -i 's/\bFUN_1804402e0\b/CreateShaderProgram/g' "$FILE"
sed -i 's/\bFUN_180440350\b/CreateTexture2D/g' "$FILE"
sed -i 's/\bFUN_1804403d0\b/CreateSamplerState/g' "$FILE"
sed -i 's/\bFUN_1804404b0\b/CreateRenderTarget/g' "$FILE"
sed -i 's/\bFUN_180440560\b/CreateDepthStencil/g' "$FILE"
sed -i 's/\bFUN_1804405e0\b/CreateRenderPass/g' "$FILE"
sed -i 's/\bFUN_180440660\b/InitializeShaderCompiler/g' "$FILE"
sed -i 's/\bFUN_180440750\b/CompileVertexShader/g' "$FILE"
sed -i 's/\bFUN_180440910\b/CompilePixelShader/g' "$FILE"
sed -i 's/\bFUN_180440aa0\b/CompileGeometryShader/g' "$FILE"
sed -i 's/\bFUN_180440cb0\b/LinkShaderProgram/g' "$FILE"
sed -i 's/\bFUN_180440d20\b/ValidateShaderProgram/g' "$FILE"
sed -i 's/\bFUN_180440d90\b/SetVertexBufferData/g' "$FILE"
sed -i 's/\bFUN_180440e00\b/SetIndexBufferData/g' "$FILE"
sed -i 's/\bFUN_180440e70\b/SetConstantBufferData/g' "$FILE"
sed -i 's/\bFUN_180440f30\b/SetTextureData/g' "$FILE"
sed -i 's/\bFUN_180441070\b/SetSamplerParameters/g' "$FILE"
sed -i 's/\bFUN_1804410a0\b/SetRenderTargetSize/g' "$FILE"
sed -i 's/\bFUN_180441110\b/SetDepthStencilFormat/g' "$FILE"
sed -i 's/\bFUN_180441180\b/BeginRenderPass/g' "$FILE"
sed -i 's/\bFUN_180441260\b/EndRenderPass/g' "$FILE"
sed -i 's/\bFUN_180441420\b/BindVertexBuffer/g' "$FILE"
sed -i 's/\bFUN_1804414d0\b/BindIndexBuffer/g' "$FILE"
sed -i 's/\bFUN_1804415d0\b/BindConstantBuffer/g' "$FILE"
sed -i 's/\bFUN_180441640\b/BindShaderProgram/g' "$FILE"
sed -i 's/\bFUN_180441730\b/BindTexture/g' "$FILE"
sed -i 's/\bFUN_1804417b0\b/BindSampler/g' "$FILE"
sed -i 's/\bFUN_180441830\b/BindRenderTarget/g' "$FILE"
sed -i 's/\bFUN_180441890\b/BindDepthStencil/g' "$FILE"
sed -i 's/\bFUN_1804418e0\b/SetViewport/g' "$FILE"
sed -i 's/\bFUN_180441910\b/SetScissorRect/g' "$FILE"
sed -i 's/\bFUN_180441950\b/SetRasterizerState/g' "$FILE"
sed -i 's/\bFUN_180441a00\b/SetDepthStencilState/g' "$FILE"
sed -i 's/\bFUN_180441c50\b/SetBlendState/g' "$FILE"
sed -i 's/\bFUN_180441cc0\b/DrawPrimitive/g' "$FILE"
sed -i 's/\bFUN_180441dd0\b/DrawIndexedPrimitive/g' "$FILE"
sed -i 's/\bFUN_180441e10\b/DrawInstancedPrimitive/g' "$FILE"
sed -i 's/\bFUN_180441e50\b/DrawInstancedIndexedPrimitive/g' "$FILE"
sed -i 's/\bFUN_180441e90\b/DispatchComputeShader/g' "$FILE"
sed -i 's/\bFUN_180441f60\b/CopyTextureRegion/g' "$FILE"
sed -i 's/\bFUN_180441fc0\b/CopyResource/g' "$FILE"
sed -i 's/\bFUN_180442020\b/ResolveMultisampleTexture/g' "$FILE"
sed -i 's/\bFUN_1804420c0\b/GenerateMipmaps/g' "$FILE"
sed -i 's/\bFUN_180442180\b/MapBuffer/g' "$FILE"
sed -i 's/\bFUN_1804422a0\b/UnmapBuffer/g' "$FILE"
sed -i 's/\bFUN_180442370\b/UpdateSubresource/g' "$FILE"
sed -i 's/\bFUN_180442450\b/CopySubresourceRegion/g' "$FILE"
sed -i 's/\bFUN_1804424d0\b/ClearRenderTarget/g' "$FILE"
sed -i 's/\bFUN_180442560\b/ClearDepthStencil/g' "$FILE"
sed -i 's/\bFUN_180442670\b/ClearUnorderedAccessView/g' "$FILE"
sed -i 's/\bFUN_180442720\b/SetResourceBarrier/g' "$FILE"
sed -i 's/\bFUN_180442860\b/ExecuteCommandList/g' "$FILE"
sed -i 's/\bFUN_180442950\b/PresentFrame/g' "$FILE"
sed -i 's/\bFUN_1804429f0\b/WaitForGPU/g' "$FILE"
sed -i 's/\bFUN_180442b30\b/FlushCommandQueue/g' "$FILE"
sed -i 's/\bFUN_180442d10\b/CreateQuery/g' "$FILE"
sed -i 's/\bFUN_180442e00\b/BeginQuery/g' "$FILE"
sed -i 's/\bFUN_180443000\b/EndQuery/g' "$FILE"
sed -i 's/\bFUN_180443080\b/GetQueryData/g' "$FILE"
sed -i 's/\bFUN_1804431c0\b/CreatePredicate/g' "$FILE"
sed -i 's/\bFUN_180443320\b/SetMarker/g' "$FILE"
sed -i 's/\bFUN_180443510\b/BeginEvent/g' "$FILE"
sed -i 's/\bFUN_180443630\b/EndEvent/g' "$FILE"
sed -i 's/\bFUN_180443680\b/SetPipelineState/g' "$FILE"
sed -i 's/\bFUN_180443700\b/SetGraphicsRootSignature/g' "$FILE"
sed -i 's/\bFUN_180443770\b/SetComputeRootSignature/g' "$FILE"
sed -i 's/\bFUN_180443820\b/SetGraphicsRootDescriptorTable/g' "$FILE"
sed -i 's/\bFUN_180443930\b/SetComputeRootDescriptorTable/g' "$FILE"
sed -i 's/\bFUN_180443a40\b/SetGraphicsRootConstantBufferView/g' "$FILE"
sed -i 's/\bFUN_180443aa0\b/SetComputeRootConstantBufferView/g' "$FILE"
sed -i 's/\bFUN_180443b00\b/SetGraphicsRootShaderResourceView/g' "$FILE"
sed -i 's/\bFUN_180443b40\b/SetComputeRootShaderResourceView/g' "$FILE"
sed -i 's/\bFUN_180443b80\b/SetGraphicsRootUnorderedAccessView/g' "$FILE"
sed -i 's/\bFUN_180443d10\b/SetComputeRootUnorderedAccessView/g' "$FILE"
sed -i 's/\bFUN_180443d70\b/SetGraphicsRoot32BitConstant/g' "$FILE"
sed -i 's/\bFUN_180443df0\b/SetComputeRoot32BitConstant/g' "$FILE"
sed -i 's/\bFUN_180443f80\b/SetGraphicsRoot32BitConstants/g' "$FILE"
sed -i 's/\bFUN_180443ff0\b/SetComputeRoot32BitConstants/g' "$FILE"
sed -i 's/\bFUN_180444030\b/SetGraphicsRootDescriptorTable/g' "$FILE"
sed -i 's/\bFUN_180444070\b/SetComputeRootDescriptorTable/g' "$FILE"
sed -i 's/\bFUN_180444100\b/IASetPrimitiveTopology/g' "$FILE"
sed -i 's/\bFUN_180444200\b/IASetVertexBuffers/g' "$FILE"
sed -i 's/\bFUN_180444280\b/IASetIndexBuffer/g' "$FILE"
sed -i 's/\bFUN_1804442c0\b/VSSetShaderResources/g' "$FILE"
sed -i 's/\bFUN_1804442e0\b/VSSetSamplers/g' "$FILE"
sed -i 's/\bFUN_180444370\b/VSSetConstantBuffers/g' "$FILE"
sed -i 's/\bFUN_1804443c0\b/PSSetShaderResources/g' "$FILE"
sed -i 's/\bFUN_180444410\b/PSSetSamplers/g' "$FILE"
sed -i 's/\bFUN_1804445b0\b/PSSetConstantBuffers/g' "$FILE"
sed -i 's/\bFUN_180444600\b/GSSetShaderResources/g' "$FILE"
sed -i 's/\bFUN_180444700\b/GSSetSamplers/g' "$FILE"
sed -i 's/\bFUN_1804447c0\b/GSSetConstantBuffers/g' "$FILE"
sed -i 's/\bFUN_1804448a0\b/CSSetShaderResources/g' "$FILE"
sed -i 's/\bFUN_1804449a0\b/CSSetSamplers/g' "$FILE"
sed -i 's/\bFUN_180444a20\b/CSSetConstantBuffers/g' "$FILE"
sed -i 's/\bFUN_180444b70\b/OMSetRenderTargets/g' "$FILE"
sed -i 's/\bFUN_180444dd0\b/OMSetDepthStencilState/g' "$FILE"
sed -i 's/\bFUN_180444e90\b/OMSetBlendState/g' "$FILE"
sed -i 's/\bFUN_180445060\b/RSSetViewports/g' "$FILE"
sed -i 's/\bFUN_180445110\b/RSSetScissorRects/g' "$FILE"
sed -i 's/\bFUN_180445180\b/SOSetTargets/g' "$FILE"
sed -i 's/\bFUN_180445390\b/Draw/g' "$FILE"
sed -i 's/\bFUN_180445480\b/DrawIndexed/g' "$FILE"
sed -i 's/\bFUN_180445570\b/DrawInstanced/g' "$FILE"
sed -i 's/\bFUN_180445680\b/DrawIndexedInstanced/g' "$FILE"
sed -i 's/\bFUN_1804457b0\b/DrawAuto/g' "$FILE"
sed -i 's/\bFUN_180445870\b/DrawIndexedInstancedIndirect/g' "$FILE"
sed -i 's/\bFUN_180445970\b/Dispatch/g' "$FILE"
sed -i 's/\bFUN_180445a80\b/DispatchIndirect/g' "$FILE"
sed -i 's/\bFUN_180445cd0\b/CopyBufferRegion/g' "$FILE"
sed -i 's/\bFUN_180445dc0\b/CopyTextureRegion/g' "$FILE"
sed -i 's/\bFUN_180445eb0\b/CopyResource/g' "$FILE"
sed -i 's/\bFUN_180445fd0\b/ResolveSubresource/g' "$FILE"
sed -i 's/\bFUN_180446010\b/GenerateMips/g' "$FILE"
sed -i 's/\bFUN_180446080\b/UpdateSubresource/g' "$FILE"
sed -i 's/\bFUN_1804460c0\b/UpdateTileMappings/g' "$FILE"
sed -i 's/\bFUN_1804460f0\b/CopyTileMappings/g' "$FILE"
sed -i 's/\bFUN_180446120\b/CopyTiles/g' "$FILE"
sed -i 's/\bFUN_180446160\b/UpdateTiles/g' "$FILE"
sed -i 's/\bFUN_1804461b0\b/TiledResourceBarrier/g' "$FILE"
sed -i 's/\bFUN_1804462a0\b/ResizeBuffers/g' "$FILE"
sed -i 's/\bFUN_1804462e0\b/ResizeTarget/g' "$FILE"
sed -i 's/\bFUN_180446320\b/SetFullscreenState/g' "$FILE"
sed -i 's/\bFUN_180446370\b/GetFullscreenState/g' "$FILE"

# 4. 替换 UNK_180xxxxx 变量名为语义化名称
echo "4. 替换 UNK_180xxxxx 变量名..."
# 主要的渲染变量
sed -i 's/\bUNK_180444460\b/ConstantBufferCreationFlags/g' "$FILE"
sed -i 's/\bUNK_180444470\b/PipelineStateInitializationFlags/g' "$FILE"
sed -i 's/\bUNK_180444480\b/PipelineParameterConfiguration/g' "$FILE"
sed -i 's/\bUNK_1804445a0\b/BufferSetupConfiguration/g' "$FILE"
sed -i 's/\bUNK_1804449d0\b/ShaderInitializationParameters/g' "$FILE"
sed -i 's/\bUNK_1804449f0\b/TextureConfigurationParameters/g' "$FILE"
sed -i 's/\bUNK_180444a00\b/OutputConfigurationParameters/g' "$FILE"
sed -i 's/\bUNK_180444d60\b/PipelineCacheConfiguration/g' "$FILE"
sed -i 's/\bUNK_180444f20\b/BlendingConfigurationParameters/g' "$FILE"
sed -i 's/\bUNK_180444f60\b/RasterizationInitializationFlags/g' "$FILE"
sed -i 's/\bUNK_180444fb0\b/RasterizationCullMode/g' "$FILE"
sed -i 's/\bUNK_180444fd0\b/RasterizationFillMode/g' "$FILE"
sed -i 's/\bUNK_180445020\b/DepthTestConfiguration/g' "$FILE"
sed -i 's/\bUNK_1804450e0\b/PipelineStateConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445140\b/VertexShaderConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445160\b/PixelShaderConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445230\b/GeometryShaderConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445280\b/RenderTargetConfiguration/g' "$FILE"
sed -i 's/\bUNK_1804452d0\b/ShaderCompilerSettings/g' "$FILE"
sed -i 's/\bUNK_1804452f0\b/SamplerConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445310\b/DepthTestParameters/g' "$FILE"
sed -i 's/\bUNK_180445330\b/StencilBufferConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445340\b/BlendModeConfiguration/g' "$FILE"
sed -i 's/\bUNK_180445350\b/RasterizerStateParameters/g' "$FILE"
sed -i 's/\bUNK_180445360\b/RasterizerDepthBias/g' "$FILE"
sed -i 's/\bUNK_180445370\b/RasterizerSlopeScaledDepthBias/g' "$FILE"
sed -i 's/\bUNK_180445470\b/RasterizerDepthBiasClamp/g' "$FILE"
sed -i 's/\bUNK_1804454d0\b/RasterizerMultisampleEnable/g' "$FILE"
sed -i 's/\bUNK_180445550\b/MaterialPropertyConfiguration/g' "$FILE"
sed -i 's/\bUNK_1804455b0\b/MaterialCacheInitialization/g' "$FILE"
sed -i 's/\bUNK_1804455c0\b/TextureDataProcessor/g' "$FILE"
sed -i 's/\bUNK_1804455d0\b/TextureSamplerSetup/g' "$FILE"
sed -i 's/\bUNK_1804455e0\b/TextureViewManager/g' "$FILE"
sed -i 's/\bUNK_1804455f0\b/TextureMipmapGenerator/g' "$FILE"
sed -i 's/\bUNK_180445600\b/TextureViewCreator/g' "$FILE"
sed -i 's/\bUNK_180445790\b/MipmapUpdateProcessor/g' "$FILE"
sed -i 's/\bUNK_1804457a0\b/TextureShaderBinder/g' "$FILE"
sed -i 's/\bUNK_180445960\b/TextureFilterManager/g' "$FILE"
sed -i 's/\bUNK_180445fa0\b/TextureAddressManager/g' "$FILE"
sed -i 's/\bUNK_180445fb0\b/MipmapGenerator/g' "$FILE"
sed -i 's/\bUNK_180445fc0\b/TextureCompressor/g' "$FILE"
sed -i 's/\bUNK_180445ff0\b/TextureDecompressor/g' "$FILE"
sed -i 's/\bUNK_180446000\b/TextureFormatConverter/g' "$FILE"
sed -i 's/\bUNK_180446070\b/BufferInstanceCreator/g' "$FILE"
sed -i 's/\bUNK_1804460b0\b/FormatCompatibilityValidator/g' "$FILE"
sed -i 's/\bUNK_1804461a0\b/ResourceReferenceManager/g' "$FILE"
sed -i 's/\bUNK_180446280\b/RenderingContextInitializer/g' "$FILE"
sed -i 's/\bUNK_180446290\b/ViewportSetupManager/g' "$FILE"
sed -i 's/\bUNK_180446530\b/ScissorConfiguration/g' "$FILE"
sed -i 's/\bUNK_180446560\b/SwapChainCreator/g' "$FILE"
sed -i 's/\bUNK_1804465b0\b/DeviceMemoryManager/g' "$FILE"
sed -i 's/\bUNK_180446600\b/DeviceCommandQueue/g' "$FILE"
sed -i 's/\bUNK_180446900\b/DeviceFence/g' "$FILE"
sed -i 's/\bUNK_180446950\b/DeviceStateInitializer/g' "$FILE"
sed -i 's/\bUNK_1804469d0\b/DeviceContextManager/g' "$FILE"
sed -i 's/\bUNK_1804469e0\b/DeviceAdapterInfo/g' "$FILE"

# 5. 替换 DAT_180xxxxx 变量名（如果有）
echo "5. 替换 DAT_180xxxxx 变量名..."
# 这里假设 DAT_ 开头的变量与 UNK_ 开头的变量使用相同的映射
sed -i 's/\bDAT_180444460\b/ConstantBufferCreationFlags/g' "$FILE"
sed -i 's/\bDAT_180444470\b/PipelineStateInitializationFlags/g' "$FILE"
sed -i 's/\bDAT_180444480\b/PipelineParameterConfiguration/g' "$FILE"
sed -i 's/\bDAT_1804445a0\b/BufferSetupConfiguration/g' "$FILE"
sed -i 's/\bDAT_1804449d0\b/ShaderInitializationParameters/g' "$FILE"
sed -i 's/\bDAT_1804449f0\b/TextureConfigurationParameters/g' "$FILE"
sed -i 's/\bDAT_180444a00\b/OutputConfigurationParameters/g' "$FILE"
sed -i 's/\bDAT_180444d60\b/PipelineCacheConfiguration/g' "$FILE"
sed -i 's/\bDAT_180444f20\b/BlendingConfigurationParameters/g' "$FILE"
sed -i 's/\bDAT_180444f60\b/RasterizationInitializationFlags/g' "$FILE"
sed -i 's/\bDAT_180444fb0\b/RasterizationCullMode/g' "$FILE"
sed -i 's/\bDAT_180444fd0\b/RasterizationFillMode/g' "$FILE"
sed -i 's/\bDAT_180445020\b/DepthTestConfiguration/g' "$FILE"
sed -i 's/\bDAT_1804450e0\b/PipelineStateConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445140\b/VertexShaderConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445160\b/PixelShaderConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445230\b/GeometryShaderConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445280\b/RenderTargetConfiguration/g' "$FILE"
sed -i 's/\bDAT_1804452d0\b/ShaderCompilerSettings/g' "$FILE"
sed -i 's/\bDAT_1804452f0\b/SamplerConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445310\b/DepthTestParameters/g' "$FILE"
sed -i 's/\bDAT_180445330\b/StencilBufferConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445340\b/BlendModeConfiguration/g' "$FILE"
sed -i 's/\bDAT_180445350\b/RasterizerStateParameters/g' "$FILE"
sed -i 's/\bDAT_180445360\b/RasterizerDepthBias/g' "$FILE"
sed -i 's/\bDAT_180445370\b/RasterizerSlopeScaledDepthBias/g' "$FILE"
sed -i 's/\bDAT_180445470\b/RasterizerDepthBiasClamp/g' "$FILE"
sed -i 's/\bDAT_1804454d0\b/RasterizerMultisampleEnable/g' "$FILE"
sed -i 's/\bDAT_180445550\b/MaterialPropertyConfiguration/g' "$FILE"
sed -i 's/\bDAT_1804455b0\b/MaterialCacheInitialization/g' "$FILE"
sed -i 's/\bDAT_1804455c0\b/TextureDataProcessor/g' "$FILE"
sed -i 's/\bDAT_1804455d0\b/TextureSamplerSetup/g' "$FILE"
sed -i 's/\bDAT_1804455e0\b/TextureViewManager/g' "$FILE"
sed -i 's/\bDAT_1804455f0\b/TextureMipmapGenerator/g' "$FILE"
sed -i 's/\bDAT_180445600\b/TextureViewCreator/g' "$FILE"
sed -i 's/\bDAT_180445790\b/MipmapUpdateProcessor/g' "$FILE"
sed -i 's/\bDAT_1804457a0\b/TextureShaderBinder/g' "$FILE"
sed -i 's/\bDAT_180445960\b/TextureFilterManager/g' "$FILE"
sed -i 's/\bDAT_180445fa0\b/TextureAddressManager/g' "$FILE"
sed -i 's/\bDAT_180445fb0\b/MipmapGenerator/g' "$FILE"
sed -i 's/\bDAT_180445fc0\b/TextureCompressor/g' "$FILE"
sed -i 's/\bDAT_180445ff0\b/TextureDecompressor/g' "$FILE"
sed -i 's/\bDAT_180446000\b/TextureFormatConverter/g' "$FILE"
sed -i 's/\bDAT_180446070\b/BufferInstanceCreator/g' "$FILE"
sed -i 's/\bDAT_1804460b0\b/FormatCompatibilityValidator/g' "$FILE"
sed -i 's/\bDAT_1804461a0\b/ResourceReferenceManager/g' "$FILE"
sed -i 's/\bDAT_180446280\b/RenderingContextInitializer/g' "$FILE"
sed -i 's/\bDAT_180446290\b/ViewportSetupManager/g' "$FILE"
sed -i 's/\bDAT_180446530\b/ScissorConfiguration/g' "$FILE"
sed -i 's/\bDAT_180446560\b/SwapChainCreator/g' "$FILE"
sed -i 's/\bDAT_1804465b0\b/DeviceMemoryManager/g' "$FILE"
sed -i 's/\bDAT_180446600\b/DeviceCommandQueue/g' "$FILE"
sed -i 's/\bDAT_180446900\b/DeviceFence/g' "$FILE"
sed -i 's/\bDAT_180446950\b/DeviceStateInitializer/g' "$FILE"
sed -i 's/\bDAT_1804469d0\b/DeviceContextManager/g' "$FILE"
sed -i 's/\bDAT_1804469e0\b/DeviceAdapterInfo/g' "$FILE"

echo "文件美化完成！"
echo "请检查文件: $FILE"