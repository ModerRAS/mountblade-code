#!/bin/bash

# 初始化系统函数重命名脚本
# 用于将01_initialization.c中的FUN_函数重命名为语义化名称

cd /dev/shm/mountblade-code/TaleWorlds.Native/src

# 备份原文件
cp 01_initialization.c 01_initialization.c.backup.$(date +%s)

# 定义函数重命名映射
declare -A function_rename_map=(
    # 系统初始化相关函数
    ["FUN_18003abb0"]="InitializeSystemCore"
    ["FUN_18003e610"]="InitializeSystemMemory"
    ["FUN_18003e710"]="InitializeSystemDataTables"
    ["FUN_18003e810"]="InitializeSystemConfiguration"
    ["FUN_1800423d0"]="InitializeSystemSyncMechanism"
    ["FUN_180044dc0"]="ConfigureSystemParameters"
    ["FUN_180045af0"]="SetupSystemComponents"
    ["FUN_180045b20"]="InitializeSystemServices"
    ["FUN_180045ba0"]="RegisterSystemCallbacks"
    ["FUN_180045bc1"]="FinalizeSystemInitialization"
    ["FUN_180045ea0"]="ProcessSystemSetup"
    ["FUN_180045ee0"]="ValidateSystemConfiguration"
    ["FUN_180045f60"]="InitializeSystemResources"
    ["FUN_180045f81"]="CompleteSystemSetup"
    ["FUN_180045fa6"]="VerifySystemIntegrity"
    ["FUN_180045fc0"]="SystemConfigurationValidator"
    
    # 系统管理函数
    ["FUN_180046130"]="SystemResourceManager"
    ["FUN_180046160"]="SystemMemoryManager"
    ["FUN_180046400"]="SystemTaskScheduler"
    ["FUN_1800464f0"]="SystemEventHandler"
    ["FUN_180046b10"]="SystemProcessManager"
    ["FUN_180046ca0"]="SystemController"
    ["FUN_180046e20"]="SystemDataProcessor"
    ["FUN_180047d40"]="SystemInterfaceHandler"
    ["FUN_180048a90"]="SystemCommunicationManager"
    ["FUN_180048c70"]="SystemProtocolHandler"
    ["FUN_180048cc0"]="SystemDataExchange"
    ["FUN_180049010"]="SystemMessageRouter"
    ["FUN_180049110"]="SystemEventDispatcher"
    ["FUN_1800491b0"]="SystemCommandProcessor"
    ["FUN_1800494f0"]="SystemStateMonitor"
    ["FUN_1800495d0"]="SystemStatusReporter"
    ["FUN_1800496b0"]="SystemHealthChecker"
    ["FUN_180049790"]="SystemMaintenanceRoutine"
    ["FUN_1800497b0"]="SystemCleanupProcedure"
    ["FUN_1800497d0"]="SystemOptimizationTask"
    ["FUN_1800497f0"]="SystemPerformanceMonitor"
    ["FUN_180049830"]="SystemResourceAllocator"
    ["FUN_1800498d0"]="SystemMemoryOptimizer"
    ["FUN_180049910"]="SystemLoadBalancer"
    ["FUN_180049931"]="SystemIdleHandler"
    ["FUN_180049956"]="SystemPowerManager"
    ["FUN_180049970"]="SystemConfigurationLoader"
    ["FUN_1800499c0"]="SystemProfileManager"
    ["FUN_180049b30"]="SystemRequestHandler"
    ["FUN_180049bb0"]="SystemResponseGenerator"
    ["FUN_180049bf0"]="SystemDataValidator"
    ["FUN_180049c70"]="SystemErrorRecovery"
    ["FUN_180049c8f"]="SystemResetHandler"
    ["FUN_180049cb4"]="SystemRestartManager"
    ["FUN_180049cd0"]="SystemConfigurationSaver"
    ["FUN_180049d20"]="SystemBackupManager"
    ["FUN_180049eb0"]="SystemRestoreHandler"
    ["FUN_180049f30"]="SystemShutdownSequence"
    ["FUN_180049fd0"]="SystemCleanupRoutine"
    ["FUN_18004a0b0"]="SystemFinalization"
    ["FUN_18004a0d0"]="SystemTermination"
    ["FUN_18004a100"]="SystemExitHandler"
    ["FUN_18004a130"]="SystemDestructor"
    ["FUN_18004a180"]="SystemMemoryRelease"
    ["FUN_18004a220"]="SystemResourceRelease"
    ["FUN_18004a360"]="SystemConnectionCloser"
    ["FUN_18004a3c0"]="SystemHandleManager"
    ["FUN_18004a400"]="SystemReferenceCounter"
    ["FUN_18004a430"]="SystemObjectPool"
    ["FUN_18004a470"]="SystemGarbageCollector"
    ["FUN_18004a4b0"]="SystemMemoryCompactor"
    ["FUN_18004a500"]="SystemStabilityChecker"
    ["FUN_18004a850"]="SystemDiagnosticsRunner"
    ["FUN_18004adc0"]="SystemHealthMonitor"
    ["FUN_18004afa0"]="SystemPerformanceAnalyzer"
    ["FUN_18004b100"]="SystemResourceMonitor"
    ["FUN_18004b1f0"]="SystemStatusQuery"
    ["FUN_18004b390"]="SystemAvailabilityChecker"
    ["FUN_18004b3f0"]="SystemInfoProvider"
    ["FUN_18004b560"]="SystemDataCollector"
    ["FUN_18004b5f0"]="SystemMetricsUpdater"
    ["FUN_18004b640"]="SystemStatisticsHandler"
    ["FUN_18004b710"]="SystemLoggingService"
    ["FUN_18004b730"]="SystemAuditTrail"
    ["FUN_18004b790"]="SystemEventLogger"
    ["FUN_18004b7a2"]="SystemLogWriter"
    ["FUN_18004b7de"]="SystemLogFlusher"
    ["FUN_18004b7e0"]="SystemLogBuffer"
    ["FUN_18004b820"]="SystemLogFormatter"
    ["FUN_18004b860"]="SystemLogProcessor"
    ["FUN_18004b920"]="SystemLogFilter"
    ["FUN_18004b960"]="SystemLogArchiver"
    ["FUN_18004b9b0"]="SystemLogAnalyzer"
    ["FUN_18004ba30"]="SystemTraceCollector"
    ["FUN_18004ba60"]="SystemTraceProcessor"
    ["FUN_18004ba90"]="SystemTraceFormatter"
    ["FUN_18004bad0"]="SystemTraceExporter"
    ["FUN_18004bb00"]="SystemTraceManager"
    ["FUN_18004bb30"]="SystemTraceCleaner"
    ["FUN_18004bb60"]="SystemTraceResetter"
)

# 执行函数重命名
for old_name in "${!function_rename_map[@]}"; do
    new_name="${function_rename_map[$old_name]}"
    echo "重命名函数: $old_name -> $new_name"
    sed -i "s/\b$old_name\b/$new_name/g" 01_initialization.c
done

echo "函数重命名完成"

# 定义变量重命名映射
declare -A variable_rename_map=(
    # 系统数据节点
    ["UNK_180a00430"]="SystemDataNodePrimary"
    ["UNK_1809fd0d8"]="SystemDataNodeSecondary"
    ["UNK_1809ff978"]="SystemDataNodeTertiary"
    ["UNK_1809ff990"]="SystemDataNodeQuaternary"
    ["UNK_180a00370"]="SystemDataNodeQuinary"
    ["UNK_180a00388"]="SystemDataNodeSenary"
    ["UNK_180a003a0"]="SystemDataNodeSeptenary"
    ["UNK_180a003b8"]="SystemDataNodeOctonary"
    ["UNK_180a003d0"]="SystemDataNodeNonary"
    ["UNK_1800868c0"]="SystemDataNodeDecary"
    ["UNK_180a003e8"]="SystemDataNodeUndenary"
    ["UNK_180a00400"]="SystemDataNodeDuodenary"
    ["UNK_180a00460"]="SystemDataNodeTridecary"
    ["UNK_180a004a8"]="SystemDataNodeQuattuordecary"
    ["UNK_180a004c0"]="SystemDataNodeQuindecary"
    
    # 系统节点指针
    ["UNK_18098c880"]="SystemNodeLinkPrimary"
    ["UNK_18098c898"]="SystemNodeLinkSecondary"
    ["UNK_18098c870"]="SystemRootNode"
    
    # 系统常量和配置
    ["UNK_180a24340"]="SystemStringTemplatePrimary"
    ["UNK_180a24828"]="SystemStringTemplateSecondary"
    ["UNK_1809fcc28"]="SystemConfigurationPointer"
    ["UNK_180a2ac10"]="SystemStringTemplateTertiary"
    ["UNK_180a2bf10"]="SystemStringTemplateQuaternary"
    ["UNK_18098bc80"]="SystemMemoryAllocator"
    ["UNK_180a2ca90"]="SystemLinkTargetPrimary"
    ["UNK_180a2cab0"]="SystemLinkTargetSecondary"
    ["UNK_180a33fb0"]="SystemStringTemplateQuinary"
    ["UNK_180a3c028"]="SystemStringTemplateSenary"
    ["UNK_180a3def0"]="SystemStringTemplateSeptenary"
    ["UNK_180a3e3d8"]="SystemStringTemplateOctonary"
    ["UNK_180a3e3f0"]="SystemStringTemplateNonary"
    ["UNK_180943250"]="SystemCallbackTargetPrimary"
    ["UNK_180943260"]="SystemCallbackTargetSecondary"
    ["UNK_18097e888"]="SystemVirtualTable"
    ["UNK_180943270"]="SystemLoopCounter"
    ["UNK_180943310"]="SystemCallbackTargetTertiary"
    ["UNK_180943320"]="SystemCallbackTargetQuaternary"
    ["UNK_1809fe100"]="SystemDefaultInterface"
    ["UNK_180a21690"]="SystemInterfacePrimary"
    ["UNK_180a21720"]="SystemInterfaceSecondary"
    ["UNK_18098bdc8"]="SystemInterfaceTertiary"
    ["UNK_18098bd40"]="SystemInterfaceQuaternary"
    ["UNK_18098bc48"]="SystemMemoryRegion"
    ["UNK_180a3c110"]="SystemResourcePointerPrimary"
    ["UNK_180a3c138"]="SystemResourcePointerSecondary"
    ["UNK_18098bab0"]="SystemStackPointerPrimary"
    ["UNK_18098bc80"]="SystemStackPointerSecondary"
    ["UNK_18098bac8"]="SystemStackPointerTertiary"
    ["UNK_180a3c428"]="SystemLibraryName"
    ["UNK_180a3c410"]="SystemFunctionName"
    ["UNK_18098bb60"]="SystemFunctionPointerPrimary"
    ["UNK_18098bb88"]="SystemFunctionPointerSecondary"
    ["UNK_180a3c090"]="SystemSemaphoreConfig"
    ["UNK_1809ff2f8"]="SystemManagerPointer"
    ["UNK_1809ff3f8"]="SystemControllerPointer"
    ["UNK_1809fee70"]="SystemHandlerPointer"
    ["UNK_1809fc7a0"]="SystemContextData"
    ["UNK_1809fcc58"]="SystemStringBuffer"
    ["UNK_1809fc7b8"]="SystemMessageTemplatePrimary"
    ["UNK_1809fc790"]="SystemMessageTemplateSecondary"
    ["UNK_1809fc8e8"]="SystemPropertyDescriptor"
    ["UNK_1809fc8f8"]="SystemPropertyConfigPrimary"
    ["UNK_1809fc918"]="SystemPropertyConfigSecondary"
    ["UNK_1809fc928"]="SystemPropertyConfigTertiary"
    ["UNK_1809fc940"]="SystemPropertyConfigQuaternary"
    ["UNK_1809fc958"]="SystemPropertyConfigQuinary"
    ["UNK_1809fc970"]="SystemPropertyConfigSenary"
    ["UNK_1809fc990"]="SystemConfigDescriptorPrimary"
    ["UNK_1809fc9b0"]="SystemConfigDescriptorSecondary"
    ["UNK_1809fc9d0"]="SystemConfigDescriptorTertiary"
    ["UNK_1809fc9f8"]="SystemConfigDescriptorQuaternary"
    ["UNK_1809fca20"]="SystemConfigDescriptorQuinary"
    ["UNK_1809fca48"]="SystemConfigDescriptorSenary"
    ["UNK_1809fca60"]="SystemConfigDescriptorSeptenary"
    ["UNK_1809fca88"]="SystemConfigDescriptorOctonary"
    ["UNK_1809caa8"]="SystemConfigDescriptorNonary"
    ["UNK_1809fcac8"]="SystemPropertyExtensionPrimary"
    ["UNK_1809fcad8"]="SystemPropertyExtensionSecondary"
    ["UNK_1809fca90"]="SystemConfigTerminator"
    ["UNK_1809fd0a0"]="SystemValidationTemplate"
    ["UNK_1809fd0a8"]="SystemValidationConfig"
    ["UNK_1809fd118"]="SystemMemoryConfig"
    ["UNK_1809fd130"]="SystemGlobalConfig"
    ["UNK_1809fd140"]="SystemDataConfig"
    ["UNK_180a08db0"]="SystemStringConfig"
    ["UNK_1809fd150"]="SystemComparisonString"
    ["UNK_1809fd4d8"]="SystemNetworkConfig"
    ["UNK_1809fdc18"]="SystemTimeString"
    ["UNK_180a04130"]="SystemTimeFormat"
    ["UNK_1809fe220"]="SystemResourceConfig"
    ["UNK_180a00350"]="SystemResourceHandlerPrimary"
    ["UNK_180a00340"]="SystemResourceHandlerSecondary"
    ["UNK_180a00420"]="SystemResourceHandlerTertiary"
    ["UNK_180a00450"]="SystemResourceHandlerQuaternary"
    ["UNK_180a00480"]="SystemResourceHandlerQuinary"
    ["UNK_180a00ac8"]="SystemResourceHandlerSenary"
    ["UNK_180a00368"]="SystemResourceHandlerSeptenary"
    ["UNK_180a00a00"]="SystemResourceHandlerOctonary"
    ["UNK_180a00490"]="SystemResourceHandlerNonary"
    ["UNK_180a01170"]="SystemResourceHandlerDecary"
    ["UNK_180a00c90"]="SystemResourceHandlerUndenary"
    ["UNK_180a00ab8"]="SystemResourceHandlerDuodenary"
    ["UNK_180a00c80"]="SystemResourceHandlerTridecary"
    ["UNK_1809fd534"]="SystemProcessString"
    ["UNK_1809fd550"]="SystemProcessConfig"
    ["UNK_180a21690"]="SystemMemoryRegionPrimary"
    ["UNK_180a21720"]="SystemMemoryRegionSecondary"
    ["UNK_18098bdc8"]="SystemMemoryRegionTertiary"
    ["UNK_180a08c60"]="SystemMemoryRegionQuaternary"
    ["UNK_180058f90"]="SystemFunctionPointerTertiary"
    ["UNK_180058f80"]="SystemFunctionPointerQuaternary"
    ["UNK_180058f60"]="SystemFunctionPointerQuinary"
    ["UNK_180058f50"]="SystemFunctionPointerSenary"
    ["UNK_1809fd730"]="SystemNetworkString"
    ["UNK_1809fde40"]="SystemNetworkBuffer"
    ["UNK_1809fd7c4"]="SystemNetworkProtocol"
    ["UNK_1809fd7d8"]="SystemNetworkKeywordPrimary"
    ["UNK_1809fd7f8"]="SystemNetworkKeywordSecondary"
    ["UNK_1809fd810"]="SystemNetworkKeywordTertiary"
    ["UNK_1809fd828"]="SystemNetworkKeywordQuaternary"
    ["UNK_1809fd848"]="SystemNetworkKeywordQuinary"
    ["UNK_1809fd870"]="SystemNetworkConfigTemplate"
    ["UNK_180a3cf50"]="SystemNetworkConfigPrimary"
    ["UNK_1809fe6d8"]="SystemNetworkConfigSecondary"
    ["UNK_1809fd9a0"]="SystemConfigParameterPrimary"
    ["UNK_1809fd9b0"]="SystemConfigParameterSecondary"
    ["UNK_1809fd9d0"]="SystemConfigParameterTertiary"
    ["UNK_1809fd9f0"]="SystemConfigParameterQuaternary"
    ["UNK_1809fda10"]="SystemConfigParameterQuinary"
    ["UNK_1809fda30"]="SystemConfigParameterSenary"
    ["UNK_1809fda58"]="SystemConfigParameterSeptenary"
    ["UNK_1809fda80"]="SystemConfigParameterOctonary"
    ["UNK_1809fdaa8"]="SystemConfigParameterNonary"
    ["UNK_1809fdad0"]="SystemConfigParameterDecary"
    ["UNK_1809fdaf8"]="SystemConfigParameterUndenary"
    ["UNK_1809fdb20"]="SystemConfigParameterDuodenary"
    ["UNK_1809fdcd8"]="SystemStatusPointer"
    ["UNK_1809fdb40"]="SystemStatusString"
    ["UNK_1809fe220"]="SystemStatusConfig"
    ["UNK_1809fdbd0"]="SystemStatusTemplate"
    ["UNK_180058ee0"]="SystemStatusFunctionPrimary"
    ["UNK_180058ec0"]="SystemStatusFunctionSecondary"
    ["UNK_180059b80"]="SystemStatusFunctionTertiary"
    ["UNK_1809fdd78"]="SystemErrorConfigPrimary"
    ["UNK_1809fddc8"]="SystemErrorConfigSecondary"
    ["UNK_180a02968"]="SystemErrorConfigTertiary"
    ["UNK_1809fde10"]="SystemErrorConfigQuaternary"
    ["UNK_1809fdea8"]="SystemWarningConfigPrimary"
    ["UNK_1809fdf38"]="SystemWarningConfigSecondary"
    ["UNK_1809fdfd0"]="SystemInfoConfigPrimary"
    ["UNK_1809fe050"]="SystemInfoFormatString"
    ["UNK_1809fe058"]="SystemInfoTemplate"
    ["UNK_1809fe100"]="SystemInfoInterface"
    ["UNK_1809fe188"]="SystemInfoTimeFormatPrimary"
    ["UNK_1809fe190"]="SystemInfoTimeFormatSecondary"
    ["UNK_1809fe290"]="SystemInfoBuffer"
    ["UNK_1809fe198"]="SystemInfoTimeFormatTertiary"
    ["UNK_1809fe258"]="SystemInfoBufferSecondary"
    ["UNK_1809fe220"]="SystemInfoConfig"
    ["UNK_1800467f0"]="SystemInfoFunctionPrimary"
    ["UNK_180049760"]="SystemInfoFunctionSecondary"
    ["UNK_1809fe210"]="SystemInfoPointerPrimary"
    ["UNK_1809fe200"]="SystemInfoPointerSecondary"
    ["UNK_1809fe1f0"]="SystemInfoPointerTertiary"
    ["UNK_180a10098"]="SystemInfoPointerQuaternary"
    ["UNK_180a3cf50"]="SystemInfoPointerQuinary"
    ["UNK_180a30778"]="SystemInfoPointerSenary"
    ["UNK_1809fe2c0"]="SystemDebugTimeFormat"
    ["UNK_1809fe5a0"]="SystemDebugConfigPrimary"
    ["UNK_1809fe5c0"]="SystemDebugConfigSecondary"
    ["UNK_1809fe5f0"]="SystemDebugConfigTertiary"
    ["UNK_1809fe62c"]="SystemDebugConfigQuaternary"
    ["UNK_1809fe608"]="SystemDebugMemoryRegion"
    ["UNK_1809fe650"]="SystemDebugInfoConfig"
    ["UNK_1809fe800"]="SystemDebugStringPrimary"
    ["UNK_1809fe85c"]="SystemDebugStringSecondary"
    ["UNK_1809fe868"]="SystemDebugStringTertiary"
    ["UNK_1809fe880"]="SystemDebugStringQuaternary"
    ["UNK_1809fe8b0"]="SystemDebugStringQuinary"
    ["UNK_1809fe898"]="SystemDebugStringSenary"
    ["UNK_1809fe62c"]="SystemDebugTemplate"
    ["UNK_1809fe900"]="SystemDebugStringSeptenary"
    ["UNK_1809fe910"]="SystemDebugNetworkStringPrimary"
    ["UNK_1809fe928"]="SystemDebugNetworkStringSecondary"
    ["UNK_1809fe940"]="SystemDebugNetworkTemplate"
    ["UNK_18098ba10"]="SystemDebugNetworkAddressPrimary"
    ["UNK_18098ba80"]="SystemDebugNetworkAddressSecondary"
    ["UNK_18098ba98"]="SystemDebugNetworkAddressTertiary"
    ["UNK_18098baa0"]="SystemDebugNetworkAddressQuaternary"
    ["UNK_18098ba40"]="SystemDebugNetworkAddressQuinary"
    ["UNK_18098ba70"]="SystemDebugNetworkAddressSenary"
    ["UNK_18098ba60"]="SystemDebugNetworkAddressSeptenary"
    ["UNK_1809fe950"]="SystemDebugNetworkAddressOctonary"
    ["UNK_1809fe968"]="SystemDebugNetworkAddressNonary"
    ["UNK_1809fe978"]="SystemDebugNetworkAddressDecary"
    ["UNK_1809fe988"]="SystemDebugNetworkAddressUndenary"
    ["UNK_1809fe998"]="SystemDebugNetworkAddressDuodenary"
    ["UNK_1809fe9a8"]="SystemDebugTimeFormatPrimary"
    ["UNK_1809fe9b8"]="SystemDebugTimeFormatSecondary"
    ["UNK_1809fe9c8"]="SystemDebugNetworkAddressTridecary"
    ["UNK_1809fe7f8"]="SystemDebugTemplateSecondary"
    ["UNK_1809fea68"]="SystemDebugStringOctonary"
    ["UNK_1809feaa0"]="SystemErrorMessagePrimary"
    ["UNK_1809feb24"]="SystemErrorMessageSecondary"
    ["UNK_180a04f08"]="SystemErrorButton"
    ["UNK_1809feb28"]="SystemErrorStringPrimary"
    ["UNK_1809feb58"]="SystemErrorStringSecondary"
    ["UNK_1809feb70"]="SystemErrorStringTertiary"
    ["UNK_1809feb88"]="SystemErrorStringQuaternary"
    ["UNK_1809feba8"]="SystemErrorStringQuinary"
    ["UNK_1809febc8"]="SystemErrorStringSenary"
    ["UNK_1809febc0"]="SystemErrorStringSeptenary"
    ["UNK_1809febd8"]="SystemErrorStringOctonary"
    ["UNK_1809febf0"]="SystemErrorStringNonary"
    ["UNK_1809fec28"]="SystemExceptionMessagePrimary"
    ["UNK_1809fec40"]="SystemExceptionMessageSecondary"
    ["UNK_180068e70"]="SystemExceptionFunctionPrimary"
    ["UNK_180068e60"]="SystemExceptionFunctionSecondary"
    ["UNK_1809fec50"]="SystemExceptionConfigPrimary"
    ["UNK_1809fec70"]="SystemExceptionConfigSecondary"
    ["UNK_1809ff4e0"]="SystemExceptionPointer"
    ["UNK_1809fecd8"]="SystemExceptionDataPrimary"
    ["UNK_1809fed10"]="SystemExceptionDataSecondary"
    ["UNK_1809fed78"]="SystemExceptionStringPrimary"
    ["UNK_1809fed40"]="SystemExceptionStringSecondary"
    ["UNK_1809feda8"]="SystemExceptionBuffer"
    ["UNK_1809feeb8"]="SystemMemoryExceptionPrimary"
    ["UNK_1809feec8"]="SystemMemoryExceptionSecondary"
    ["UNK_1809feed8"]="SystemMemoryExceptionTertiary"
    ["UNK_1809ff040"]="SystemMemoryExceptionQuaternary"
    ["UNK_180a0e170"]="SystemExceptionHandlerPrimary"
    ["UNK_180a0e368"]="SystemExceptionHandlerSecondary"
    ["UNK_1809fefb0"]="SystemExceptionConfigTertiary"
    ["UNK_1809ff498"]="SystemExceptionConfigQuaternary"
    ["UNK_1809ff390"]="SystemExceptionDataTertiary"
    ["UNK_1809ff3e8"]="SystemExceptionPointerPrimary"
    ["UNK_1809ff488"]="SystemExceptionPointerSecondary"
)

# 执行变量重命名
for old_name in "${!variable_rename_map[@]}"; do
    new_name="${variable_rename_map[$old_name]}"
    echo "重命名变量: $old_name -> $new_name"
    sed -i "s/\b$old_name\b/$new_name/g" 01_initialization.c
done

echo "变量重命名完成"

# 清理备份文件
echo "清理备份文件..."
rm -f 01_initialization.c.backup.*

echo "代码美化完成"