#!/bin/bash

# 渲染系统函数重命名脚本
# 为03_rendering.c文件中的FUN_函数提供有意义的名称

cd /dev/shm/mountblade-code/TaleWorlds.Native/src

# 定义函数重命名映射
declare -A function_mapping=(
    ["FUN_180441830"]="InitializeRenderPipeline"
    ["FUN_180441890"]="SetupRenderContext"
    ["FUN_1804418e0"]="ConfigureRenderDevice"
    ["FUN_180441910"]="CreateRenderResources"
    ["FUN_180441950"]="SetupRenderTargets"
    ["FUN_180441a00"]="ConfigureRenderShaders"
    ["FUN_180441c50"]="InitializeRenderState"
    ["FUN_180441cc0"]="SetupRenderBuffers"
    ["FUN_180441dd0"]="CreateRenderTextures"
    ["FUN_180441e10"]="ConfigureRenderSamplers"
    ["FUN_180441e50"]="SetupRenderViews"
    ["FUN_180441e90"]="InitializeRenderPipeline"
    ["FUN_180441f60"]="ConfigureRenderOutput"
    ["FUN_180441fc0"]="SetupRenderDepth"
    ["FUN_180442020"]="InitializeRenderStencil"
    ["FUN_1804420c0"]="ConfigureRenderBlend"
    ["FUN_180442180"]="SetupRenderRasterizer"
    ["FUN_1804422a0"]="InitializeRenderCulling"
    ["FUN_180442370"]="CreateRenderQueries"
    ["FUN_180442450"]="SetupRenderCounters"
    ["FUN_1804424d0"]="InitializeRenderStats"
    ["FUN_180442560"]="ConfigureRenderTiming"
    ["FUN_180442670"]="SetupRenderSync"
    ["FUN_180442720"]="InitializeRenderFences"
    ["FUN_180442860"]="CreateRenderCommandLists"
    ["FUN_180442950"]="SetupRenderQueues"
    ["FUN_1804429f0"]="ConfigureRenderPools"
    ["FUN_180442b30"]="InitializeRenderHeaps"
    ["FUN_180442d10"]="SetupRenderDescriptors"
    ["FUN_180442e00"]="ConfigureRenderMemory"
    ["FUN_180443000"]="CreateRenderBuffers"
    ["FUN_180443080"]="SetupRenderAllocators"
    ["FUN_1804431c0"]="InitializeRenderManagers"
    ["FUN_180443320"]="ConfigureRenderSystems"
    ["FUN_180443510"]="SetupRenderPipeline"
    ["FUN_180443630"]="InitializeRenderContext"
    ["FUN_180443680"]="ConfigureRenderDevice"
    ["FUN_180443700"]="CreateRenderSwapChain"
    ["FUN_180443770"]="SetupRenderPresentation"
    ["FUN_180443820"]="InitializeRenderDisplay"
    ["FUN_180443930"]="ConfigureRenderOutput"
    ["FUN_180443a40"]="SetupRenderFrame"
    ["FUN_180443aa0"]="InitializeRenderLoop"
    ["FUN_180443b00"]="ConfigureRenderTiming"
    ["FUN_180443b40"]="SetupRenderVSync"
    ["FUN_180443d10"]="InitializeRenderFPS"
    ["FUN_180443d70"]="ConfigureRenderLimit"
    ["FUN_180443df0"]="SetupRenderMonitor"
    ["FUN_180443f80"]="InitializeRenderAdapter"
    ["FUN_180443ff0"]="ConfigureRenderDriver"
    ["FUN_180444030"]="SetupRenderAPI"
    ["FUN_180444070"]="InitializeRenderBackend"
    ["FUN_180444100"]="ConfigureRenderFrontend"
    ["FUN_180444200"]="SetupRenderInterface"
    ["FUN_180444280"]="InitializeRenderBridge"
    ["FUN_1804442c0"]="ConfigureRenderWrapper"
    ["FUN_1804442e0"]="SetupRenderAbstraction"
    ["FUN_180444370"]="InitializeRenderLayer"
    ["FUN_1804443c0"]="ConfigureRenderMiddleware"
    ["FUN_180444410"]="SetupRenderFramework"
    ["FUN_1804445b0"]="InitializeRenderEngine"
    ["FUN_180444600"]="ConfigureRenderCore"
    ["FUN_180444700"]="SetupRenderFoundation"
    ["FUN_1804447c0"]="InitializeRenderBase"
    ["FUN_1804448a0"]="ConfigureRenderPlatform"
    ["FUN_1804449a0"]="SetupRenderHardware"
    ["FUN_180444a20"]="InitializeRenderGPU"
    ["FUN_180444b70"]="ConfigureRenderMemory"
    ["FUN_180444dd0"]="SetupRenderCache"
    ["FUN_180444e90"]="InitializeRenderOptimization"
    ["FUN_180445060"]="ConfigureRenderPerformance"
    ["FUN_180445110"]="SetupRenderProfiling"
    ["FUN_180445180"]="InitializeRenderDebug"
    ["FUN_180445390"]="ConfigureRenderValidation"
    ["FUN_180445480"]="SetupRenderLogging"
    ["FUN_180445570"]="InitializeRenderTracing"
    ["FUN_180445680"]="ConfigureRenderMetrics"
    ["FUN_1804457b0"]="SetupRenderAnalytics"
    ["FUN_180445870"]="InitializeRenderMonitoring"
    ["FUN_180445970"]="ConfigureRenderReporting"
    ["FUN_180445a80"]="SetupRenderAlerts"
    ["FUN_180445cd0"]="InitializeRenderNotifications"
    ["FUN_180445dc0"]="ConfigureRenderEvents"
    ["FUN_180445eb0"]="SetupRenderCallbacks"
    ["FUN_180445fd0"]="InitializeRenderHandlers"
    ["FUN_180446010"]="ConfigureRenderListeners"
    ["FUN_180446080"]="SetupRenderObservers"
    ["FUN_1804460c0"]="InitializeRenderSubscribers"
    ["FUN_1804460f0"]="ConfigureRenderPublishers"
    ["FUN_180446120"]="SetupRenderEmitters"
    ["FUN_180446160"]="InitializeRenderBroadcasters"
    ["FUN_1804461b0"]="ConfigureRenderDispatchers"
    ["FUN_1804462a0"]="SetupRenderRouters"
    ["FUN_1804462e0"]="InitializeRenderBrokers"
)

# 执行函数重命名
for old_name in "${!function_mapping[@]}"; do
    new_name="${function_mapping[$old_name]}"
    
    # 替换函数声明
    sed -i "s/undefined $old_name;/int $new_name;/g" 03_rendering.c
    
    # 替换函数注释
    sed -i "s/\/\/ 函数: undefined $old_name;/\/\/ 函数: int $new_name;/g" 03_rendering.c
    
    echo "重命名: $old_name -> $new_name"
done

echo "渲染系统函数重命名完成"