#!/bin/bash

# 批量替换Unwind_函数名的脚本
# 为06_utilities.c文件中的Unwind_函数提供有意义的名称

# 定义替换映射
declare -A replacements=(
    ["Unwind_180902750"]="CleanupResourceManagerLock"
    ["Unwind_180902760"]="ReleaseResourceAllocationLock"
    ["Unwind_180902770"]="ResetResourceOperationState"
    ["Unwind_180902780"]="ClearResourceValidationFlags"
    ["Unwind_180902790"]="ResetResourceHashState"
    ["Unwind_1809027a0"]="ReleaseGraphicsResourceLock"
    ["Unwind_1809027b0"]="ReleaseTextureResourceLock"
    ["Unwind_1809027e0"]="ProcessAdvancedDataCleanup"
    ["Unwind_1809027f0"]="HandleMemoryResourceCleanup"
    ["Unwind_180902800"]="HandleBufferResourceCleanup"
    ["Unwind_180902810"]="ReleaseShaderResourceLock"
    ["Unwind_180902820"]="ResetGraphicsPipelineState"
    ["Unwind_180902830"]="ClearRenderQueueState"
    ["Unwind_180902840"]="ResetFrameBufferState"
    ["Unwind_180902850"]="ClearTextureCacheState"
    ["Unwind_180902860"]="ReleaseVertexBufferLock"
    ["Unwind_180902890"]="ReleaseIndexBufferLock"
    ["Unwind_1809028c0"]="ResetConstantBufferState"
    ["Unwind_1809028d0"]="ClearShaderProgramState"
    ["UnwindResourceLockHandler"]="ReleaseGeneralResourceLock"
    ["Unwind_180902930"]="ResetResourcePoolState"
    ["Unwind_180902940"]="ClearMemoryPoolFlags"
    ["Unwind_180902aa0"]="ReleaseAudioResourceLock"
    ["Unwind_180902ac0"]="ReleaseSoundBufferLock"
    ["Unwind_180902ad0"]="ResetAudioChannelState"
    ["Unwind_180902ae0"]="ClearAudioMixerState"
    ["Unwind_180902b40"]="ReleaseNetworkResourceLock"
    ["Unwind_180902b50"]="ResetNetworkConnectionState"
    ["Unwind_180902c60"]="ProcessResourceHashCleanup"
    ["Unwind_180902c70"]="ReleaseSystemResourceLock"
    ["Unwind_180902c80"]="ReleaseKernelResourceLock"
    ["Unwind_180902f00"]="ReleaseFileSystemLock"
    ["Unwind_180902f20"]="ProcessFileHandleCleanup"
    ["Unwind_180902f40"]="ProcessDirectoryHandleCleanup"
    ["Unwind_180902f80"]="ReleaseStreamResourceLock"
    ["Unwind_180902fc0"]="HandleFileStreamCleanup"
    ["Unwind_180902fe0"]="HandleMemoryStreamCleanup"
    ["Unwind_180903000"]="HandleSystemMemoryCleanup"
    ["Unwind_180903010"]="HandleUserMemoryCleanup"
    ["Unwind_180903020"]="ResetMemoryAllocatorState"
    ["Unwind_180903030"]="ClearGarbageCollectorFlags"
    ["Unwind_180903040"]="ReleaseMemoryPoolLock"
    ["Unwind_180903050"]="ResetHeapManagerState"
    ["Unwind_180903060"]="ClearStackAllocatorFlags"
    ["Unwind_180903070"]="ReleaseVirtualMemoryLock"
    ["Unwind_180903080"]="HandlePhysicalMemoryCleanup"
    ["Unwind_180903090"]="HandleSharedMemoryCleanup"
    ["Unwind_1809030a0"]="ProcessResourceValidationCleanup"
    ["Unwind_180903100"]="ProcessResourceOperationCleanup"
    ["Unwind_1809031e0"]="ProcessResourceOperationFinalCleanup"
    ["Unwind_180903220"]="ResetThreadingPoolState"
    ["Unwind_180903230"]="ReleaseThreadResourceLock"
    ["Unwind_180903240"]="ReleaseMutexResourceLock"
    ["Unwind_180903250"]="ReleaseSemaphoreResourceLock"
    ["Unwind_180903270"]="ReleaseEventResourceLock"
    ["Unwind_180903290"]="ReleaseCriticalSectionLock"
    ["Unwind_1809032d0"]="ResetThreadPoolState"
    ["Unwind_1809032e0"]="ClearThreadQueueFlags"
    ["Unwind_1809032f0"]="ResetTaskSchedulerState"
    ["Unwind_180903300"]="ClearJobQueueFlags"
    ["Unwind_180903330"]="HandleGraphicsResourceFinalCleanup"
    ["Unwind_180903340"]="HandleAudioResourceFinalCleanup"
    ["Unwind_180903350"]="HandleNetworkResourceFinalCleanup"
    ["Unwind_180903430"]="HandleSystemResourceFinalCleanup"
    ["Unwind_180903610"]="ProcessResourceValidationFinalCleanup"
    ["Unwind_180903620"]="ProcessResourceOperationFinalRelease"
    ["Unwind_180903640"]="HandleThreadResourceFinalCleanup"
)

# 执行替换
for old_name in "${!replacements[@]}"; do
    new_name="${replacements[$old_name]}"
    echo "替换 $old_name -> $new_name"
    sed -i "s/$old_name/$new_name/g" /dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c
done

echo "Unwind函数替换完成"