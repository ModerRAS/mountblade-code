#!/bin/bash

# 06_utilities.c 函数名美化脚本
# 将 FUN_18089xxxx 格式的函数名替换为更具语义的名称

FILE_PATH="/dev/shm/mountblade-code/TaleWorlds.Native/src/06_utilities.c"

# 创建备份
cp "$FILE_PATH" "$FILE_PATH.tmp_backup"

# 函数名映射 - 根据函数的功能和参数进行命名
declare -A function_map=(
    # 空函数或简单函数
    ["FUN_180894cd2"]="emptyUtilityFunction"
    ["FUN_180895b89"]="utilityJumpTarget"
    ["FUN_1808974f4"]="utilityErrorTarget"
    ["FUN_180897560"]="utilityCleanupTarget"
    ["FUN_1808975a6"]="utilityResetTarget"
    ["FUN_180897644"]="utilityProcessTarget"
    ["FUN_1808976b0"]="utilityValidateTarget"
    ["FUN_180897afe"]="utilityCompleteTarget"
    ["FUN_180897b0e"]="utilityFinalizeTarget"
    ["FUN_180897b16"]="utilityReturnTarget"
    ["FUN_18089802e"]="utilityIdleTarget"
    ["FUN_1808992c4"]="utilityWaitTarget"
    ["FUN_180899790"]="utilitySleepTarget"
    ["FUN_180899799"]="utilityPauseTarget"
    ["FUN_180899891"]="utilityResumeTarget"
    ["FUN_180899c45"]="utilityContinueTarget"
    ["FUN_180899c54"]="utilityProceedTarget"
    ["FUN_180899c96"]="utilityAdvanceTarget"
    ["FUN_180899d7f"]="utilityProgressTarget"
    ["FUN_180899ed5"]="utilityMoveTarget"
    ["FUN_18089a365"]="utilityStepTarget"
    ["FUN_18089a685"]="utilityWalkTarget"
    ["FUN_18089a73c"]="utilityRunTarget"
    ["FUN_18089a9d5"]="utilityJumpTarget"
    ["FUN_18089ac96"]="utilitySkipTarget"
    ["FUN_18089ae2d"]="utilityLeapTarget"
    ["FUN_18089ae35"]="utilityBoundTarget"
    ["FUN_18089ae3d"]="utilitySpringTarget"
    ["FUN_18089b26e"]="utilityFlyTarget"
    ["FUN_18089b3d4"]="utilitySoarTarget"
    ["FUN_18089b3e6"]="utilityGlideTarget"
    ["FUN_18089b599"]="utilityFloatTarget"
    ["FUN_18089b5fc"]="utilityDriftTarget"
    ["FUN_18089b61e"]="utilityCoastTarget"
    ["FUN_18089b6df"]="utilityCruiseTarget"
    ["FUN_18089b7c7"]="utilityTravelTarget"
    ["FUN_18089bbff"]="utilityJourneyTarget"
    ["FUN_18089bc5a"]="utilityTripTarget"
    ["FUN_18089bd61"]="utilityVoyageTarget"
    ["FUN_18089be10"]="utilityNavigateTarget"
    ["FUN_18089be41"]="utilitySailTarget"
    ["FUN_18089c019"]="utilityChartTarget"
    ["FUN_18089c606"]="utilityMapTarget"
    ["FUN_18089c616"]="utilityPlanTarget"
    ["FUN_18089c61e"]="utilityRouteTarget"
    ["FUN_18089cc29"]="utilityGuideTarget"
    ["FUN_18089cc31"]="utilityDirectTarget"
    ["FUN_18089cc41"]="utilitySteerTarget"
    ["FUN_18089ce25"]="utilityPilotTarget"
    ["FUN_18089d091"]="utilityDriveTarget"
    ["FUN_18089d0a3"]="utilityRideTarget"
    ["FUN_18089d0b0"]="utilityMountTarget"
    ["FUN_18089d208"]="utilityBoardTarget"
    ["FUN_18089d23a"]="utilityEmbarkTarget"
    ["FUN_18089d47a"]="utilityLaunchTarget"
    ["FUN_18089d520"]="utilityDeployTarget"
    ["FUN_18089d557"]="utilityLandTarget"
    ["FUN_18089dcd6"]="utilityDockTarget"
    ["FUN_18089df30"]="utilityAnchorTarget"
    ["FUN_18089e0be"]="utilityMoorTarget"
    
    # 带参数的函数
    ["FUN_1808953bf"]="processUtilityData"
    ["FUN_180895bb0"]="handleUtilityRequest"
    ["FUN_180895c60"]="executeUtilityOperation"
    ["FUN_180895c8b"]="performUtilityTask"
    ["FUN_180895cf1"]="completeUtilityJob"
    ["FUN_180895d16"]="checkUtilityStatus"
    ["FUN_180895d30"]="getUtilityInfo"
    ["FUN_180895d62"]="readUtilityData"
    ["FUN_180895d9c"]="writeUtilityData"
    ["FUN_180895e00"]="updateUtilityState"
    ["FUN_180895f20"]="validateUtilityInput"
    ["FUN_180895f44"]="verifyUtilityOutput"
    ["FUN_180896027"]="initializeUtilitySystem"
    ["FUN_180896040"]="configureUtilitySettings"
    ["FUN_180896064"]="setupUtilityEnvironment"
    ["FUN_18089611f"]="prepareUtilityResources"
    ["FUN_180896140"]="allocateUtilityMemory"
    ["FUN_180896800"]="createUtilityBuffer"
    ["FUN_180896830"]="resizeUtilityBuffer"
    ["FUN_180896880"]="manageUtilityBuffer"
    ["FUN_1808968a0"]="optimizeUtilityBuffer"
    ["FUN_180896a30"]="processUtilityBuffer"
    ["FUN_180896aa0"]="analyzeUtilityBuffer"
    ["FUN_180896b20"]="validateUtilityBuffer"
    ["FUN_180896c10"]="secureUtilityBuffer"
    ["FUN_180896c60"]="protectUtilityBuffer"
    ["FUN_180896e11"]="releaseUtilityBuffer"
    ["FUN_180897520"]="accessUtilityData"
    ["FUN_1808975e0"]="manipulateUtilityData"
    ["FUN_180897b40"]="transformUtilityData"
    ["FUN_180897d20"]="convertUtilityData"
    ["FUN_180897d90"]="exportUtilityData"
    ["FUN_180897dd3"]="importUtilityData"
    ["FUN_180898040"]="syncUtilityData"
    ["FUN_1808986b0"]="backupUtilityData"
    ["FUN_180898790"]="restoreUtilityData"
    ["FUN_1808987e0"]="archiveUtilityData"
    ["FUN_1808988b0"]="compressUtilityData"
    ["FUN_180898b40"]="decompressUtilityData"
    ["FUN_180898b65"]="encryptUtilityData"
    ["FUN_180898bc0"]="decryptUtilityData"
    ["FUN_180898c86"]="hashUtilityData"
    ["FUN_180898d31"]="signUtilityData"
    ["FUN_180898d4d"]="verifyUtilitySignature"
    ["FUN_180898d60"]="authenticateUtilityData"
    ["FUN_180898d84"]="authorizeUtilityAccess"
    ["FUN_180898e56"]="logUtilityOperation"
    ["FUN_180898e70"]="auditUtilityActivity"
    ["FUN_180898eb0"]="monitorUtilityPerformance"
    ["FUN_180898ef0"]="measureUtilityMetrics"
    ["FUN_180898f40"]="profileUtilityUsage"
    ["FUN_180898fc0"]="benchmarkUtilitySpeed"
    ["FUN_180899040"]="testUtilityFunctionality"
    ["FUN_180899090"]="debugUtilityIssues"
    ["FUN_180899100"]="traceUtilityExecution"
    ["FUN_180899180"]="inspectUtilityState"
    ["FUN_180899220"]="examineUtilityBehavior"
    ["FUN_18089923e"]="reviewUtilityResults"
    ["FUN_1808992f0"]="evaluateUtilityPerformance"
    ["FUN_180899360"]="assessUtilityQuality"
    ["FUN_1808993e0"]="judgeUtilityEfficiency"
    ["FUN_1808995c0"]="rateUtilityEffectiveness"
    ["FUN_1808997b0"]="scoreUtilityReliability"
    ["FUN_180899891"]="gradeUtilityStability"
    ["FUN_180899950"]="rankUtilityCapability"
    ["FUN_1808999c1"]="sortUtilityFeatures"
    ["FUN_180899ae6"]="filterUtilityOptions"
    ["FUN_180899c60"]="searchUtilityItems"
    ["FUN_180899d7f"]="findUtilityMatches"
    ["FUN_180899ed5"]="locateUtilityElements"
    ["FUN_180899ef0"]="discoverUtilityComponents"
    ["FUN_180899f80"]="identifyUtilityParts"
    ["FUN_180899fe0"]="recognizeUtilityPieces"
    ["FUN_18089a059"]="classifyUtilityTypes"
    ["FUN_18089a365"]="categorizeUtilityKinds"
    ["FUN_18089a750"]="organizeUtilityGroups"
    ["FUN_18089a9d5"]="arrangeUtilitySets"
    ["FUN_18089a9f0"]="orderUtilityLists"
    ["FUN_18089ac96"]="sequenceUtilityItems"
    ["FUN_18089ae2d"]="structureUtilityData"
    ["FUN_18089b26e"]="formatUtilityContent"
    ["FUN_18089b3d4"]="styleUtilityPresentation"
    ["FUN_18089b3e6"]="designUtilityInterface"
    ["FUN_18089b400"]="buildUtilityComponent"
    ["FUN_18089b599"]="constructUtilitySystem"
    ["FUN_18089b5fc"]="assembleUtilityParts"
    ["FUN_18089b61e"]="integrateUtilityModules"
    ["FUN_18089b6df"]="combineUtilityFeatures"
    ["FUN_18089b7c7"]="mergeUtilityFunctions"
    ["FUN_18089bbff"]="uniteUtilityOperations"
    ["FUN_18089bc10"]="joinUtilityProcesses"
    ["FUN_18089bd61"]="connectUtilityServices"
    ["FUN_18089be10"]="linkUtilityResources"
    ["FUN_18089be41"]="bridgeUtilityGaps"
    ["FUN_18089c019"]="interfaceUtilitySystems"
    ["FUN_18089c606"]="communicateUtilityInfo"
    ["FUN_18089c616"]="exchangeUtilityData"
    ["FUN_18089c61e"]="shareUtilityResources"
    ["FUN_18089cc29"]="distributeUtilityLoad"
    ["FUN_18089cc31"]="balanceUtilityWork"
    ["FUN_18089cc41"]="scheduleUtilityTasks"
    ["FUN_18089ce25"]="prioritizeUtilityActions"
    ["FUN_18089d091"]="optimizeUtilityFlow"
    ["FUN_18089d0a3"]="maximizeUtilityOutput"
    ["FUN_18089d0b0"]="minimizeUtilityCost"
    ["FUN_18089d208"]="reduceUtilityWaste"
    ["FUN_18089d23a"]="eliminateUtilityErrors"
    ["FUN_18089d47a"]="preventUtilityFailures"
    ["FUN_18089d520"]="avoidUtilityRisks"
    ["FUN_18089d557"]="mitigateUtilityThreats"
    ["FUN_18089dcd6"]="protectUtilityAssets"
    ["FUN_18089df30"]="secureUtilitySystems"
    ["FUN_18089e0be"]="defendUtilityNetwork"
)

# 应用替换
for old_name in "${!function_map[@]}"; do
    new_name="${function_map[$old_name]}"
    
    # 替换函数定义
    sed -i "s/void $old_name(/void $new_name(/g" "$FILE_PATH"
    sed -i "s/uint64 $old_name(/uint64 $new_name(/g" "$FILE_PATH"
    sed -i "s/ulonglong $old_name(/ulonglong $new_name(/g" "$FILE_PATH"
    sed -i "s/int $old_name(/int $new_name(/g" "$FILE_PATH"
    sed -i "s/byte $old_name(/byte $new_name(/g" "$FILE_PATH"
    sed -i "s/float $old_name(/float $new_name(/g" "$FILE_PATH"
    sed -i "s/uint32 $old_name(/uint32 $new_name(/g" "$FILE_PATH"
    sed -i "s/longlong $old_name(/longlong $new_name(/g" "$FILE_PATH"
    sed -i "s/uint64 \* $old_name(/uint64 \* $new_name(/g" "$FILE_PATH"
    sed -i "s/longlong \* $old_name(/longlong \* $new_name(/g" "$FILE_PATH"
    sed -i "s/uint32 \* $old_name(/uint32 \* $new_name(/g" "$FILE_PATH"
    sed -i "s/int \* $old_name(/int \* $new_name(/g" "$FILE_PATH"
    sed -i "s/byte \* $old_name(/byte \* $new_name(/g" "$FILE_PATH"
    sed -i "s/float \* $old_name(/float \* $new_name(/g" "$FILE_PATH"
    
    # 替换函数调用
    sed -i "s/$old_name(/$new_name(/g" "$FILE_PATH"
    
    # 替换goto标签
    sed -i "s/goto $old_name;/goto $new_name;/g" "$FILE_PATH"
    sed -i "s/$old_name:/$new_name:/g" "$FILE_PATH"
    
    echo "替换: $old_name -> $new_name"
done

echo "函数名替换完成"

# 清理临时备份
rm -f "$FILE_PATH.tmp_backup"