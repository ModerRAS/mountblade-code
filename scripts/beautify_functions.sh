#!/bin/bash

# 美化01_initialization.c文件中的FUN_函数
# 简化实现：仅替换常见的FUN_函数名为语义化名称
# 原本实现：完全重构所有FUN_函数命名体系

INPUT_FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/01_initialization.c"

# 备份原文件
cp "$INPUT_FILE" "$INPUT_FILE.bak"

# FUN_函数名映射
declare -A FUNCTION_MAP=(
    ["FUN_1800637f0"]="system_memory_pool_initializer"
    ["FUN_1809417a0"]="system_resource_cache_register"
    ["FUN_1809417c0"]="system_thread_pool_register"
    ["FUN_18025d510"]="system_graphics_initializer"
    ["FUN_180045af0"]="system_resource_loader_callback"
    ["FUN_1804ac640"]="system_audio_initializer"
    ["FUN_180943070"]="system_input_manager_register"
    ["FUN_180629770"]="system_network_initializer"
    ["FUN_180943140"]="system_physics_manager_register"
    ["FUN_180943160"]="system_ui_manager_register"
    ["FUN_180943180"]="system_animation_manager_register"
    ["FUN_180043720"]="system_script_engine_initializer"
    ["FUN_1809431a0"]="system_script_manager_register"
    ["FUN_180943200"]="system_ai_manager_register"
    ["FUN_180767e20"]="system_memory_allocator"
    ["FUN_1807681a0"]="system_memory_status_checker"
    ["FUN_1808dbcd0"]="system_graphics_context_initializer"
    ["FUN_180046e20"]="system_audio_device_initializer"
    ["FUN_180050b00"]="system_audio_context_initializer"
    ["FUN_18062b1e0"]="system_memory_allocator_extended"
    ["FUN_180049830"]="system_memory_pool_setup"
    ["FUN_18006e990"]="system_audio_processor"
    ["FUN_1800466d0"]="system_audio_device_configurator"
    ["FUN_18005e300"]="system_resource_manager"
    ["FUN_1808fd200"]="system_graphics_renderer"
    ["FUN_18004b560"]="system_input_handler"
    ["FUN_180061380"]="system_input_processor"
    ["FUN_1800636f0"]="system_memory_sub_allocator"
    ["FUN_1800624c0"]="system_audio_mixer"
    ["FUN_180627160"]="system_audio_buffer_manager"
    ["FUN_1808fcdc8"]="system_graphics_synchronizer"
    ["FUN_1800623b0"]="system_audio_stream_manager"
    ["FUN_18004b860"]="system_resource_loader"
    ["FUN_18064e900"]="system_cleanup_handler"
    ["FUN_1808fc050"]="system_graphics_transformer"
    ["FUN_180043f90"]="system_memory_manager"
    ["FUN_180629090"]="system_network_connector"
    ["FUN_18024e5c0"]="system_resource_handler"
    ["FUN_180637560"]="system_resource_cache"
    ["FUN_180626ee0"]="system_audio_equalizer"
    ["FUN_18062b420"]="system_memory_chunk_allocator"
    ["FUN_18064e990"]="system_memory_validator"
    ["FUN_180623fd0"]="system_audio_filter"
    ["FUN_180045580"]="system_audio_system_checker"
    ["FUN_18020f150"]="system_resource_processor"
    ["FUN_18006bfe0"]="system_audio_controller"
    ["FUN_18005d790"]="system_resource_monitor"
    ["FUN_18006ef20"]="system_audio_volume_controller"
    ["FUN_180626f80"]="system_memory_configurator"
    ["FUN_180045d80"]="system_audio_device_handler"
    ["FUN_180045dc0"]="system_audio_device_accessor"
    ["FUN_180045ea0"]="system_audio_stream_handler"
    ["FUN_180046190"]="system_audio_buffer_handler"
    ["FUN_180046240"]="system_audio_format_converter"
    ["FUN_180046340"]="system_audio_channel_handler"
    ["FUN_180046480"]="system_audio_buffer_accessor"
    ["FUN_180046650"]="system_audio_stream_accessor"
    ["FUN_180046790"]="system_audio_effect_handler"
    ["FUN_180046b10"]="system_audio_effect_processor"
    ["FUN_180627c50"]="system_audio_mixer_extended"
    ["FUN_180048a90"]="system_audio_renderer"
    ["FUN_180048c70"]="system_audio_device_manager"
    ["FUN_180048cc0"]="system_audio_buffer_manager_extended"
    ["FUN_180049010"]="system_audio_allocator"
    ["FUN_180049110"]="system_audio_sub_allocator"
    ["FUN_1800491b0"]="system_audio_config_manager"
    ["FUN_1800494f0"]="system_audio_device_checker"
    ["FUN_1800496b0"]="system_audio_format_handler"
    ["FUN_180049830"]="system_audio_pool_manager"
    ["FUN_1800498d0"]="system_audio_context_manager"
    ["FUN_180049970"]="system_audio_buffer_provider"
    ["FUN_180049b30"]="system_audio_stream_processor"
    ["FUN_180049bb0"]="system_audio_channel_manager"
    ["FUN_180049cd0"]="system_audio_buffer_allocator"
    ["FUN_180049eb0"]="system_audio_effect_manager"
    ["FUN_180049fd0"]="system_audio_data_processor"
    ["FUN_18004a220"]="system_audio_channel_allocator"
    ["FUN_18004a3c0"]="system_audio_device_initializer"
    ["FUN_18004a430"]="system_audio_buffer_validator"
    ["FUN_18004a4b0"]="system_audio_system_controller"
    ["FUN_18004a500"]="system_audio_status_checker"
    ["FUN_1800ba940"]="system_audio_context_initializer"
    ["FUN_1806279c0"]="system_audio_config_loader"
    ["FUN_18062dee0"]="system_audio_device_configurator_extended"
    ["FUN_1800aecf0"]="system_audio_device_validator"
    ["FUN_18004b1f0"]="system_audio_controller_extended"
    ["FUN_1800ba6f0"]="system_audio_system_finalizer"
    ["FUN_18004b730"]="system_audio_stream_finalizer"
    ["FUN_18004b100"]="system_audio_command_handler"
    ["FUN_18004b390"]="system_audio_active_checker"
    ["FUN_18004b560"]="system_audio_command_processor"
    ["FUN_18004b640"]="system_audio_buffer_handler_extended"
    ["FUN_18004b7e0"]="system_audio_stream_provider"
    ["FUN_18004b820"]="system_audio_buffer_provider_extended"
    ["FUN_18004b920"]="system_audio_effect_provider"
    ["FUN_18004b960"]="system_audio_channel_provider"
    ["FUN_1800582b0"]="system_audio_data_handler"
    ["FUN_180058370"]="system_audio_channel_processor"
    ["FUN_180057010"]="system_audio_buffer_finalizer"
    ["FUN_180058420"]="system_audio_stream_handler_extended"
    ["FUN_18004bd10"]="system_audio_device_provider"
    ["FUN_180142b20"]="system_audio_device_configurator_final"
    ["FUN_18004bf50"]="system_audio_buffer_releaser"
    ["FUN_18004c050"]="system_audio_stream_releaser"
    ["FUN_18004c330"]="system_audio_effect_controller"
    ["FUN_18004c480"]="system_audio_channel_controller"
    ["FUN_18004ca30"]="system_audio_system_handler"
    ["FUN_180057170"]="system_audio_buffer_cleaner"
    ["FUN_18005e570"]="system_audio_stream_monitor"
    ["FUN_180174950"]="system_audio_effect_monitor"
    ["FUN_180057d70"]="system_audio_channel_monitor"
    ["FUN_180057550"]="system_audio_system_cleaner"
    ["FUN_1800578a0"]="system_audio_context_cleaner"
    ["FUN_18005d260"]="system_audio_data_cleaner"
    ["FUN_18005d580"]="system_audio_finalizer"
    ["FUN_1800590b0"]="system_audio_processor_extended"
    ["FUN_18005d1f0"]="system_audio_effect_finalizer"
    ["FUN_180092820"]="system_audio_renderer_extended"
    ["FUN_18005ca20"]="system_audio_context_handler"
    ["FUN_1801725e0"]="system_audio_stream_renderer"
    ["FUN_1800a3880"]="system_audio_channel_renderer"
    ["FUN_180062300"]="system_audio_system_configurator"
    ["FUN_18004e7a0"]="system_audio_volume_handler"
    ["FUN_180628380"]="system_audio_volume_processor"
    ["FUN_18005c8a0"]="system_audio_volume_controller_extended"
    ["FUN_180171f10"]="system_audio_device_initializer_extended"
    ["FUN_18020e0e0"]="system_audio_buffer_initializer"
    ["FUN_18020e840"]="system_audio_buffer_finalizer_extended"
    ["FUN_1802567b0"]="system_audio_effect_initializer"
    ["FUN_18008d660"]="system_audio_effect_allocator"
    ["FUN_18005e630"]="system_audio_context_handler_extended"
    ["FUN_18005e890"]="system_audio_context_provider"
    ["FUN_180126380"]="system_audio_buffer_handler_final"
    ["FUN_180095420"]="system_audio_channel_handler_final"
    ["FUN_18016cef0"]="system_audio_device_handler_final"
    ["FUN_18005d580"]="system_audio_system_finalizer_extended"
    ["FUN_18006eb30"]="system_audio_context_finalizer"
    ["FUN_18005e6a0"]="system_audio_stream_handler_final"
    ["FUN_180062bd50"]="system_audio_config_handler_extended"
    ["FUN_180050b30"]="system_audio_system_initializer_extended"
    ["FUN_18004be90"]="system_audio_buffer_manager_final"
    ["FUN_1801edeb0"]="system_audio_data_processor_extended"
    ["FUN_18004e5f0"]="system_audio_effect_handler_final"
    ["FUN_1800572d0"]="system_audio_channel_initializer"
    ["FUN_180091020"]="system_audio_system_provider"
    ["FUN_1801ed510"]="system_audio_system_processor"
    ["FUN_180160500"]="system_audio_device_validator_extended"
    ["FUN_180051d40"]="system_audio_channel_allocator_extended"
    ["FUN_180051f00"]="system_audio_system_active_checker"
    ["FUN_180052020"]="system_audio_device_handler_extended"
    ["FUN_180057110"]="system_audio_channel_handler_extended"
    ["FUN_180059820"]="system_audio_data_handler_extended"
    ["FUN_180628d60"]="system_audio_device_configurator_extended_final"
    ["FUN_1800524c0"]="system_audio_stream_handler_extended_final"
    ["FUN_1808fcb90"]="system_audio_system_monitor_final"
    ["FUN_1808fc"]="system_audio_finalizer_extended"
)

# 执行替换
for old_name in "${!FUNCTION_MAP[@]}"; do
    new_name="${FUNCTION_MAP[$old_name]}"
    sed -i "s/\b$old_name\b/$new_name/g" "$INPUT_FILE"
done

echo "FUN_函数名美化完成"