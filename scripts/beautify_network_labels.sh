#!/bin/bash

# 网络系统LAB_标签语义化美化脚本
# 用于批量替换05_networking.c文件中的LAB_标签为语义化名称

# 创建标签映射文件
cat > /tmp/label_mapping.txt << 'EOF'
LAB_180846d91=NETWORK_LABEL_CONNECTION_VALIDATION_PRIMARY
LAB_180846df9=NETWORK_LABEL_CONNECTION_VALIDATION_SECONDARY
LAB_18084749d=NETWORK_LABEL_SOCKET_STATE_PRIMARY
LAB_1808477fa=NETWORK_LABEL_SOCKET_STATE_SECONDARY
LAB_180847bfb=NETWORK_LABEL_DATA_TRANSFER_PRIMARY
LAB_180847c35=NETWORK_LABEL_DATA_TRANSFER_SECONDARY
LAB_180847d83=NETWORK_LABEL_BUFFER_MANAGEMENT_PRIMARY
LAB_180847dc9=NETWORK_LABEL_BUFFER_MANAGEMENT_SECONDARY
LAB_180847fc4=NETWORK_LABEL_PACKET_PROCESSING_PRIMARY
LAB_180848016=NETWORK_LABEL_PACKET_PROCESSING_SECONDARY
LAB_180848132=NETWORK_LABEL_CONNECTION_HANDLER_PRIMARY
LAB_18084820e=NETWORK_LABEL_CONNECTION_HANDLER_SECONDARY
LAB_180848354=NETWORK_LABEL_THREAD_MANAGEMENT_PRIMARY
LAB_1808483a6=NETWORK_LABEL_THREAD_MANAGEMENT_SECONDARY
LAB_1808490b9=NETWORK_LABEL_ERROR_HANDLER_PRIMARY
LAB_1808491ce=NETWORK_LABEL_ERROR_HANDLER_SECONDARY
LAB_180849294=NETWORK_LABEL_SECURITY_VALIDATION_PRIMARY
LAB_1808492e6=NETWORK_LABEL_SECURITY_VALIDATION_SECONDARY
LAB_180849462=NETWORK_LABEL_PROTOCOL_HANDLER_PRIMARY
LAB_1808494eb=NETWORK_LABEL_PROTOCOL_HANDLER_SECONDARY
LAB_180849553=NETWORK_LABEL_PROTOCOL_HANDLER_TERTIARY
LAB_180849763=NETWORK_LABEL_NETWORK_CONFIG_PRIMARY
LAB_1808498c8=NETWORK_LABEL_NETWORK_CONFIG_SECONDARY
LAB_1808499fb=NETWORK_LABEL_CONNECTION_POOL_PRIMARY
LAB_180849ad3=NETWORK_LABEL_CONNECTION_POOL_SECONDARY
LAB_180849c22=NETWORK_LABEL_CONNECTION_POOL_TERTIARY
LAB_180849c81=NETWORK_LABEL_CONNECTION_POOL_QUATERNARY
LAB_180849dd1=NETWORK_LABEL_DATA_BUFFER_PRIMARY
LAB_180849e6f=NETWORK_LABEL_DATA_BUFFER_SECONDARY
LAB_180849fd1=NETWORK_LABEL_DATA_BUFFER_TERTIARY
LAB_18084a06f=NETWORK_LABEL_DATA_BUFFER_QUATERNARY
LAB_18084a1fa=NETWORK_LABEL_PACKET_QUEUE_PRIMARY
LAB_18084a1a4=NETWORK_LABEL_PACKET_QUEUE_SECONDARY
LAB_18084a346=NETWORK_LABEL_PACKET_QUEUE_TERTIARY
LAB_18084a2ef=NETWORK_LABEL_PACKET_QUEUE_QUATERNARY
LAB_18084a498=NETWORK_LABEL_EVENT_HANDLER_PRIMARY
LAB_18084a43e=NETWORK_LABEL_EVENT_HANDLER_SECONDARY
LAB_18084a608=NETWORK_LABEL_EVENT_HANDLER_TERTIARY
LAB_18084a5b3=NETWORK_LABEL_EVENT_HANDLER_QUATERNARY
LAB_18084aad6=NETWORK_LABEL_TIMEOUT_HANDLER_PRIMARY
LAB_18084aa7f=NETWORK_LABEL_TIMEOUT_HANDLER_SECONDARY
LAB_18084ac26=NETWORK_LABEL_TIMEOUT_HANDLER_TERTIARY
LAB_18084abcf=NETWORK_LABEL_TIMEOUT_HANDLER_QUATERNARY
LAB_18084ad66=NETWORK_LABEL_VALIDATION_PRIMARY
LAB_18084ad14=NETWORK_LABEL_VALIDATION_SECONDARY
LAB_18084ae98=NETWORK_LABEL_VALIDATION_TERTIARY
LAB_18084ae43=NETWORK_LABEL_VALIDATION_QUATERNARY
LAB_18084af88=NETWORK_LABEL_COMPRESSION_PRIMARY
LAB_18084af68=NETWORK_LABEL_COMPRESSION_SECONDARY
LAB_18084b131=NETWORK_LABEL_ENCRYPTION_PRIMARY
LAB_18084b46d=NETWORK_LABEL_ENCRYPTION_SECONDARY
LAB_18084b4a9=NETWORK_LABEL_AUTHENTICATION_PRIMARY
LAB_18084bb6f=NETWORK_LABEL_AUTHENTICATION_SECONDARY
LAB_18084bb9a=NETWORK_LABEL_SESSION_PRIMARY
LAB_18084bff4=NETWORK_LABEL_SESSION_SECONDARY
LAB_18084c510=NETWORK_LABEL_SESSION_TERTIARY
LAB_18084c923=NETWORK_LABEL_SESSION_QUATERNARY
LAB_18084ca76=NETWORK_LABEL_MEMORY_MANAGEMENT_PRIMARY
LAB_18084cfd9=NETWORK_LABEL_MEMORY_MANAGEMENT_SECONDARY
LAB_18084d224=NETWORK_LABEL_RESOURCE_PRIMARY
LAB_18084d22e=NETWORK_LABEL_RESOURCE_SECONDARY
LAB_18084d4b4=NETWORK_LABEL_RESOURCE_TERTIARY
LAB_18084d5b4=NETWORK_LABEL_RESOURCE_QUATERNARY
LAB_18084d7db=NETWORK_LABEL_CLEANUP_PRIMARY
LAB_18084e5ba=NETWORK_LABEL_CLEANUP_SECONDARY
LAB_18084e841=NETWORK_LABEL_CLEANUP_TERTIARY
LAB_18084e8ab=NETWORK_LABEL_CLEANUP_QUATERNARY
LAB_18084efc3=NETWORK_LABEL_INITIALIZATION_PRIMARY
LAB_18084f0bc=NETWORK_LABEL_INITIALIZATION_SECONDARY
LAB_18084f283=NETWORK_LABEL_INITIALIZATION_TERTIARY
LAB_18084f34c=NETWORK_LABEL_INITIALIZATION_QUATERNARY
LAB_18084f513=NETWORK_LABEL_INITIALIZATION_QUINARY
LAB_18084f5dc=NETWORK_LABEL_INITIALIZATION_SENARY
LAB_18084f7a3=NETWORK_LABEL_INITIALIZATION_SEPTENARY
LAB_18084f88c=NETWORK_LABEL_STATE_PRIMARY
LAB_18084f933=NETWORK_LABEL_STATE_SECONDARY
LAB_18084f970=NETWORK_LABEL_STATE_TERTIARY
LAB_18084f987=NETWORK_LABEL_STATE_QUATERNARY
LAB_18084faac=NETWORK_LABEL_STATE_QUINARY
LAB_18084fc27=NETWORK_LABEL_STATE_SENARY
LAB_18084fc83=NETWORK_LABEL_STATE_SEPTENARY
LAB_18084fb35=NETWORK_LABEL_STATE_OCTONARY
LAB_18084fd6c=NETWORK_LABEL_HANDLER_PRIMARY
LAB_18084fe13=NETWORK_LABEL_HANDLER_SECONDARY
LAB_18084fe50=NETWORK_LABEL_HANDLER_TERTIARY
LAB_18084fe67=NETWORK_LABEL_HANDLER_QUATERNARY
LAB_18084ff8c=NETWORK_LABEL_HANDLER_QUINARY
LAB_180850015=NETWORK_LABEL_HANDLER_SENARY
LAB_180850107=NETWORK_LABEL_HANDLER_SEPTENARY
LAB_180850163=NETWORK_LABEL_HANDLER_OCTONARY
LAB_18085024c=NETWORK_LABEL_TRANSFER_PRIMARY
LAB_1808502f3=NETWORK_LABEL_TRANSFER_SECONDARY
LAB_180850330=NETWORK_LABEL_TRANSFER_TERTIARY
LAB_180850347=NETWORK_LABEL_TRANSFER_QUATERNARY
LAB_18085046c=NETWORK_LABEL_TRANSFER_QUINARY
LAB_1808504f5=NETWORK_LABEL_TRANSFER_SENARY
LAB_1808505e7=NETWORK_LABEL_TRANSFER_SEPTENARY
LAB_180850643=NETWORK_LABEL_TRANSFER_OCTONARY
LAB_18085072c=NETWORK_LABEL_CONNECTION_PRIMARY
LAB_1808507d3=NETWORK_LABEL_CONNECTION_SECONDARY
LAB_180850810=NETWORK_LABEL_CONNECTION_TERTIARY
LAB_180850827=NETWORK_LABEL_CONNECTION_QUATERNARY
LAB_18085094c=NETWORK_LABEL_CONNECTION_QUINARY
LAB_1808509d5=NETWORK_LABEL_CONNECTION_SENARY
LAB_180850ac7=NETWORK_LABEL_CONNECTION_SEPTENARY
LAB_180850b23=NETWORK_LABEL_CONNECTION_OCTONARY
LAB_180850d88=NETWORK_LABEL_SYSTEM_PRIMARY
LAB_180850d95=NETWORK_LABEL_SYSTEM_SECONDARY
LAB_180850d9b=NETWORK_LABEL_SYSTEM_TERTIARY
LAB_180850eb0=NETWORK_LABEL_SYSTEM_QUATERNARY
LAB_1808511a4=NETWORK_LABEL_SYSTEM_QUINARY
LAB_1808513ac=NETWORK_LABEL_SYSTEM_SENARY
LAB_1808513a8=NETWORK_LABEL_SYSTEM_SEPTENARY
LAB_180851437=NETWORK_LABEL_SYSTEM_OCTONARY
LAB_180851223=NETWORK_LABEL_ERROR_PRIMARY
LAB_180852000=NETWORK_LABEL_ERROR_SECONDARY
LAB_1808530ba=NETWORK_LABEL_VALIDATION_PRIMARY
LAB_180853370=NETWORK_LABEL_VALIDATION_SECONDARY
LAB_180853663=NETWORK_LABEL_VALIDATION_TERTIARY
LAB_180853766=NETWORK_LABEL_VALIDATION_QUATERNARY
LAB_180853768=NETWORK_LABEL_VALIDATION_QUINARY
LAB_180853ee2=NETWORK_LABEL_EXIT_PRIMARY
LAB_1808545a3=NETWORK_LABEL_EXIT_SECONDARY
EOF

# 读取源文件
SOURCE_FILE="/dev/shm/mountblade-code/TaleWorlds.Native/src/05_networking.c"
TEMP_FILE="/tmp/networking_temp.c"

# 复制源文件到临时文件
cp "$SOURCE_FILE" "$TEMP_FILE"

# 逐行替换标签
while IFS='=' read -r old_label new_label; do
    # 跳过空行和注释
    if [[ -z "$old_label" ]] || [[ "$old_label" =~ ^# ]]; then
        continue
    fi
    
    # 替换标签引用
    sed -i "s/goto $old_label;/goto $new_label;/g" "$TEMP_FILE"
    sed -i "s/ $old_label:/ $new_label:/g" "$TEMP_FILE"
    sed -i "s/^$old_label:/$new_label:/g" "$TEMP_FILE"
    
    echo "替换 $old_label -> $new_label"
done < /tmp/label_mapping.txt

# 将处理后的文件写回源文件
mv "$TEMP_FILE" "$SOURCE_FILE"

echo "LAB_标签语义化美化完成"

# 清理临时文件
rm -f /tmp/label_mapping.txt
rm -f /tmp/networking_temp.c